/*! For license information please see 4896-710f7df42b1531f0fe8d.js.LICENSE.txt */
(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[4896,8684],{54411:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){u=!0,a=e},f:function(){try{l||null==r.return||r.return()}finally{if(u)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,a=void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===n(a)?a:String(a)),i)}var o,a}r(58188),r(88233),r(95342),r(36728),r(32501),r(71372),r(18178),r(6710),r(43430),r(9575),r(96264),r(34115),r(634),r(71245),r(26936),r(27233),r(28673),r(77950),r(21850),r(20796),r(15735),r(6886);var l=function(){"use strict";function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),null==t&&(t=[]),this.changes=t,null==r&&(r=[]),this.comments=r,this.setIdSeed(e.generateIdSeed()),this.resetDirtyState()}var t,r,n;return t=e,n=[{key:"generateIdSeed",value:function(){var e=Math.floor(32767*Math.random()).toString(16),t=Math.floor(16777216*Math.random()).toString(16),r=Math.floor((new Date).valueOf()/1e3).toString(16);return"00000000".substr(0,8-r.length)+r+"000000".substr(0,6-t.length)+t+"0000".substr(0,4-e.length)+e}},{key:"generateId",value:function(){return this.generateIdSeed()+"000001"}}],(r=[{key:"getIdSeed",value:function(){return this.id_seed}},{key:"setIdSeed",value:function(e){this.id_seed=e,this.id_increment=0}},{key:"newId",value:function(){this.id_increment++;var e=this.id_increment.toString(16);return this.id_seed+"000000".substr(0,6-e.length)+e}},{key:"getComment",value:function(e){var t,r=null,n=i(this.comments);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.id===e){r=o;break}}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"removeCommentId",value:function(e){var t=this.getComment(e);null!=t&&(this.comments=this.comments.filter((function(t){return t.id!==e})),this._markAsDirty(t,"comment","removed"))}},{key:"moveCommentId",value:function(e,t,r){var n,o=i(this.comments);try{for(o.s();!(n=o.n()).done;){var a=n.value;a.id===e&&(a.op.p=t,a.op.c=r,this._markAsDirty(a,"comment","moved"))}}catch(e){o.e(e)}finally{o.f()}}},{key:"getChange",value:function(e){var t,r=null,n=i(this.changes);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.id===e){r=o;break}}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"getChanges",value:function(e){var t,r=[],n={},o=i(e);try{for(o.s();!(t=o.n()).done;)n[t.value]=!0}catch(e){o.e(e)}finally{o.f()}var a,l=i(this.changes);try{for(l.s();!(a=l.n()).done;){var u=a.value;n[u.id]&&(delete n[u.id],r.push(u))}}catch(e){l.e(e)}finally{l.f()}return r}},{key:"removeChangeId",value:function(e){var t=this.getChange(e);null!=t&&this._removeChange(t)}},{key:"removeChangeIds",value:function(e){if(null!=e&&0!==e.length){var t,r={},n=i(e);try{for(n.s();!(t=n.n()).done;)r[t.value]=!0}catch(e){n.e(e)}finally{n.f()}var o,a=[],l=i(this.changes);try{for(l.s();!(o=l.n()).done;){var u=o.value;r[u.id]?(delete r[u.id],this._markAsDirty(u,"change","removed")):a.push(u)}}catch(e){l.e(e)}finally{l.f()}this.changes=a}}},{key:"validate",value:function(e){var t,r,n=i(this.changes);try{for(n.s();!(r=n.n()).done;){var o=r.value;if(null!=o.op.i&&(t=e.slice(o.op.p,o.op.p+o.op.i.length))!==o.op.i)throw new Error("Change (".concat(JSON.stringify(o),") doesn't match text (").concat(JSON.stringify(t),")"))}}catch(e){n.e(e)}finally{n.f()}var a,l=i(this.comments);try{for(l.s();!(a=l.n()).done;){var u=a.value;if((t=e.slice(u.op.p,u.op.p+u.op.c.length))!==u.op.c)throw new Error("Comment (".concat(JSON.stringify(u),") doesn't match text (").concat(JSON.stringify(t),")"))}}catch(e){l.e(e)}finally{l.f()}}},{key:"applyOp",value:function(e,t){if(null==t&&(t={}),null==t.ts&&(t.ts=new Date),null!=e.i)this.applyInsertToChanges(e,t),this.applyInsertToComments(e);else if(null!=e.d)this.applyDeleteToChanges(e,t),this.applyDeleteToComments(e);else{if(null==e.c)throw new Error("unknown op type");this.addComment(e,t)}}},{key:"applyOps",value:function(e,t){null==t&&(t={});var r,n=i(e);try{for(n.s();!(r=n.n()).done;){var o=r.value;this.applyOp(o,t)}}catch(e){n.e(e)}finally{n.f()}}},{key:"addComment",value:function(e,t){var r;null!=this.getComment(e.t)?this.moveCommentId(e.t,e.p,e.c):(this.comments.push(r={id:e.t||this.newId(),op:{c:e.c,p:e.p,t:e.t},metadata:t}),this._markAsDirty(r,"comment","added"))}},{key:"applyInsertToComments",value:function(e){var t,r=i(this.comments);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(e.p<=n.op.p)n.op.p+=e.i.length,this._markAsDirty(n,"comment","moved");else if(e.p<n.op.p+n.op.c.length){var o=e.p-n.op.p;n.op.c=n.op.c.slice(0,+(o-1)+1||void 0)+e.i+n.op.c.slice(o),this._markAsDirty(n,"comment","moved")}}}catch(e){r.e(e)}finally{r.f()}}},{key:"applyDeleteToComments",value:function(e){var t,r=e.p,n=e.d.length,o=e.p+n,a=i(this.comments);try{for(a.s();!(t=a.n()).done;){var l=t.value,u=l.op.p,c=l.op.p+l.op.c.length,s=c-u;if(o<=u)l.op.p-=n,this._markAsDirty(l,"comment","moved");else if(r>=c);else{var f=void 0,d=void 0;d=r<=u?"":l.op.c.slice(0,r-u),f=o>=c?"":l.op.c.slice(o-u);var p=l.op.c.slice(d.length,s-f.length),h=Math.max(0,u-r);if(p!==e.d.slice(h).slice(0,p.length))throw new Error("deleted content does not match comment content");l.op.p=Math.min(u,r),l.op.c=d+f,this._markAsDirty(l,"comment","moved")}}}catch(e){a.e(e)}finally{a.f()}}},{key:"applyInsertToChanges",value:function(e,t){for(var r,n=e.p,i=e.i.length,o=e.p+i,a=!!e.u,l=!1,u=null,c=[],s=[],f=[],d=0;d<this.changes.length;d++){var p=(r=this.changes[d]).op.p;if(null!=r.op.d)n<p?(r.op.p+=i,c.push(r)):n===p&&(a&&r.op.d.length>=e.i.length&&r.op.d.slice(0,e.i.length)===e.i?(r.op.d=r.op.d.slice(e.i.length),r.op.p+=e.i.length,""===r.op.d?s.push(r):c.push(r),l=!0):(r.op.p+=i,c.push(r)));else if(null!=r.op.i){var h=void 0,y=p+r.op.i.length,m=n>=p&&n<=y,v=t.user_id===r.metadata.user_id,b=this.changes[d+1],g=null!=b&&null!=b.op.d&&e.p===y&&b.op.p===e.p,j=a&&g&&b.op.d.slice(0,e.i.length)===e.i,w=null!=u&&null!=u.op.d&&u.op.p===o;if(this.track_changes&&m&&!w&&!l&&!j&&v)h=n-p,r.op.i=r.op.i.slice(0,h)+e.i+r.op.i.slice(h),r.metadata.ts=t.ts,l=!0,c.push(r);else if(n<=p)r.op.p+=i,c.push(r);else if((!v||!this.track_changes)&&p<n&&n<y){h=n-p;var x=r.op.i.slice(0,h),S=r.op.i.slice(h);r.op.i=x,c.push(r);var O={op:{i:S,p:p+h+i},metadata:{}};for(var _ in r.metadata){var E=r.metadata[_];O.metadata[_]=E}f.push(O)}}u=r}this.track_changes&&!l&&this._addOp(e,t);for(var C=0,k=f;C<k.length;C++){var R=k[C];e=R.op,t=R.metadata,this._addOp(e,t)}for(var P=0,A=s;P<A.length;P++)r=A[P],this._removeChange(r);for(var T=0,I=c;T<I.length;T++)r=I[T],this._markAsDirty(r,"change","moved")}},{key:"applyDeleteToChanges",value:function(e,t){var r,n=this,o=e.p,a=e.d.length,l=e.p+a,u=[],c=[],s=[],f=i(this.changes);try{for(f.s();!(r=f.n()).done;){var d=r.value,p=void 0;if(null!=d.op.i){var h=(p=d.op.p)+d.op.i.length;if(l<=p)d.op.p-=a,c.push(d);else if(o>=h);else{var y=void 0,m=void 0,v=void 0,b=void 0;o>=p?(m="",b=d.op.i.slice(0,o-p)):(m=e.d.slice(0,p-o),b=""),l<=h?(y="",v=d.op.i.slice(l-p)):(y=e.d.slice(h-o),v="");var g=b+v;g.length>0?(d.op.i=g,d.op.p=Math.min(p,o),c.push(d)):u.push(d);var j=e.d.length-m.length-y.length,w=m.length,x={d:e.d.slice(w,w+j),p:w};x.d.length>0&&s.push(x)}}else if(null!=d.op.d)if(l<(p=d.op.p)||!this.track_changes&&l===p)d.op.p-=a,c.push(d);else if(o<=p&&p<=l)if(this.track_changes){var S=p-o;s.push({i:d.op.d,p:S}),u.push(d)}else d.op.p=o,c.push(d)}}catch(e){f.e(e)}finally{f.f()}e={p:e.p,d:this._applyOpModifications(e.d,s)};for(var O=0,_=u;O<_.length;O++){var E=_[O];e.d.length>0&&null!=E.op.d&&e.p<=E.op.p&&E.op.p<=e.p+e.d.length?(E.op.p=e.p,E.op.d=e.d,E.metadata=t,c.push(E),e.d=""):this._removeChange(E)}if(this.track_changes&&e.d.length>0)this._addOp(e,t);else{var C=this._scanAndMergeAdjacentUpdates();c=c.concat(C.movedChanges);var k,R=i(C.removeChanges);try{var P=function(){var e=k.value;n._removeChange(e),c=c.filter((function(t){return t!==e}))};for(R.s();!(k=R.n()).done;)P()}catch(e){R.e(e)}finally{R.f()}}var A,T=i(c);try{for(T.s();!(A=T.n()).done;){var I=A.value;this._markAsDirty(I,"change","moved")}}catch(e){T.e(e)}finally{T.f()}}},{key:"_addOp",value:function(e,t){var r={id:this.newId(),op:this._clone(e),metadata:this._clone(t)};this.changes.push(r),this.changes.sort((function(e,t){var r=e.op.p-t.op.p;return 0!==r?r:null!=e.op.i&&null!=t.op.d?1:null!=e.op.d&&null!=t.op.i?-1:0})),this._markAsDirty(r,"change","added")}},{key:"_removeChange",value:function(e){this.changes=this.changes.filter((function(t){return t.id!==e.id})),this._markAsDirty(e,"change","removed")}},{key:"_applyOpModifications",value:function(e,t){t.sort((function(e,t){var r=t.p-e.p;return 0!==r?r:null!=e.i&&null!=t.d?1:null!=e.d&&null!=t.i?-1:0}));var r,n=i(t);try{for(n.s();!(r=n.n()).done;){var o=r.value;if(null!=o.i)e=e.slice(0,o.p)+o.i+e.slice(o.p);else if(null!=o.d){if(e.slice(o.p,o.p+o.d.length)!==o.d)throw new Error("deleted content does not match. content: ".concat(JSON.stringify(e),"; modification: ").concat(JSON.stringify(o)));e=e.slice(0,o.p)+e.slice(o.p+o.d.length)}}}catch(e){n.e(e)}finally{n.f()}return e}},{key:"_scanAndMergeAdjacentUpdates",value:function(){var e,t=null,r=[],n=[],o=i(this.changes);try{for(o.s();!(e=o.n()).done;){var a,l,u,c=e.value;if(null!=(null===(a=t)||void 0===a?void 0:a.op.i)&&null!=c.op.i){var s=t.op.p+t.op.i.length,f=t.metadata.user_id,d=c.op.p,p=c.metadata.user_id;s===d&&f===p&&(r.push(c),t.op.i+=c.op.i,n.push(t))}else null!=(null===(l=t)||void 0===l?void 0:l.op.d)&&null!=c.op.d&&(null===(u=t)||void 0===u?void 0:u.op.p)===c.op.p?(t.op.d+=c.op.d,r.push(c),n.push(t)):t=c}}catch(e){o.e(e)}finally{o.f()}return{movedChanges:n,removeChanges:r}}},{key:"resetDirtyState",value:function(){this._dirtyState={comment:{moved:{},removed:{},added:{}},change:{moved:{},removed:{},added:{}}}}},{key:"getDirtyState",value:function(){return this._dirtyState}},{key:"_markAsDirty",value:function(e,t,r){this._dirtyState[t][r][e.id]=e}},{key:"_clone",value:function(e){var t={};for(var r in e){var n=e[r];t[r]=n}return t}}])&&a(t.prototype,r),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports=l},23438:function(e,t,r){"use strict";r.d(t,{Z:function(){return k}});r(15735),r(58188),r(73439),r(28673),r(6886),r(34115),r(634),r(20796),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850),r(71372);var n=r(2784),i=r(13980),o=r.n(i),a=r(75234),l=r(52322);var u=function(e){var t=e.resetUnreadMessages,r=e.sendMessage,n=(0,a.$G)().t;return(0,l.jsxs)("form",{className:"new-message",children:[(0,l.jsx)("label",{htmlFor:"chat-input",className:"sr-only",children:n("your_message_to_collaborators")}),(0,l.jsx)("textarea",{id:"chat-input",placeholder:"".concat(n("your_message_to_collaborators"),"…"),onKeyDown:function(e){var t=e.nativeEvent.isComposing;if("Enter"===e.key&&!t){e.preventDefault();var n=e.target;r(n.value),window.setTimeout((function(){var e;n.blur(),null===(e=n.closest("form"))||void 0===e||e.reset(),n.focus()}),0)}},onClick:t})]})},c=r(76635),s=r.n(c);function f(e){var t=e.atEnd,r=e.children,i=e.className,o=void 0===i?"":i,a=e.fetchData,u=e.itemCount,c=e.isLoading,f=(0,n.useRef)(null),d=(0,n.useRef)(0);function p(){f.current.scrollTop=f.current.scrollHeight-f.current.clientHeight-d.current}return(0,n.useLayoutEffect)(p,[u]),(0,n.useEffect)((function(){var e=s().debounce(p,400);return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),(0,l.jsx)("div",{ref:f,onScroll:function(e){var r,n;r=f.current.scrollHeight-f.current.scrollTop-f.current.clientHeight,d.current=r,e.target===e.currentTarget&&(n=f.current.children[0].clientHeight<f.current.clientHeight,!(t||c||n)&&f.current.scrollTop<30&&a())},className:"infinite-scroll ".concat(o),children:r})}f.propTypes={atEnd:o().bool,children:o().element.isRequired,className:o().string,fetchData:o().func.isRequired,itemCount:o().number.isRequired,isLoading:o().bool};var d=f,p=r(86186),h=r(63584);function ChatFallbackError(e){var t=e.reconnect,r=(0,a.$G)().t;return(0,l.jsx)("aside",{className:"chat",children:(0,l.jsxs)("div",{className:"chat-error",children:[(0,l.jsx)(p.Z,{bsStyle:"danger",children:r("chat_error")}),t&&(0,l.jsx)("p",{className:"text-center",children:(0,l.jsx)(h.Z,{bsStyle:"info",type:"button",onClick:t,children:r("reconnect")})})]})})}ChatFallbackError.propTypes={reconnect:o().any};var y=ChatFallbackError,m=r(10280),v=r(39493),b=r(80564),g=r(23357),j=r(28684),w=r(76591),x=r(28500);function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _=(0,n.lazy)((function(){return Promise.all([r.e(3546),r.e(551)]).then(r.bind(r,60551))})),E=n.memo((function(){var e=(0,a.$G)().t,t=(0,v.l5)().chatIsOpen,r=(0,b.SE)({id:o().string.isRequired}),i=(0,w.mx)(),c=i.status,s=i.messages,f=i.initialMessagesLoaded,p=i.atEnd,h=i.loadInitialMessages,m=i.loadMoreMessages,g=i.reset,O=i.sendMessage,E=i.markMessagesAsRead,k=i.error;(0,n.useEffect)((function(){t&&!f&&h()}),[t,h,f]);var R="pending"!==c&&0===s.length,P=s.reduce((function(e,t){return e+t.contents.length}),0),A=S((0,n.useState)(t),2),T=A[0],I=A[1];if((0,n.useEffect)((function(){t&&I(!0)}),[t]),k){if(k instanceof j.kp)return(0,l.jsx)(y,{reconnect:g});throw k}return r&&T?(0,l.jsxs)("aside",{className:"chat",children:[(0,l.jsx)(d,{atEnd:p,className:"messages",fetchData:m,isLoading:"pending"===c,itemCount:P,children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"sr-only",children:e("chat")}),(0,l.jsxs)(n.Suspense,{fallback:(0,l.jsx)(x.Z,{delay:500}),children:["pending"===c&&(0,l.jsx)(x.Z,{delay:500}),R&&(0,l.jsx)(C,{}),(0,l.jsx)(_,{messages:s,userId:r.id,resetUnreadMessages:E})]})]})}),(0,l.jsx)(u,{resetUnreadMessages:E,sendMessage:O})]}):null}));function C(){var e=(0,a.$G)().t;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"no-messages text-center small",children:e("no_messages")}),(0,l.jsxs)("div",{className:"first-message text-center",children:[e("send_first_message"),(0,l.jsx)("br",{}),(0,l.jsx)(m.Z,{type:"arrow-down"})]})]})}var k=(0,g.Z)(E,y)},76591:function(e,t,r){"use strict";r.d(t,{aM:function(){return _},mx:function(){return E}});r(71372),r(15735),r(58188),r(28673),r(6886),r(60523),r(28399),r(18178),r(88233),r(9575),r(96264),r(34115),r(634),r(71245),r(34769),r(95342),r(68625),r(36728),r(1939),r(62775),r(20796),r(32501),r(26936),r(27233),r(77950),r(21850);var n=r(2784),i=r(13980),o=r.n(i),a=r(98022),l=r(80564),u=r(13364),c=r(28684),s=r(73720),f=r(73091),d=r(39493),p=r(96931),h=r(52322);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===y(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var w=50;function x(e,t){switch(t.type){case"INITIAL_FETCH_MESSAGES":return g(g({},e),{},{status:"pending",initialMessagesLoaded:!0});case"FETCH_MESSAGES":return g(g({},e),{},{status:"pending"});case"FETCH_MESSAGES_SUCCESS":return g(g(g({},e),{},{status:"idle"},(0,s.n)(e.messages,t.messages,e.uniqueMessageIds)),{},{lastTimestamp:t.messages[0]?t.messages[0].timestamp:null,atEnd:t.messages.length<w});case"SEND_MESSAGE":return g(g({},e),(0,s.q)(e.messages,{id:(0,a.v4)(),user:t.user,content:t.content,timestamp:Date.now()},e.uniqueMessageIds));case"RECEIVE_MESSAGE":return g(g(g({},e),(0,s.q)(e.messages,t.message,e.uniqueMessageIds)),{},{unreadMessageCount:e.unreadMessageCount+1});case"MARK_MESSAGES_AS_READ":return g(g({},e),{},{unreadMessageCount:0});case"CLEAR":return g({},S);case"ERROR":return g(g({},e),{},{status:"error",error:t.error});default:throw new Error("Unknown action")}}var S={status:"idle",messages:[],initialMessagesLoaded:!1,lastTimestamp:null,atEnd:!1,unreadMessageCount:0,error:null,uniqueMessageIds:[]},O=(0,n.createContext)();function _(e){var t=e.children,r=(0,n.useRef)((0,a.v4)()),i=(0,l.SE)({id:o().string.isRequired}),s=(0,u.d2)({_id:o().string.isRequired})._id,y=(0,d.l5)().chatIsOpen,v=(0,f.Z)(),b=v.hasFocus,g=v.flashTitle,j=v.stopFlashingTitle,_=m((0,n.useReducer)(x,S),2),E=_[0],C=_[1],k=(0,n.useMemo)((function(){function e(){if(!E.atEnd){var e={limit:w};E.lastTimestamp&&(e.before=E.lastTimestamp);var t=new URLSearchParams(e),r="/project/".concat(s,"/messages?").concat(t.toString());(0,c.xA)(r).then((function(){C({type:"FETCH_MESSAGES_SUCCESS",messages:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reverse()})})).catch((function(e){C({type:"ERROR",error:e})}))}}return{loadInitialMessages:function(){E.initialMessagesLoaded||(C({type:"INITIAL_FETCH_MESSAGES"}),e())},loadMoreMessages:function(){C({type:"FETCH_MESSAGES"}),e()},reset:function(){C({type:"CLEAR"}),e()}}}),[s,E.atEnd,E.initialMessagesLoaded,E.lastTimestamp]),R=k.loadInitialMessages,P=k.loadMoreMessages,A=k.reset,T=(0,n.useCallback)((function(e){if(e){C({type:"SEND_MESSAGE",user:i,content:e});var t="/project/".concat(s,"/messages");(0,c.ty)(t,{body:{content:e,client_id:r.current}}).catch((function(e){C({type:"ERROR",error:e})}))}}),[s,i]),I=(0,n.useCallback)((function(){C({type:"MARK_MESSAGES_AS_READ"})}),[]),F=(0,p.I)().socket;(0,n.useEffect)((function(){if(F)return F.on("new-chat-message",e),function(){F&&F.removeListener("new-chat-message",e)};function e(e){e.clientId!==r.current&&C({type:"RECEIVE_MESSAGE",message:e})}}),[F]),(0,n.useEffect)((function(){b&&(j(),y&&I()),!b&&E.unreadMessageCount>0&&g("New Message")}),[b,y,E.unreadMessageCount,g,j,I]);var D=(0,n.useMemo)((function(){return{status:E.status,messages:E.messages,initialMessagesLoaded:E.initialMessagesLoaded,atEnd:E.atEnd,unreadMessageCount:E.unreadMessageCount,loadInitialMessages:R,loadMoreMessages:P,reset:A,sendMessage:T,markMessagesAsRead:I,error:E.error}}),[R,P,I,A,T,E.atEnd,E.error,E.initialMessagesLoaded,E.messages,E.status,E.unreadMessageCount]);return(0,h.jsx)(O.Provider,{value:D,children:t})}function E(e){var t=(0,n.useContext)(O);return o().checkPropTypes(e,t,"data","ChatContext.Provider"),t}O.Provider.propTypes={value:o().shape({status:o().string.isRequired,messages:o().array.isRequired,initialMessagesLoaded:o().bool.isRequired,atEnd:o().bool.isRequired,unreadMessageCount:o().number.isRequired,loadInitialMessages:o().func.isRequired,loadMoreMessages:o().func.isRequired,sendMessage:o().func.isRequired,markMessagesAsRead:o().func.isRequired,reset:o().func.isRequired,error:o().object}).isRequired},_.propTypes={children:o().any}},10649:function(e,t,r){"use strict";r.d(t,{Z:function(){return m}});r(15735),r(58188),r(73439),r(28673),r(6886);var n=r(39493),i=(r(34115),r(634),r(20796),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850),r(71372),r(2784)),o=r(72309),a=r(52322);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=(0,i.memo)((function(){var e=(0,n.l5)().setLeftMenuShown,t=(0,o.cq)().userSettings,r=t.editorTheme,u=t.overallTheme,c=l((0,i.useState)({editorTheme:r,overallTheme:u}),1)[0],s=(0,i.useRef)(null);return(0,i.useEffect)((function(){s.current&&(r===c.editorTheme&&u===c.overallTheme||(s.current.style.opacity="0"))}),[r,u,c]),(0,a.jsx)("div",{id:"left-menu-mask",ref:s,onClick:function(){return e(!1)}})})),s=r(11685),f=r(17631),d=r(72779),p=r.n(d),h=r(28500),y=(0,i.lazy)((function(){return Promise.all([r.e(7036),r.e(4028)]).then(r.bind(r,34028))}));function m(){var e=(0,n.l5)(),t=e.leftMenuShown,r=e.setLeftMenuShown;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Z,{backdropClassName:"left-menu-modal-backdrop",keyboard:!0,onHide:function(){r(!1)},id:"left-menu-modal",show:t,children:(0,a.jsx)(f.Z.Body,{className:p()("full-size",{shown:t}),id:"left-menu",children:(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)(h.w,{delay:500}),children:(0,a.jsx)(y,{})})})}),t&&(0,a.jsx)(c,{})]})}},50641:function(e,t,r){"use strict";r.d(t,{Hc:function(){return s},ou:function(){return c}});r(71372);var n=r(2784),i=r(77241),o=r(45564),a=r(51261),l=r(52322),u=(0,n.createContext)(void 0),c=function(e){var t=e.children,r=(0,i.Z)(),c=r.compiler,s=r.setCompiler,f=r.imageName,d=r.setImageName,p=r.rootDocId,h=r.setRootDocId,y=r.spellCheckLanguage,m=r.setSpellCheckLanguage,v=(0,o.Z)(),b=v.autoComplete,g=v.setAutoComplete,j=v.autoPairDelimiters,w=v.setAutoPairDelimiters,x=v.syntaxValidation,S=v.setSyntaxValidation,O=v.editorTheme,_=v.setEditorTheme,E=v.overallTheme,C=v.setOverallTheme,k=v.mode,R=v.setMode,P=v.fontSize,A=v.setFontSize,T=v.fontFamily,I=v.setFontFamily,F=v.lineHeight,D=v.setLineHeight,N=v.pdfViewer,L=v.setPdfViewer;(0,a.Z)();var M=(0,n.useMemo)((function(){return{compiler:c,setCompiler:s,imageName:f,setImageName:d,rootDocId:p,setRootDocId:h,spellCheckLanguage:y,setSpellCheckLanguage:m,autoComplete:b,setAutoComplete:g,autoPairDelimiters:j,setAutoPairDelimiters:w,syntaxValidation:x,setSyntaxValidation:S,editorTheme:O,setEditorTheme:_,overallTheme:E,setOverallTheme:C,mode:k,setMode:R,fontSize:P,setFontSize:A,fontFamily:T,setFontFamily:I,lineHeight:F,setLineHeight:D,pdfViewer:N,setPdfViewer:L}}),[c,s,f,d,p,h,y,m,b,g,j,w,x,S,O,_,E,C,k,R,P,A,T,I,F,D,N,L]);return(0,l.jsx)(u.Provider,{value:M,children:t})};function s(){var e=(0,n.useContext)(u);if(!e)throw new Error("useProjectSettingsContext is only available inside ProjectSettingsProvider");return e}},81721:function(e,t,r){"use strict";r.d(t,{Z:function(){return nt}});var n={};r.r(n),r.d(n,{default:function(){return z}});r(26936);var i=r(2784),o=r(13980),a=r.n(o),l=(r(9575),r(96264),r(34115),r(634),r(58188),r(71372),r(71245),r(34769),r(95342),r(68625),r(36728),r(1939),r(62775),r(20796),r(15735),r(28673),r(6886),r(32501),r(88233),r(27233),r(77950),r(21850),r(72779)),u=r.n(l),c=r(75234),s=r(10280),f=(r(73439),r(22866)),d=r(80564),p=r(36915),h=r(49169),y=r(13364),m=r(91354),v=r(28684),b=r(96931),g=r(52322);function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==j(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===j(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var C=(0,i.createContext)();function k(e){var t,r,n,o=e.children,l=(0,d.SE)({first_name:a().string,last_name:a().string}),u=l.first_name,c=l.last_name,s=(0,y.d2)({_id:a().string.isRequired,name:a().string.isRequired,rootDocId:a().string.isRequired}),j=s._id,w=s.name,S=s.rootDocId,E=(0,m.O)({hasFolders:a().bool}).hasFolders,k=(0,b.I)(),R=(0,f._i)({cobranding:a().shape({brandVariationId:a().number.isRequired,brandId:a().number.isRequired,publishGuideHtml:a().string,partner:a().string,brandedMenu:a().bool})}).cobranding,P=(0,p.Im)(),A=P.pdfDownloadUrl,T=P.pdfUrl,I=P.logEntries,F=(0,p.Im)({uncompiled:a().bool}).uncompiled;R&&(R.publishGuideHtml||R.partner)?R.brandedMenu?(r="/journals/".concat(R.brandId),t="branded"):R.partner?(r="/journals/".concat(R.brandId),t="export",n=R.brandVariationId):(r="/journals/".concat(R.brandId),t="guide",n=R.brandVariationId):(r="/journals",t="basic");var D=O((0,i.useState)(null),2),N=D[0],L=D[1],M=O((0,i.useState)(null),2),Z=M[0],q=M[1],U=(0,h.Z)(),G=(0,i.useCallback)((function(){var e="/latest_template/".concat(j);return Promise.all([(0,v.xA)(e),(0,v.xA)(r)]).then((function(e){var t=O(e,2),r=t[0],n=t[1];if(U.current){var i=r.title?{title:r.title}:{};i.description=r.description,i.author=r.author,i.license=r.license,q(r),L(n)}}))}),[U,r,j]),V=(0,i.useCallback)((function(){var e=S;if(k.editorManager.getCurrentDocId()===e)return!1;var t=k.editorManager.getCurrentDocValue();if(null==t)return!1;var r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}(t.split("\n"));try{for(n.s();!(r=n.n()).done;){var i=r.value;if(/^[^%]*\\documentclass/.test(i))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}),[k.editorManager,S]),$={entries:N,initialShown:t,brandVariationId:n,fetchData:G,initParams:x({projectId:j,pdfUrl:T?A:void 0,logs:I,uncompiled:F,hasFolders:E,rootDocOverridden:V(S),firstName:u,lastName:c,title:w},Z)};return(0,g.jsx)(C.Provider,{value:$,children:o})}C.Provider.propTypes={value:a().shape({entries:a().object,initialShown:a().oneOf(["basic","guide","branded","export"]).isRequired,brandVariationId:a().number,fetchData:a().func.isRequired,initParams:a().shape({title:a().string,description:a().string,author:a().string,license:a().string,projectId:a().string.isRequired,pdfUrl:a().string,logs:a().object,uncompiled:a().bool,hasFolders:a().bool,rootDocOverridden:a().bool,firstName:a().string,lastName:a().string}).isRequired}).isRequired},k.propTypes={children:a().any};var R=r(17631),P=r(11685);r(96928),r(92215),r(61229);function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==A(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===A(o)?o:String(o)),n)}var i,o}function I(e,t){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},I(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=D(e);if(t){var i=D(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&I(e,t)}(DestinationsError,e);var t,r,n,i=F(DestinationsError);function DestinationsError(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DestinationsError),i.apply(this,arguments)}return t=DestinationsError,(r=[{key:"render",value:function(){return(0,g.jsx)("span",{children:(0,g.jsxs)("p",{children:["Sorry, we had trouble retrieving our list of submission destinations. If you give us a minute, retry, and still find this error, please notify support at"," ",(0,g.jsx)("a",{href:"mailto:support@overleaf.com?subject=Unable to submit",children:"support@overleaf.com"})]})})}}])&&T(t.prototype,r),n&&T(t,n),Object.defineProperty(t,"prototype",{writable:!1}),DestinationsError}(i.Component);function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Z=(0,i.lazy)((function(){return r.e(9493).then(r.bind(r,49493))}));function q(e){var t,n,o,l=e.handleHide,u=(0,c.$G)().t,s=(t={entries:a().object,initialShown:a().string.isRequired,initParams:a().object.isRequired,fetchData:a().func.isRequired,brandVariationId:a().number},n=(0,i.useContext)(C),a().checkPropTypes(t,n,"data","PublishContext.Provider"),n),f=s.entries,d=s.initialShown,p=s.initParams,y=s.fetchData,m=s.brandVariationId,v=L((0,i.useState)(!0),2),b=v[0],j=v[1],w=L((0,i.useState)(!1),2),x=w[0],S=w[1],O=L((0,i.useState)(!1),2),_=O[0],E=O[1],k=(0,h.Z)();return(0,i.useEffect)((function(){r.e(9493).then(r.bind(r,49493)).catch((function(){return E(!0)})),x||(y().catch((function(){k.current&&E(!0)})),S(!0))}),[k,x,y]),o=f&&null!=p&&p.logs?(0,g.jsx)(i.Suspense,{fallback:(0,g.jsx)(U,{}),children:(0,g.jsx)(Z,{entries:f,initialShown:d,initParams:p,brandVariationId:m})}):_?(0,g.jsx)(N,{}):(0,g.jsx)(U,{}),(0,g.jsxs)(P.Z,{bsSize:"large",show:b,onHide:function(){l(),j(!1)},children:[(0,g.jsx)(R.Z.Header,{closeButton:!0,children:(0,g.jsxs)(R.Z.Title,{children:[" ",u("submit_title")," "]})}),(0,g.jsx)(R.Z.Body,{children:(0,g.jsxs)("div",{className:"modal-body-publish",children:[o," "]})})]})}function U(){var e=(0,c.$G)().t;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(s.Z,{type:"refresh",fw:!0,spin:!0})," ",(0,g.jsxs)("span",{children:[e("loading"),"…"]})]})}q.propTypes={handleHide:a().func.isRequired};var G=r(23357),V=r(96227);function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return B(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function H(e){var t=e.cobranding,r=(0,c.$G)().t,n=$((0,i.useState)(!1),2),o=n[0],a=n[1];var l=u()("btn","btn-full-height");return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"toolbar-item",children:(0,g.jsxs)("button",{id:"publishButton",className:l,onClick:function(){V.sendMB("navigation-clicked-submit"),a(!0)},children:[(0,g.jsx)(s.Z,{type:"globe",fw:!0}),null!=t&&t.submitBtnHtml?(0,g.jsx)("p",{className:"toolbar-label toolbar-label-multiline",dangerouslySetInnerHTML:{__html:t.submitBtnHtml}}):(0,g.jsx)("p",{className:"toolbar-label",children:r("submit_title")})]})}),o&&(0,g.jsx)(k,{children:(0,g.jsx)(q,{handleHide:function(){a(!1)}})})]})}H.propTypes={cobranding:a().shape({submitBtnHtml:a().string})};var z=(0,G.Z)(H);function K(e){var t=e.onClick,r=(0,c.$G)().t;return(0,g.jsx)("div",{className:"toolbar-item",children:(0,g.jsxs)("button",{className:"btn btn-full-height",onClick:t,children:[(0,g.jsx)(s.Z,{type:"bars",fw:!0,className:"editor-menu-icon"}),(0,g.jsx)("p",{className:"toolbar-label",children:r("menu")})]})})}K.propTypes={onClick:a().func.isRequired};var W=K;function Y(e){var t=e.brandVariationHomeUrl,r=e.brandVariationName,n=e.logoImgUrl;return(0,g.jsx)("a",{className:"btn btn-full-height header-cobranding-logo-container",href:t,target:"_blank",rel:"noreferrer noopener",children:(0,g.jsx)("img",{src:n,className:"header-cobranding-logo",alt:r})})}Y.propTypes={brandVariationHomeUrl:a().string.isRequired,brandVariationName:a().string.isRequired,logoImgUrl:a().string.isRequired};var J=Y,X=r(24958);var Q=function(){var e=(0,c.$G)().t;return(0,g.jsx)(X.Z,{id:"back-to-projects",description:e("back_to_your_projects"),overlayProps:{placement:"right"},children:(0,g.jsx)("div",{className:"toolbar-item",children:(0,g.jsx)("a",{className:"btn btn-full-height",draggable:"false",href:"/project",onClick:function(){V.sendMB("navigation-clicked-home")},children:(0,g.jsx)(s.Z,{type:"home",fw:!0,accessibilityLabel:e("back_to_your_projects")})})})})};var ee=function(){var e=(0,c.$G)().t;return(0,g.jsx)("a",{className:"toolbar-header-upgrade-prompt btn btn-primary btn-xs",href:"/user/subscription/plans?itm_referrer=editor-header-upgrade-prompt",target:"_blank",onClick:function(e){V.send("subscription-funnel","code-editor","upgrade"),V.sendMB("upgrade-button-click",{source:"code-editor"})},children:e("upgrade")})};function te(e){var t=e.chatIsOpen,r=e.unreadMessageCount,n=e.onClick,i=(0,c.$G)().t,o=u()("btn","btn-full-height","btn-full-height-no-border",{active:t}),a=r>0;return(0,g.jsx)("div",{className:"toolbar-item",children:(0,g.jsxs)("button",{className:o,onClick:n,children:[(0,g.jsx)(s.Z,{type:"comment",fw:!0,className:a?"bounce":""}),a&&(0,g.jsx)("span",{className:"label label-info",children:r}),(0,g.jsx)("p",{className:"toolbar-label",children:i("chat")})]})})}te.propTypes={chatIsOpen:a().bool,unreadMessageCount:a().number.isRequired,onClick:a().func.isRequired};var re=te,ne=r(13253),ie=r(82752);var oe=function(){var e=(0,c.$G)().t;return(0,g.jsx)(s.Z,{type:"check",fw:!0,accessibilityLabel:e("selected")})},ae=r(15300),le=r(39493),ue=r(32687);function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}var se=["checkmark","icon","text"];function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){pe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ce(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ce(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function ye(){return(0,g.jsx)(s.Z,{type:"",fw:!0})}function me(){return(0,g.jsx)(s.Z,{type:"refresh",fw:!0,spin:!0})}function ve(){return(0,g.jsx)(s.Z,{type:"columns",fw:!0})}function be(){return(0,g.jsx)(s.Z,{type:"columns",fw:!0})}function ge(){return(0,g.jsx)(s.Z,{type:"window-restore",fw:!0})}function je(){return(0,g.jsx)(s.Z,{type:"code",fw:!0})}function we(){return(0,g.jsx)(s.Z,{type:"file-pdf-o",fw:!0})}function xe(e){var t=e.iconFor,r=e.pdfLayout,n=e.view;return"detacher"===e.detachRole||"history"===n?(0,g.jsx)(ye,{}):"editorOnly"!==t||"flat"!==r||"editor"!==n&&"file"!==n?"pdfOnly"===t&&"flat"===r&&"pdf"===n||"sideBySide"===t&&"sideBySide"===r?(0,g.jsx)(oe,{}):(0,g.jsx)(ye,{}):(0,g.jsx)(oe,{})}function Se(e){var t=e.checkmark,r=e.icon,n=e.text,i=he(e,se);return(0,g.jsx)(ne.Z,de(de({},i),{},{children:(0,g.jsx)("div",{className:"layout-menu-item",children:(0,g.jsxs)("div",{className:"layout-menu-item-start",children:[(0,g.jsx)("div",{children:t}),(0,g.jsx)("div",{children:r}),(0,g.jsx)("div",{children:n})]})})}))}function Oe(){var e=(0,c.$G)().t;return(0,g.jsx)(X.Z,{id:"detach-disabled",description:e("your_browser_does_not_support_this_feature"),overlayProps:{placement:"left"},children:(0,g.jsx)(Se,{disabled:!0,checkmark:(0,g.jsx)(ye,{}),icon:(0,g.jsx)(ge,{}),text:e("pdf_in_separate_tab")})})}function _e(){var e=(0,c.$G)().t,t=(0,le.l5)(),r=t.reattach,n=t.detach,o=t.detachIsLinked,a=t.detachRole,l=t.changeLayout,u=t.view,s=t.pdfLayout,f=(0,i.useCallback)((function(){n(),V.sendMB("project-layout-detach")}),[n]),d=(0,i.useCallback)((function(){"detacher"===a&&(r(),V.sendMB("project-layout-reattach"))}),[a,r]);(0,ue.Z)("ui:pdf-open",d);var p=(0,i.useCallback)((function(e,t){d(),l(e,t),V.sendMB("project-layout-change",{layout:e,view:t})}),[l,d]),h=!o&&"detacher"===a;return(0,g.jsxs)(g.Fragment,{children:[h&&(0,g.jsx)("div",{"aria-live":"assertive",className:"sr-only",children:e("layout_processing")}),(0,g.jsxs)(ae.Z,{id:"layout-dropdown",onMainButtonClick:function(){V.sendMB("navigation-clicked-layout")},className:"toolbar-item layout-dropdown",pullRight:!0,children:[(0,g.jsxs)(ie.Z.Toggle,{className:"btn-full-height",bsStyle:"link",children:[h?(0,g.jsx)(me,{}):(0,g.jsx)(ve,{}),(0,g.jsx)("span",{className:"toolbar-label",children:e("layout")})]}),(0,g.jsxs)(ie.Z.Menu,{className:"layout-dropdown-list",children:[(0,g.jsx)(Se,{onSelect:function(){return p("sideBySide")},checkmark:(0,g.jsx)(xe,{iconFor:"sideBySide",pdfLayout:s,view:u,detachRole:a}),icon:(0,g.jsx)(be,{}),text:e("editor_and_pdf")}),(0,g.jsx)(Se,{onSelect:function(){return p("flat","editor")},checkmark:(0,g.jsx)(xe,{iconFor:"editorOnly",pdfLayout:s,view:u,detachRole:a}),icon:(0,g.jsx)(je,{}),text:(0,g.jsx)(c.cC,{i18nKey:"editor_only_hide_pdf",components:[(0,g.jsx)("span",{className:"subdued"},"editor_only_hide_pdf")]})}),(0,g.jsx)(Se,{onSelect:function(){return p("flat","pdf")},checkmark:(0,g.jsx)(xe,{iconFor:"pdfOnly",pdfLayout:s,view:u,detachRole:a}),icon:(0,g.jsx)(we,{}),text:(0,g.jsx)(c.cC,{i18nKey:"pdf_only_hide_editor",components:[(0,g.jsx)("span",{className:"subdued"},"pdf_only_hide_editor")]})}),"BroadcastChannel"in window?(0,g.jsx)(Se,{onSelect:function(){return f()},checkmark:"detacher"===a?o?(0,g.jsx)(oe,{}):(0,g.jsx)(me,{}):(0,g.jsx)(ye,{}),icon:(0,g.jsx)(ge,{}),text:e("pdf_in_separate_tab")}):(0,g.jsx)(Oe,{})]})]})]})}Se.propTypes={checkmark:a().node.isRequired,icon:a().node.isRequired,text:a().oneOfType([a().string,a().node]).isRequired,onSelect:a().func};var Ee=(0,i.memo)(_e);xe.propTypes={iconFor:a().string.isRequired,pdfLayout:a().string.isRequired,view:a().string,detachRole:a().string};r(43450),r(18178);var Ce=r(56556);function ke(e){return function(e){if(Array.isArray(e))return Re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Re(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pe(e){var t=e.onlineUsers,r=e.goToUser,n=(0,c.$G)().t;return t.length>=4?(0,g.jsxs)(ae.Z,{id:"online-users",className:"online-users",pullRight:!0,children:[(0,g.jsx)(Te,{bsRole:"toggle",onlineUserCount:t.length}),(0,g.jsxs)(ie.Z.Menu,{children:[(0,g.jsx)(ne.Z,{header:!0,children:n("connected_users")}),t.map((function(e,t){return(0,g.jsx)(ne.Z,{as:"button",eventKey:e,onSelect:r,children:(0,g.jsx)(Ae,{user:e,onClick:r,showName:!0})},"".concat(e.user_id,"_").concat(t))}))]})]}):(0,g.jsx)("div",{className:"online-users",children:t.map((function(e,t){return(0,g.jsx)(X.Z,{id:"online-user",description:e.name,overlayProps:{placement:"bottom",trigger:["hover","focus"]},children:(0,g.jsx)("span",{children:(0,g.jsx)(Ae,{user:e,onClick:r})})},"".concat(e.user_id,"_").concat(t))}))})}function Ae(e){var t=e.user,r=e.showName,n=e.onClick,i="hsl(".concat((0,Ce.V)(t.user_id),", 70%, 50%)");var o=ke(t.name)[0];return(0,g.jsxs)("span",{onClick:function(){n(t)},children:[(0,g.jsx)("span",{className:"online-user",style:{backgroundColor:i},children:o}),r&&t.name]})}Pe.propTypes={onlineUsers:a().arrayOf(a().shape({user_id:a().string.isRequired,name:a().string.isRequired})).isRequired,goToUser:a().func.isRequired},Ae.propTypes={user:a().shape({user_id:a().string.isRequired,name:a().string.isRequired}),showName:a().bool,onClick:a().func.isRequired};var Te=i.forwardRef((function(e,t){var r=(0,c.$G)().t;return(0,g.jsx)(X.Z,{id:"connected-users",description:r("connected_users"),overlayProps:{placement:"left"},children:(0,g.jsxs)("button",{className:"btn online-user online-user-multi",onClick:e.onClick,children:[(0,g.jsx)("strong",{children:e.onlineUserCount}),(0,g.jsx)(s.Z,{type:"users",fw:!0})]})})}));Te.displayName="DropDownToggleButton",Te.propTypes={onlineUserCount:a().number.isRequired,onClick:a().func};var Ie=Pe;function Fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return De(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return De(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function De(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ne=function(e){var t=e.projectName,r=e.hasRenamePermissions,n=e.onChange,o=e.className,a=(0,c.$G)().t,l=Fe((0,i.useState)(!1),2),f=l[0],d=l[1],p=r&&!f,h=Fe((0,i.useState)(t),2),y=h[0],m=h[1],v=(0,i.useRef)(null);function b(){p&&(m(t),d(!0))}function j(){d(!1),n(y)}return(0,i.useEffect)((function(){var e;f&&(null===(e=v.current)||void 0===e||e.select())}),[f]),(0,g.jsxs)("div",{className:u()("project-name",o),children:[!f&&(0,g.jsx)("span",{className:"name",onDoubleClick:b,children:t}),f&&(0,g.jsx)("input",{ref:v,type:"text",className:"form-control",onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),j())},onChange:function(e){m(e.target.value)},onBlur:function(){f&&j()},value:y}),p&&(0,g.jsx)(X.Z,{id:"online-user",description:a("rename"),overlayProps:{placement:"bottom",trigger:["hover","focus"]},children:(0,g.jsx)("a",{className:"rename",role:"button",onClick:b,children:(0,g.jsx)(s.Z,{type:"pencil",fw:!0})})})]})};function Le(e){var t=e.trackChangesIsOpen,r=e.disabled,n=e.onMouseDown,i=(0,c.$G)().t,o=u()("btn","btn-full-height",{active:t&&!r,disabled:r});return(0,g.jsx)("div",{className:"toolbar-item",children:(0,g.jsxs)("button",{disabled:r,className:o,onMouseDown:n,children:[(0,g.jsx)("i",{className:"review-icon"}),(0,g.jsx)("p",{className:"toolbar-label",children:i("review")})]})})}Le.propTypes={trackChangesIsOpen:a().bool,disabled:a().bool,onMouseDown:a().func.isRequired};var Me=Le;function Ze(e){var t=e.historyIsOpen,r=e.onClick,n=(0,c.$G)().t,i=u()("btn","btn-full-height",{active:t});return(0,g.jsx)("div",{className:"toolbar-item",children:(0,g.jsxs)("button",{className:i,onClick:r,children:[(0,g.jsx)(s.Z,{type:"history",fw:!0}),(0,g.jsx)("p",{className:"toolbar-label",children:n("history")})]})})}Ze.propTypes={historyIsOpen:a().bool,onClick:a().func.isRequired};var qe=Ze;function Ue(e){var t=e.onClick,r=(0,c.$G)().t;return(0,g.jsx)("div",{className:"toolbar-item",children:(0,g.jsxs)("button",{className:"btn btn-full-height",onClick:t,children:[(0,g.jsx)(s.Z,{type:"group",fw:!0}),(0,g.jsx)("p",{className:"toolbar-label",children:r("share")})]})})}Ue.propTypes={onClick:a().func.isRequired};var Ge=Ue;function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function $e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(r),!0).forEach((function(t){He(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function He(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Ve(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ve(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ze={import:n,path:"/overleaf/services/web/modules/publish-modal/frontend/js/components/publish-toolbar-button"},Ke=null==ze?void 0:ze.import.default,We=i.memo((function(e){var t=e.cobranding,r=e.onShowLeftMenuClick,n=e.chatIsOpen,i=e.toggleChatOpen,o=e.reviewPanelOpen,a=e.toggleReviewPanelOpen,l=e.historyIsOpen,u=e.toggleHistoryOpen,s=e.unreadMessageCount,f=e.onlineUsers,d=e.goToUser,p=e.isRestrictedTokenMember,h=e.hasPublishPermissions,y=e.projectName,m=e.renameProject,v=e.hasRenamePermissions,b=e.openShareModal,j=e.trackChangesVisible,w=(0,c.$G)().t,x=h&&Ke,S=j&&!p;return(0,g.jsxs)("header",{className:"toolbar toolbar-header toolbar-with-labels",role:"navigation","aria-label":w("project_layout_sharing_submission"),children:[(0,g.jsxs)("div",{className:"toolbar-left",children:[(0,g.jsx)(W,{onClick:r}),t&&t.logoImgUrl&&(0,g.jsx)(J,Be({},t)),(0,g.jsx)(Q,{})]}),window.showUpgradePrompt&&(0,g.jsx)(ee,{}),(0,g.jsx)(Ne,{className:"toolbar-center",projectName:y,hasRenamePermissions:v,onChange:m}),(0,g.jsxs)("div",{className:"toolbar-right",children:[(0,g.jsx)(Ie,{onlineUsers:f,goToUser:d}),S&&(0,g.jsx)(Me,{onMouseDown:a,disabled:l,trackChangesIsOpen:o}),(0,g.jsx)(Ge,{onClick:b}),x&&(0,g.jsx)(Ke,{cobranding:t}),!p&&(0,g.jsx)(qe,{historyIsOpen:l,onClick:u}),(0,g.jsx)(Ee,{}),!p&&(0,g.jsx)(re,{chatIsOpen:n,onClick:i,unreadMessageCount:s})]})]})}));We.propTypes={onShowLeftMenuClick:a().func.isRequired,cobranding:a().object,chatIsOpen:a().bool,toggleChatOpen:a().func.isRequired,reviewPanelOpen:a().bool,toggleReviewPanelOpen:a().func.isRequired,historyIsOpen:a().bool,toggleHistoryOpen:a().func.isRequired,unreadMessageCount:a().number.isRequired,onlineUsers:a().array.isRequired,goToUser:a().func.isRequired,isRestrictedTokenMember:a().bool,hasPublishPermissions:a().bool,projectName:a().string.isRequired,renameProject:a().func.isRequired,hasRenamePermissions:a().bool,openShareModal:a().func.isRequired,trackChangesVisible:a().bool};var Ye=We,Je=r(76591),Xe={name:a().string.isRequired,features:a().shape({trackChangesVisible:a().bool}).isRequired},Qe={cobranding:a().object,loading:a().bool,isRestrictedTokenMember:a().bool,renameProject:a().func.isRequired,isProjectOwner:a().bool,permissionsLevel:a().string},et={markMessagesAsRead:a().func.isRequired,unreadMessageCount:a().number.isRequired};function tt(e){return e?"open":"close"}var rt=i.memo((function(e){var t=e.onlineUsersArray,r=e.openDoc,n=e.openShareProjectModal,o=(0,y.d2)(Xe),a=o.name,l=o.features.trackChangesVisible,u=(0,f._i)(Qe),c=u.cobranding,s=u.loading,d=u.isRestrictedTokenMember,p=u.renameProject,h=u.permissionsLevel,m=(0,le.l5)(),v=m.chatIsOpen,b=m.setChatIsOpen,j=m.reviewPanelOpen,w=m.setReviewPanelOpen,x=m.view,S=m.setView,O=m.setLeftMenuShown,_=(0,Je.mx)(et),E=_.markMessagesAsRead,C=_.unreadMessageCount,k=(0,i.useCallback)((function(){v||E(),V.sendMB("navigation-clicked-chat",{action:tt(!v)}),b((function(e){return!e}))}),[v,b,E]),R=(0,i.useCallback)((function(e){e.preventDefault(),V.sendMB("navigation-clicked-review",{action:tt(!j)}),w((function(e){return!e}))}),[j,w]),P=(0,i.useCallback)((function(){var e="history"===x?"close":"open";V.sendMB("navigation-clicked-history",{action:e}),S("history"===x?"editor":"history")}),[x,S]),A=(0,i.useCallback)((function(){V.sendMB("navigation-clicked-share"),n()}),[n]),T=(0,i.useCallback)((function(){V.sendMB("navigation-clicked-menu"),O((function(e){return!e}))}),[O]),I=(0,i.useCallback)((function(e){e.doc&&"number"==typeof e.row&&r(e.doc,{gotoLine:e.row+1})}),[r]);return(0,g.jsx)(Ye,{style:s?{display:"none"}:{},cobranding:c,onShowLeftMenuClick:T,chatIsOpen:v,unreadMessageCount:C,toggleChatOpen:k,reviewPanelOpen:j,toggleReviewPanelOpen:R,historyIsOpen:"history"===x,toggleHistoryOpen:P,onlineUsers:t,goToUser:I,isRestrictedTokenMember:d,hasPublishPermissions:"owner"===h||"readAndWrite"===h,projectName:a,renameProject:p,hasRenamePermissions:"owner"===h,openShareModal:A,trackChangesVisible:l})}));rt.propTypes={onlineUsersArray:a().array.isRequired,openDoc:a().func.isRequired,openShareProjectModal:a().func.isRequired};var nt=rt},20696:function(e,t,r){"use strict";r.d(t,{i:function(){return a}});var n=r(96227),i=r(99618),o=!1;function a(){if(!o){o=!0;var e=(0,i.Z)("ol-project_id");(0,n.sendMB)("document-first-change",{projectId:e,isSmallDevice:n.isSmallDevice})}}},36190:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(13980),i=r.n(n),o=r(86186),a=r(52322);function l(e){var t=e.children;return(0,a.jsx)(o.Z,{bsStyle:"danger",children:t})}l.propTypes={children:i().any.isRequired}},13516:function(e,t,r){"use strict";r.d(t,{Z:function(){return v}});var n=r(13980),i=r.n(n),o=r(75234),a=r(28684),l=(r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850),r(71372),r(2784)),u=r(13364),c=r(46267);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(){var e=(0,o.$G)().t,t=(0,u.d2)(p)._id,r=s((0,l.useState)(10),2),n=r[0],i=r[1],a=(0,c.T)();return(0,l.useEffect)((function(){i(10);var e=window.setInterval((function(){i((function(r){return 0===r?(window.clearInterval(e),a.assign("/login?redir=/project/".concat(t)),0):r-1}))}),1e3);return function(){window.clearInterval(e)}}),[t,a]),e("session_expired_redirecting_to_login",{seconds:n})}var p={_id:i().string.isRequired},h=r(17776),y=r(36190),m=r(52322);function v(e){var t=e.error,r=(0,o.$G)().t;if("string"==typeof t)switch(t){case"name-exists":return(0,m.jsx)(y.Z,{children:r("file_already_exists")});case"too-many-files":return(0,m.jsx)(y.Z,{children:r("project_has_too_many_files")});case"remote-service-error":return(0,m.jsx)(y.Z,{children:r("remote_service_error")});case"invalid_filename":return(0,m.jsx)(y.Z,{children:r("invalid_filename",{nameLimit:150})});case"rate-limit-hit":return(0,m.jsx)(y.Z,{children:r("too_many_files_uploaded_throttled_short_period")});case"not-logged-in":return(0,m.jsx)(y.Z,{children:(0,m.jsx)(d,{})});case"linked-project-compile-error":return(0,m.jsx)(y.Z,{children:r("generic_linked_file_compile_error")});default:return(0,m.jsx)(y.Z,{children:r("generic_something_went_wrong")})}switch(t.constructor){case a.kp:var n,i,l=null===(n=t.data)||void 0===n?void 0:n.message;if(l)return(0,m.jsx)(y.Z,{children:l.text||l});switch(null===(i=t.response)||void 0===i?void 0:i.status){case 400:return(0,m.jsx)(y.Z,{children:r("invalid_request")});case 403:return(0,m.jsx)(y.Z,{children:r("session_error")});case 429:return(0,m.jsx)(y.Z,{children:r("too_many_attempts")});default:return(0,m.jsx)(y.Z,{children:r("something_went_wrong_server")})}case h.w4:case h.I9:case h.Cr:return null;default:return(0,m.jsx)(y.Z,{children:r("generic_something_went_wrong")})}}v.propTypes={error:i().oneOfType([i().string,i().object]).isRequired}},17754:function(e,t,r){"use strict";r.d(t,{Z:function(){return Dr}});var n={};r.r(n),r.d(n,{CreateFileMode:function(){return tr},CreateFilePane:function(){return rr}});var i={};r.r(i),r.d(i,{CreateFileMode:function(){return nr},CreateFilePane:function(){return ir}});r(9575),r(96264),r(34115),r(634),r(58188),r(71372),r(71245),r(34769),r(95342),r(68625),r(36728),r(1939),r(62775),r(20796),r(15735),r(28673),r(6886);var o=r(2784),a=r(13980),l=r.n(a),u=r(23357),c=r(13364),s=r(91354),f=r(8668),d=r(4134),p=r(38485),h=(r(18178),r(93244),r(27233),r(26936),r(43450),r(92215),r(61229),r(32501),r(88233),r(77950),r(21850),r(75234)),y=r(4031),m=r.n(y),v=r(58926),b=r(72721),g=r(56704),j=r(14345),w=r(77426),x=r(42484),S=r(83997),O=r(38113),_=r(22866),E=r(52322);function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==C(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===C(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I(e,t,r){return I=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&F(i,r.prototype),i},I.apply(null,arguments)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}var D=(0,v.W)((function(){function e(t){return!(!t.getAttribute||!t.getAttribute("dnd-container"))||!!t.parentNode&&e(t.parentNode)}for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=I(w.PD,r);return["handleTopDragStart","handleTopDragStartCapture","handleTopDragEndCapture","handleTopDragEnter","handleTopDragEnterCapture","handleTopDragLeaveCapture","handleTopDragOver","handleTopDragOverCapture","handleTopDrop","handleTopDropCapture"].forEach((function(t){var r=i[t];i[t]=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];e(t.target)&&r.apply(void 0,[t].concat(i))}})),i})),N="ENTITY";function L(e){var t=e.children,r=(0,o.useRef)(D);return(0,E.jsx)(b.W,{manager:r.current.dragDropManager,children:t})}function M(e){var t=(0,h.$G)().t,r=(0,_._i)(Z).permissionsLevel,n=(0,s.O)().fileTreeData,i=(0,p.nF)(),a=i.selectedEntityIds,l=i.isRootFolderSelected,u=A((0,o.useState)(!0),2),c=u[0],f=u[1],d={type:N},y=(0,g.c)({item:d,begin:function(){var r=function(e,t){return e.size>1&&e.has(t)?new Set(e):new Set([t])}(l?new Set:a,e),i=(0,O.gl)(n,r),o=function(e,t){if(1===e.size){return Array.from(e)[0].entity.name}return t("n_items",{count:e.size})}(i,t),u=function(e){var t=Array.from(e).filter((function(e){return"folder"===e.type})).map((function(e){return e.entity})),r=new Set(t);return(0,O.mz)(r)}(i);return R(R({},d),{},{title:o,forbiddenFolderIds:u,draggedEntityIds:r})},collect:function(e){return{isDragging:!!e.isDragging()}},canDrag:function(){return"readOnly"!==r&&c},end:function(){return d}}),m=A(y,3),v=m[0],b=v.isDragging,j=v.draggedEntityIds,w=m[1],S=m[2];return(0,o.useEffect)((function(){S((0,x.r)())}),[S]),{dragRef:w,isDragging:b,setIsDraggable:f,draggedEntityIds:j}}L.propTypes={children:l().oneOfType([l().arrayOf(l().node),l().node]).isRequired};var Z={permissionsLevel:l().oneOf(["readOnly","readAndWrite","owner"])};function q(e){var t=(0,d.Z)(),r=t.finishMoving,n=t.setDroppedFiles,i=t.startUploadingDocOrFile,o=A((0,j.L)({accept:[N,S.FILE],canDrop:function(t,r){return!!r.isOver({shallow:!0})&&(t.type!==N||!t.forbiddenFolderIds.has(e))},drop:function(t,o){o.didDrop()||(t.type===N?r(e,t.draggedEntityIds):m()(t).then((function(t){n({files:t,targetFolderId:e}),i()})))},collect:function(e){return{isOver:e.canDrop()}}}),2),a=o[0].isOver;return{dropRef:o[1],isOver:a}}function U(e){var t=e.refProviders,r=e.reindexReferences,n=e.setRefProviderEnabled,i=e.setStartedFreeTrial,o=e.onSelect,a=e.children;return(0,E.jsx)(f.Q,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:i,reindexReferences:r,children:(0,E.jsx)(p.oJ,{onSelect:o,children:(0,E.jsx)(d.P,{reindexReferences:r,children:(0,E.jsx)(L,{children:a})})})})}U.propTypes={reindexReferences:l().func.isRequired,refProviders:l().object.isRequired,setRefProviderEnabled:l().func.isRequired,setStartedFreeTrial:l().func.isRequired,onSelect:l().func.isRequired,children:l().oneOfType([l().arrayOf(l().node),l().node]).isRequired};var G=U,V=r(72779),$=r.n(V);function B(e){var t,r=e.isOver,n=e.isDragging,i=e.item,a=e.clientOffset,l=(0,o.useRef)();return(0,E.jsx)("div",{ref:l,className:$()("dnd-draggable-preview-layer",{"dnd-droppable-hover":r}),children:n&&(null==i?void 0:i.title)&&(0,E.jsx)("div",{style:z(a,null===(t=l.current)||void 0===t?void 0:t.getBoundingClientRect()),children:(0,E.jsx)(H,{title:i.title})})})}function H(e){var t=e.title;return(0,E.jsx)("div",{className:"dnd-draggable-preview-item",children:t})}function z(e,t){if(!t||!e)return{display:"none"};var r=t.x,n=t.y,i=e.x,o=e.y-n-15,a="translate(".concat(i-r-15,"px, ").concat(o,"px)");return{transform:a,WebkitTransform:a}}B.propTypes={isOver:l().bool.isRequired,isDragging:l().bool.isRequired,item:l().shape({title:l().string.isRequired}),clientOffset:l().shape({x:l().number,y:l().number})},H.propTypes={title:l().string.isRequired};var K=B,W=(r(43430),r(93057)),Y=r(41061);function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q(e){var t=e.name,r=e.isSelected,n=e.setIsDraggable,i=(0,d.Z)(),a=i.isRenaming,l=i.startRenaming,u=i.finishRenaming,c=i.error,s=i.cancel,f=a&&r&&!c;return(0,o.useEffect)((function(){n(!f)}),[n,f]),f?(0,E.jsx)(te,{initialValue:t,finishRenaming:u,cancel:s}):(0,E.jsx)(ee,{name:t,isSelected:r,startRenaming:l})}function ee(e){var t=e.name,r=e.isSelected,n=e.startRenaming,i=J((0,o.useState)(0),2),a=i[0],l=i[1];return(0,E.jsx)("button",{className:"item-name-button",onClick:function(){l(a+1),r||l(0)},onDoubleClick:function(){a<2||n()},children:(0,E.jsx)("span",{children:t})})}function te(e){var t=e.initialValue,r=e.finishRenaming,n=e.cancel,i=J((0,o.useState)(t),2),a=i[0],l=i[1],u=(0,Y.Z)().autoFocusedRef;return(0,E.jsx)("span",{className:"rename-input",children:(0,E.jsx)("input",{type:"text",value:a,onKeyDown:function(e){"Enter"===e.key&&r(a),"Escape"===e.key&&n()},onChange:function(e){l(e.target.value)},onBlur:function(){r(a)},onFocus:function(e){var t=e.target.value.lastIndexOf(".");e.target.setSelectionRange(0,t)},ref:u})})}Q.propTypes={name:l().string.isRequired,isSelected:l().bool.isRequired,setIsDraggable:l().func.isRequired},ee.propTypes={name:l().string.isRequired,startRenaming:l().func.isRequired,isSelected:l().bool.isRequired},te.propTypes={initialValue:l().string.isRequired,finishRenaming:l().func.isRequired,cancel:l().func.isRequired};var re=Q,ne=r(10280);function ie(e){var t=e.id,r=(0,h.$G)().t,n=(0,f.e)(),i=n.contextMenuCoords,a=n.setContextMenuCoords,l=(0,o.useRef)();return(0,E.jsx)("div",{className:"menu-button btn-group",children:(0,E.jsx)("button",{className:"entity-menu-toggle btn btn-sm",id:"menu-button-".concat(t),onClick:function(e){if(e.stopPropagation(),i)a(null);else{var t=l.current.getBoundingClientRect();a({top:t.top+t.height/2,left:t.right})}},ref:l,children:(0,E.jsx)(ne.Z,{type:"ellipsis-v",accessibilityLabel:r("menu")})})})}ie.propTypes={id:l().string.isRequired};var oe=ie,ae=r(88321);function le(e){var t,r=e.id,n=e.name,i=e.isSelected,a=e.icons,l=(0,_._i)(ue).permissionsLevel,u=(0,f.e)().setContextMenuCoords,c=(0,d.Z)().isRenaming,s=(0,p.nF)().selectedEntityIds,h="readOnly"!==l&&i&&1===s.size,y=M(r),m=y.dragRef,v=y.setIsDraggable,b=(0,ae.N)().getMonitor().getItem(),g=(0,o.useRef)();return(0,o.useEffect)((function(){var e=g.current;i&&e&&setTimeout((function(){e&&(0,W.Z)(e,{scrollMode:"if-needed"})}),100)}),[i,g]),(0,E.jsx)("div",{className:$()("entity",{"file-tree-entity-dragging":null==b||null===(t=b.draggedEntityIds)||void 0===t?void 0:t.has(r)}),role:"presentation",ref:m,draggable:!c,onContextMenu:function(e){e.preventDefault(),u({top:e.pageY,left:e.pageX})},children:(0,E.jsxs)("div",{className:"entity-name entity-name-react",role:"presentation",ref:g,children:[a,(0,E.jsx)(re,{name:n,isSelected:i,setIsDraggable:v}),h?(0,E.jsx)(oe,{id:r}):null]})})}le.propTypes={id:l().string.isRequired,name:l().string.isRequired,isSelected:l().bool.isRequired,icons:l().node};var ue={permissionsLevel:l().oneOf(["readOnly","readAndWrite","owner"])},ce=le,se=r(65487);function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){he(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function he(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==fe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===fe(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ye(e){var t=e.name,r=e.id,n=e.isFile,i=e.isLinkedFile,o=(0,p.mI)(r,n?"file":"doc"),a=o.isSelected,l=o.props;return(0,E.jsx)("li",pe(pe({role:"treeitem"},l),{},{"aria-label":t,tabIndex:"0",children:(0,E.jsx)(ce,{id:r,name:t,isSelected:a,icons:(0,E.jsx)(me,{isLinkedFile:i,name:t})})}))}ye.propTypes={name:l().string.isRequired,id:l().string.isRequired,isFile:l().bool,isLinkedFile:l().bool};var me=function(e){var t=e.isLinkedFile,r=e.name,n=(0,h.$G)().t,i=$()("spaced","file-tree-icon",{"linked-file-icon":t});return(0,E.jsxs)(E.Fragment,{children:[" ",(0,E.jsx)(ne.Z,{type:(0,se.Z)(r),fw:!0,className:i}),t&&(0,E.jsx)(ne.Z,{type:"external-link-square",modifier:"rotate-180",className:"linked-file-highlight",accessibilityLabel:n("linked_file")})]})};me.propTypes={name:l().string.isRequired,isLinkedFile:l().bool};var ve=ye,be=r(18977);function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){xe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ge(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ge(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Oe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _e(e){var t=e.name,r=e.id,n=e.folders,i=e.docs,a=e.files,l=(0,h.$G)().t,u=(0,p.mI)(r,"folder"),c=u.isSelected,s=u.props,f=(0,p.nF)(r).selectedEntityParentIds,d=Se((0,be.Z)("folder.".concat(r,".expanded"),!1),2),y=d[0],m=d[1];(0,o.useEffect)((function(){f.has(r)&&m(!0)}),[r,f,m]);var v=q(r),b=v.isOver,g=v.dropRef,j=q(r),w=j.isOver,x=j.dropRef,S=(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("button",{onClick:function(){m(!y)},"aria-label":l(y?"collapse":"expand"),children:(0,E.jsx)(ne.Z,{type:y?"angle-down":"angle-right",fw:!0,className:"file-tree-expand-icon"})}),(0,E.jsx)(ne.Z,{type:y?"folder-open":"folder",fw:!0,className:"file-tree-folder-icon"})]});return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("li",we(we({role:"treeitem"},s),{},{"aria-expanded":y,"aria-label":t,tabIndex:"0",ref:g,className:$()(s.className,{"dnd-droppable-hover":b||w}),children:(0,E.jsx)(ce,{id:r,name:t,isSelected:c,icons:S})})),y?(0,E.jsx)(Ne,{folders:n,docs:i,files:a,dropRef:x}):null]})}_e.propTypes={name:l().string.isRequired,id:l().string.isRequired,folders:l().array.isRequired,docs:l().array.isRequired,files:l().array.isRequired};var Ee=_e,Ce=r(50325);function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Re(e){return function(e){if(Array.isArray(e))return Pe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pe(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(r),!0).forEach((function(t){Ie(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ie(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ke(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ke(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ke(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e){var t=e.folders,r=e.docs,n=e.files,i=e.classes,o=void 0===i?{}:i,a=e.dropRef,l=void 0===a?null:a,u=e.children,c=e.dataTestId;n=n.map((function(e){return Te(Te({},e),{},{isFile:!0})}));var s=[].concat(Re(r),Re(n));return(0,E.jsxs)("ul",{className:$()("list-unstyled",o.root),role:"tree",ref:l,"dnd-container":"true","data-testid":c,children:[t.sort(De).map((function(e){return(0,E.jsx)(Ee,{name:e.name,id:e._id,folders:e.folders,docs:e.docs,files:e.fileRefs},e._id)})),s.sort(De).map((function(e){return(0,E.jsx)(ve,{name:e.name,id:e._id,isFile:e.isFile,isLinkedFile:e.linkedFileData&&!!e.linkedFileData.provider},e._id)})),u]})}function De(e,t){return Ce.W.compare(e.name,t.name)}Fe.propTypes={folders:l().array.isRequired,docs:l().array.isRequired,files:l().array.isRequired,classes:l().exact({root:l().string}),dropRef:l().func,children:l().node,dataTestId:l().string};var Ne=Fe,Le=r(96227),Me=r(63584),Ze=r(24958);var qe={permissionsLevel:l().oneOf(["readOnly","readAndWrite","owner"])};function Ue(){var e=(0,h.$G)().t,t=(0,d.Z)(),r=t.canCreate,n=t.startCreatingFolder,i=t.startCreatingDocOrFile,o=t.startUploadingDocOrFile;return r?(0,E.jsxs)("div",{className:"toolbar-left",children:[(0,E.jsx)(Ze.Z,{id:"new-file",description:e("new_file"),overlayProps:{placement:"bottom"},children:(0,E.jsx)(Me.Z,{onClick:function(){Le.sendMB("new-file-click",{location:"toolbar"}),i()},bsStyle:null,children:(0,E.jsx)(ne.Z,{type:"file",fw:!0,accessibilityLabel:e("new_file")})})}),(0,E.jsx)(Ze.Z,{id:"new-folder",description:e("new_folder"),overlayProps:{placement:"bottom"},children:(0,E.jsx)(Me.Z,{onClick:n,bsStyle:null,children:(0,E.jsx)(ne.Z,{type:"folder",fw:!0,accessibilityLabel:e("new_folder")})})}),(0,E.jsx)(Ze.Z,{id:"upload",description:e("upload"),overlayProps:{placement:"bottom"},children:(0,E.jsx)(Me.Z,{onClick:function(){Le.sendMB("upload-click",{location:"toolbar"}),o()},children:(0,E.jsx)(ne.Z,{type:"upload",fw:!0,accessibilityLabel:e("upload")})})})]}):null}function Ge(){var e=(0,h.$G)().t,t=(0,d.Z)(),r=t.canRename,n=t.canDelete,i=t.startRenaming,o=t.startDeleting;return r||n?(0,E.jsxs)("div",{className:"toolbar-right",children:[r?(0,E.jsx)(Ze.Z,{id:"rename",description:e("rename"),overlayProps:{placement:"bottom"},children:(0,E.jsx)(Me.Z,{onClick:i,children:(0,E.jsx)(ne.Z,{type:"pencil",fw:!0,accessibilityLabel:e("rename")})})}):null,n?(0,E.jsx)(Ze.Z,{id:"delete",description:e("delete"),overlayProps:{placement:"bottom"},children:(0,E.jsx)(Me.Z,{onClick:o,children:(0,E.jsx)(ne.Z,{type:"trash-o",fw:!0,accessibilityLabel:e("delete")})})}):null]}):null}var Ve=function(){return"readOnly"===(0,_._i)(qe).permissionsLevel?null:(0,E.jsxs)("div",{className:"toolbar toolbar-filetree",children:[(0,E.jsx)(Ue,{}),(0,E.jsx)(Ge,{})]})},$e=r(17631),Be=r(11685);var He=function(){var e=(0,h.$G)().t,t=(0,d.Z)(),r=t.isDeleting,n=t.inFlight,i=t.finishDeleting,o=t.actionedEntities,a=t.cancel,l=t.error;if(!r)return null;function u(){a()}return(0,E.jsxs)(Be.Z,{show:!0,onHide:u,children:[(0,E.jsx)($e.Z.Header,{children:(0,E.jsx)($e.Z.Title,{children:e("delete")})}),(0,E.jsxs)($e.Z.Body,{children:[(0,E.jsx)("p",{children:e("sure_you_want_to_delete")}),(0,E.jsx)("ul",{children:o.map((function(e){return(0,E.jsx)("li",{children:e.name},e._id)}))}),l&&(0,E.jsx)("div",{className:"alert alert-danger file-tree-modal-alert",children:e("generic_something_went_wrong")})]}),(0,E.jsx)($e.Z.Footer,{children:n?(0,E.jsxs)(Me.Z,{bsStyle:"danger",disabled:!0,children:[e("deleting"),"…"]}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Me.Z,{bsStyle:null,className:"btn-secondary",onClick:u,children:e("cancel")}),(0,E.jsx)(Me.Z,{bsStyle:"danger",onClick:function(){i()},children:e("delete")})]})})]})},ze=(r(45794),r(17776)),Ke=r(61416);function We(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ye(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ye(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Je(e){var t=e.name,r=e.setName,n=e.validName,i=e.setValidName,o=e.handleCreateFolder,a=(0,Y.Z)().autoFocusedRef;return(0,E.jsx)("input",{ref:a,className:"form-control",type:"text",value:t,onKeyDown:function(e){"Enter"===e.key&&n&&o()},onChange:function(e){i((0,Ke.AG)(e.target.value.trim())),r(e.target.value)},onFocus:function(e){e.target.setSelectionRange(0,-1)}})}Je.propTypes={name:l().string.isRequired,setName:l().func.isRequired,validName:l().bool.isRequired,setValidName:l().func.isRequired,handleCreateFolder:l().func.isRequired};var Xe=function(){var e=(0,h.$G)().t,t=We((0,o.useState)(""),2),r=t[0],n=t[1],i=We((0,o.useState)(!0),2),a=i[0],l=i[1],u=(0,d.Z)(),c=u.isCreatingFolder,s=u.inFlight,f=u.finishCreatingFolder,p=u.cancel,y=u.error;if((0,o.useEffect)((function(){c||n("")}),[c]),!c)return null;function m(){p()}function v(){f(r)}function b(){return y.constructor===ze.w4?e("file_already_exists"):e("generic_something_went_wrong")}return(0,E.jsxs)(Be.Z,{show:!0,onHide:m,children:[(0,E.jsx)($e.Z.Header,{children:(0,E.jsx)($e.Z.Title,{children:e("new_folder")})}),(0,E.jsxs)($e.Z.Body,{children:[(0,E.jsx)(Je,{name:r,setName:n,validName:a,setValidName:l,handleCreateFolder:v}),a?null:(0,E.jsx)("div",{role:"alert","aria-label":e("files_cannot_include_invalid_characters"),className:"alert alert-danger file-tree-modal-alert",children:e("files_cannot_include_invalid_characters")}),y?(0,E.jsx)("div",{role:"alert","aria-label":b(),className:"alert alert-danger file-tree-modal-alert",children:b()}):null]}),(0,E.jsx)($e.Z.Footer,{children:s?(0,E.jsxs)(Me.Z,{bsStyle:"primary",disabled:!0,children:[e("creating"),"…"]}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Me.Z,{bsStyle:null,className:"btn-secondary",onClick:m,children:e("cancel")}),(0,E.jsx)(Me.Z,{bsStyle:"primary",onClick:v,disabled:!a,children:e("create")})]})})]})};var Qe=function FileTreeModalError(){var e=(0,h.$G)().t,t=(0,d.Z)(),r=t.isRenaming,n=t.isMoving,i=t.cancel,o=t.error;if(!o)return null;if(!r&&!n)return null;function a(){i()}function l(){switch(o.constructor){case ze.w4:return e("file_already_exists");case ze.d9:return(0,E.jsx)(h.cC,{i18nKey:"file_already_exists_in_this_location",components:[(0,E.jsx)("strong",{})],values:{fileName:o.entityName},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}});case ze.I9:return e("files_cannot_include_invalid_characters");case ze.Cr:return e("blocked_filename");default:return e("generic_something_went_wrong")}}return(0,E.jsxs)($e.Z,{show:!0,onHide:a,children:[(0,E.jsx)($e.Z.Header,{children:(0,E.jsx)($e.Z.Title,{children:function(){switch(o.constructor){case ze.w4:case ze.d9:return e("duplicate_file");case ze.I9:case ze.Cr:return e("invalid_file_name");default:return e("error")}}()})}),(0,E.jsx)($e.Z.Body,{children:(0,E.jsx)("div",{role:"alert","aria-label":l(),children:l()})}),(0,E.jsx)($e.Z.Footer,{children:(0,E.jsx)(Me.Z,{onClick:a,bsStyle:"primary",children:e("ok")})})]})},et=r(28316),tt=r(82752),rt=r(13253);var nt=function(){var e=(0,h.$G)().t,t=(0,d.Z)(),r=t.canRename,n=t.canDelete,i=t.canCreate,o=t.startRenaming,a=t.startDeleting,l=t.startCreatingFolder,u=t.startCreatingDocOrFile,c=t.startUploadingDocOrFile,s=t.downloadPath;return(0,E.jsxs)(E.Fragment,{children:[r?(0,E.jsx)(rt.Z,{onClick:o,children:e("rename")}):null,s?(0,E.jsx)(rt.Z,{href:s,download:!0,children:e("download")}):null,n?(0,E.jsx)(rt.Z,{onClick:a,children:e("delete")}):null,i?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(rt.Z,{divider:!0}),(0,E.jsx)(rt.Z,{onClick:function(){Le.sendMB("new-file-click",{location:"file-menu"}),u()},children:e("new_file")}),(0,E.jsx)(rt.Z,{onClick:l,children:e("new_folder")}),(0,E.jsx)(rt.Z,{onClick:function(){Le.sendMB("upload-click",{location:"file-menu"}),c()},children:e("upload")})]}):null]})};var it={permissionsLevel:l().oneOf(["readOnly","readAndWrite","owner"])},ot=o.forwardRef((function(e,t){return null}));ot.displayName="FakeDropDownToggle";var at=function(){var e=(0,_._i)(it).permissionsLevel,t=(0,f.e)(),r=t.contextMenuCoords,n=t.setContextMenuCoords;if("readOnly"===e||!r)return null;function i(e){e||n(null)}return et.createPortal((0,E.jsxs)(tt.Z,{onClick:function(){i(!1)},open:!0,id:"dropdown-file-tree-context-menu",onToggle:i,children:[(0,E.jsx)(ot,{bsRole:"toggle"}),(0,E.jsx)(tt.Z.Menu,{className:"context-menu",style:r,children:(0,E.jsx)(nt,{})})]}),document.querySelector("body"))},lt=r(46267);var ut=function FileTreeError(){var e=(0,h.$G)().t,t=(0,lt.T)().reload;return(0,E.jsxs)("div",{className:"file-tree-error",children:[(0,E.jsx)("p",{children:e("generic_something_went_wrong")}),(0,E.jsx)("p",{children:e("please_refresh")}),(0,E.jsx)(Me.Z,{bsStyle:"primary",onClick:t,children:e("refresh")})]})},ct=(r(39529),r(31235),r(80564)),st=r(96931);function ft(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return dt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dt(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ht(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ht(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var yt=(0,o.createContext)(),mt=function(){var e=(0,o.useContext)(yt);if(!e)throw new Error("useFileTreeCreateForm is only available inside FileTreeCreateFormProvider");return e};function vt(e){var t=e.children,r=pt((0,o.useState)(!1),2),n=r[0],i=r[1];return(0,E.jsx)(yt.Provider,{value:{valid:n,setValid:i},children:t})}vt.propTypes={children:l().oneOfType([l().arrayOf(l().node),l().node]).isRequired};r(73439);function bt(e){var t=e.mode,r=e.icon,n=e.label,i=(0,d.Z)(),o=i.newFileCreateMode,a=i.startCreatingFile;return(0,E.jsx)("li",{className:$()({active:o===t}),children:(0,E.jsxs)(Me.Z,{bsStyle:"link",block:!0,onClick:function(){a(t),Le.sendMB("file-modal-click",{method:t})},className:"modal-new-file-mode",children:[(0,E.jsx)(ne.Z,{type:r,fw:!0})," ",n]})})}function gt(e){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(e)}function jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function wt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(r),!0).forEach((function(t){xt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==gt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===gt(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function St(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ot(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ot(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}bt.propTypes={mode:l().string.isRequired,icon:l().string.isRequired,label:l().string.isRequired};var _t=(0,o.createContext)(),Et=function(){var e=(0,o.useContext)(_t);if(!e)throw new Error("useFileTreeCreateName is only available inside FileTreeCreateNameProvider");return e};function Ct(e){var t=e.children,r=e.initialName,n=void 0===r?"":r,i=St((0,o.useReducer)((function(e,t){return{name:t,touchedName:!0}}),{name:n,touchedName:!1}),2),a=i[0],l=i[1],u=(0,o.useMemo)((function(){return(0,Ke.AG)(a.name.trim())}),[a]);return(0,E.jsx)(_t.Provider,{value:wt(wt({},a),{},{setName:l,validName:u}),children:t})}Ct.propTypes={children:l().oneOfType([l().arrayOf(l().node),l().node]).isRequired,initialName:l().string};var kt=r(86186),Rt=r(99262),Pt=r(72300),At=r(87731),Tt=(r(21515),r(28684)),It=r(30286);function Ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Nt=r(10726),Lt=r.n(Nt),Mt=r(88664),Zt=r.n(Mt);function qt(e){var t=e.label,r=e.focusName,n=void 0!==r&&r,i=e.classes,a=void 0===i?{}:i,l=e.placeholder,u=e.error,c=(0,h.$G)().t,s=Et(),f=s.name,d=s.setName,p=s.touchedName,y=s.validName,m=(0,o.useCallback)((function(e){e&&n&&window.requestAnimationFrame((function(){e.focus(),e.setSelectionRange(0,e.value.lastIndexOf("."))}))}),[n]);return(0,E.jsxs)(Zt(),{controlId:"new-doc-name",className:a.formGroup,children:[(0,E.jsx)(Lt(),{children:t||c("file_name")}),(0,E.jsx)(At.Z,{type:"text",placeholder:l||c("file_name"),required:!0,value:f,onChange:function(e){return d(e.target.value)},inputRef:m}),(0,E.jsx)(At.Z.Feedback,{}),p&&!y&&(0,E.jsx)(kt.Z,{bsStyle:"danger",className:"row-spaced-small",children:c("files_cannot_include_invalid_characters")}),u&&(0,E.jsx)(Ut,{error:u})]})}function Ut(e){var t=e.error,r=(0,h.$G)().t;switch(t.constructor){case ze.w4:return(0,E.jsx)(kt.Z,{bsStyle:"danger",className:"row-spaced-small",children:r("file_already_exists")});case ze.I9:return(0,E.jsx)(kt.Z,{bsStyle:"danger",className:"row-spaced-small",children:r("files_cannot_include_invalid_characters")});case ze.Cr:return(0,E.jsx)(kt.Z,{bsStyle:"danger",className:"row-spaced-small",children:r("blocked_filename")});default:return null}}qt.propTypes={focusName:l().bool,label:l().string,classes:l().shape({formGroup:l().string}),placeholder:l().string,error:l().oneOfType([l().object,l().string])},Ut.propTypes={error:l().oneOfType([l().object,l().string]).isRequired};var Gt=r(13516),Vt=r(36190),$t=r(92910);function Bt(e){var t=e.provider,r=e.data,n=e.selectedGroupId,i=e.setSelectedGroupId,o=(0,h.$G)().t;switch(t){case"mendeley":return(0,E.jsxs)(Rt.Z,{controlId:"group-select",children:[(0,E.jsx)(Pt.Z,{children:o("select_a_group_optional")}),(0,E.jsxs)(At.Z,{className:"form-control",componentClass:"select",placeholder:o("select_a_group_optional"),value:n||"",onChange:function(e){return i(e.target.value)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",o("select_a_group_optional")]}),r.map((function(e){return(0,E.jsx)("option",{value:e.id,children:e.name},e.id)}))]})]});case"zotero":return(0,E.jsxs)(Rt.Z,{controlId:"group-select",children:[(0,E.jsx)(Pt.Z,{children:o("library")}),(0,E.jsxs)(At.Z,{className:"form-control",componentClass:"select",value:n||"",onChange:function(e){return i(e.target.value)},children:[(0,E.jsx)("option",{value:"",children:o("my_library")}),(0,E.jsx)("option",{disabled:!0,value:"_",children:o("group_libraries")}),r.map((function(e){return(0,E.jsx)("option",{value:e.id,children:e.name},e.id)}))]})]});default:throw new Error('Unknown reference provider "'.concat(t,'"'))}}Bt.propTypes={provider:l().string.isRequired,data:l().arrayOf(l().object).isRequired,selectedGroupId:l().string,setSelectedGroupId:l().func.isRequired};var Ht=r(70887);function zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Kt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Wt(e){var t,r=e.provider,n=e.providerName,i=e.supportsGroups,a=void 0!==i&&i,l=e.supportsFormat,u=void 0!==l&&l,c=(0,h.$G)().t,s=Et(),p=s.name,y=s.validName,m=mt().setValid,v=(0,ct.SE)(Yt).features,b=(0,f.e)(),g=b.refProviders,j=b.setStartedFreeTrial,w=b.setRefProviderEnabled,x=(0,d.Z)(),S=x.error,O=x.finishCreatingLinkedFile,_=x.inFlight,C=(0,f.e)().reindexReferences,k=zt((0,o.useState)(""),2),R=k[0],P=k[1],A=zt((0,o.useState)("bibtex"),2),T=A[0],I=A[1];(0,Ht.K)((0,o.useCallback)((function(e){e.refProviders&&r in e.refProviders&&(w(r,!1),window.setTimeout((function(){w(r,e.refProviders[r])})))}),[r,w]));var F=v.references||v[r],D=F&&g[r],N=(0,o.useCallback)((function(){window.open("/".concat(r,"/oauth"),"reference-auth","width=700,height=500")}),[r]),L=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ft((0,o.useState)(!1),2),n=r[0],i=r[1],a=Ft((0,o.useState)(null),2),l=a[0],u=a[1],c=Ft((0,o.useState)(null),2),s=c[0],f=c[1],d=(0,It.Z)().signal;return(0,o.useEffect)((function(){t&&(i(!0),f(null),u(null),(0,Tt.xA)("/".concat(e,"/groups"),{signal:d}).then((function(e){u(e.groups)})).catch((function(e){400===e.response.status?e.data.relink&&f("relink"):f("loading_groups")})).finally((function(){i(!1)})))}),[t,e,d]),{loading:n,data:l,error:s}}(r,a&&D);(0,o.useEffect)((function(){m(y&&D&&!L.error)}),[m,y,D,L.error]);var M=(0,o.useCallback)((function(e){e.preventDefault();var t={};R&&(t.group_id=R),u&&(t.format=T),O({name:p,provider:r,data:t}).then(C),Le.sendMB("new-file-created",{method:r})}),[p,R,r,O,T,C,u]);return F?(0,E.jsxs)("div",{className:"referencesImportModal",children:[D?(0,E.jsxs)("div",{children:[L.loading?(0,E.jsx)("div",{children:(0,E.jsx)("h2",{className:"text-center",children:(0,E.jsxs)("small",{children:[(0,E.jsx)(ne.Z,{type:"refresh",spin:!0,fw:!0})," ",c("loading"),"…"]})})}):(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:c("import_a_bibtex_file_from_your_provider_account",{provider:n})}),(0,E.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:M,children:[L.error&&(0,E.jsx)(Xt,{provider:r,error:L.error,linkAccount:N}),L.data&&L.data.length>0&&(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsx)(Bt,{provider:r,data:L.data,selectedGroupId:R,setSelectedGroupId:P})}),(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsx)(qt,{label:c("file_name_in_this_project"),focusName:!0,error:S})}),u&&(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsxs)(Rt.Z,{controlId:"format",children:[(0,E.jsx)(Pt.Z,{children:c("format")}),(0,E.jsxs)(At.Z,{className:"form-control",componentClass:"select",value:T,onChange:function(e){return I(e.target.value)},children:[(0,E.jsx)("option",{value:"bibtex",children:"BibTeX"}),(0,E.jsx)("option",{value:"biblatex",children:"BibLaTeX"})]})]})})]})]}),_&&(0,E.jsx)("h3",{className:"text-center",children:(0,E.jsxs)("small",{children:[(0,E.jsx)(ne.Z,{type:"refresh",spin:!0,fw:!0})," ",c("importing"),"…"]})})]}):(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:Jt[r].sync_description(c)}),(0,E.jsx)("p",{children:(0,E.jsx)(Me.Z,{bsStyle:"info",type:"button",onClick:N,children:Jt[r].link_to(c)})})]}),S&&(0,E.jsx)(E.Fragment,{children:"string"==typeof S?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("div",{className:"text-center",children:[(0,E.jsx)("hr",{}),(0,E.jsx)(Xt,{error:S,provider:r,linkAccount:N})]}),(0,E.jsx)(er,{error:S,provider:r,linkAccount:N})]}):null!==(t=S.data)&&void 0!==t&&t.relink?(0,E.jsx)(Qt,{provider:r,linkAccount:N}):(0,E.jsx)(Gt.Z,{error:S})})]}):(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{className:"small",children:Jt[r].sync_description(c)}),(0,E.jsxs)(kt.Z,{bsStyle:"info",children:[(0,E.jsx)("p",{children:Jt[r].is_premium(c)}),(0,E.jsx)("p",{children:(0,E.jsx)($t.Z,{source:r,buttonProps:{bsStyle:"info"},handleClick:function(){return j(!0)}})})]})]})}Wt.propTypes={provider:l().string.isRequired,providerName:l().string.isRequired,supportsGroups:l().bool,supportsFormat:l().bool};var Yt={features:l().shape({references:l().bool,mendeley:l().bool,zotero:l().bool})},Jt={mendeley:{default:function(e){return e("mendeley_reference_loading_error")},expired:function(e){return e("mendeley_reference_loading_error_expired")},forbidden:function(e){return e("mendeley_reference_loading_error_forbidden")},"refresh-failed":function(e){return e("mendeley_reference_loading_error_expired")},sync_description:function(e){return e("mendeley_sync_description")},link_to:function(e){return e("link_to_mendeley")},is_premium:function(e){return e("mendeley_is_premium")},loading_groups:function(e){return e("mendeley_groups_loading_error")},relink:function(e){return e("mendeley_groups_relink")}},zotero:{default:function(e){return e("zotero_reference_loading_error")},expired:function(e){return e("zotero_reference_loading_error_expired")},forbidden:function(e){return e("zotero_reference_loading_error_forbidden")},"refresh-failed":function(e){return e("zotero_reference_loading_error_expired")},sync_description:function(e){return e("zotero_sync_description")},link_to:function(e){return e("link_to_zotero")},is_premium:function(e){return e("zotero_is_premium")},loading_groups:function(e){return e("zotero_groups_loading_error")},relink:function(e){return e("zotero_groups_relink")}}};function Xt(e){var t=e.provider,r=e.error,n=e.linkAccount,i=(0,h.$G)().t;return"relink"===r?(0,E.jsx)(Qt,{provider:t,linkAccount:n}):r in Jt[t]?(0,E.jsx)(Vt.Z,{children:Jt[t][r](i)}):(0,E.jsx)(Gt.Z,{error:r})}function Qt(e){var t=e.provider,r=e.linkAccount,n=(0,h.$G)().t;return(0,E.jsxs)(Vt.Z,{children:[(0,E.jsx)("div",{children:Jt[t].relink(n)}),(0,E.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:10},children:(0,E.jsx)(Me.Z,{bsStyle:"danger",type:"button",onClick:r,children:n("relink_your_account")})})]})}function er(e){var t=e.error,r=e.provider,n=e.linkAccount,i=(0,h.$G)().t;switch(t){case"refresh-failed":return(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:Jt[r].sync_description(i)}),(0,E.jsx)("p",{children:(0,E.jsx)(Me.Z,{bsStyle:"info",type:"button",onClick:n,children:Jt[r].link_to(i)})})]});case"default":case"expired":case"forbidden":return(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{children:[i("reference_error_relink_hint"),"  "]}),(0,E.jsx)("div",{children:(0,E.jsx)("a",{href:"/user/settings",target:"_blank",rel:"noopener",style:{fontWeight:"bold"},children:i("account_settings")})})]})}}function tr(){var e=(0,h.$G)().t;return(0,E.jsx)(bt,{mode:"mendeley",icon:"book",label:e("from_provider",{provider:"Mendeley"})})}function rr(){return"mendeley"!==(0,d.Z)().newFileCreateMode?null:(0,E.jsx)(Ct,{initialName:"references.bib",children:(0,E.jsx)(Wt,{provider:"mendeley",providerName:"Mendeley",supportsGroups:!0})})}function nr(){var e=(0,h.$G)().t;return(0,E.jsx)(bt,{mode:"zotero",icon:"book",label:e("from_provider",{provider:"Zotero"})})}function ir(){return"zotero"!==(0,d.Z)().newFileCreateMode?null:(0,E.jsx)(Ct,{initialName:"references.bib",children:(0,E.jsx)(Wt,{provider:"zotero",providerName:"Zotero",supportsGroups:!0,supportsFormat:!0})})}function or(){var e=Et(),t=e.name,r=e.validName,n=mt().setValid,i=(0,d.Z)(),a=i.error,l=i.finishCreatingDoc;(0,o.useEffect)((function(){n(r)}),[n,r]);var u=(0,o.useCallback)((function(e){e.preventDefault(),l({name:t}),Le.sendMB("new-file-created",{method:"doc"})}),[l,t]);return(0,E.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:u,children:[(0,E.jsx)(qt,{focusName:!0,error:a}),a&&(0,E.jsx)(Gt.Z,{error:a})]})}Xt.propTypes={error:l().string.isRequired,provider:l().string.isRequired,linkAccount:l().func.isRequired},Qt.propTypes={provider:l().string.isRequired,linkAccount:l().func.isRequired},er.propTypes={error:l().string.isRequired,provider:l().string.isRequired,linkAccount:l().func.isRequired};r(74069);function ar(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ur(){var e=(0,h.$G)().t,t=Et(),r=t.name,n=t.setName,i=t.validName,a=mt().setValid,l=(0,d.Z)(),u=l.finishCreatingLinkedFile,c=l.error,s=ar((0,o.useState)(""),2),f=s[0],p=s[1],y=(0,o.useCallback)((function(e){p(e.target.value)}),[]);(0,o.useEffect)((function(){if(f){var e=f.match(/^\s*https?:\/\/.+\/([^/]+\.(\w+))\s*$/);n(e?e[1]:"")}}),[n,f]),(0,o.useEffect)((function(){a(i&&!!f)}),[a,i,f]);return(0,E.jsxs)("form",{className:"form-controls",id:"create-file",noValidate:!0,onSubmit:function(e){e.preventDefault(),Le.sendMB("new-file-created",{method:"url"}),u({name:r,provider:"url",data:{url:f.trim()}})},children:[(0,E.jsxs)(Rt.Z,{controlId:"import-from-url",children:[(0,E.jsx)(Pt.Z,{children:e("url_to_fetch_the_file_from")}),(0,E.jsx)(At.Z,{type:"url",placeholder:"https://example.com/my-file.png",required:!0,value:f,onChange:y})]}),(0,E.jsx)(qt,{label:e("file_name_in_this_project"),placeholder:"my_file",error:c}),c&&(0,E.jsx)(Gt.Z,{error:c})]})}r(49228);var cr=r(87983),sr=r(15270),fr=r(25137);function dr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function hr(){var e=(0,h.$G)().t,t=window.ExposedSettings,r=t.hasLinkedProjectFileFeature,n=t.hasLinkedProjectOutputFileFeature,i=r&&n,a=Et(),l=a.name,u=a.setName,c=a.validName,s=mt().setValid,f=(0,d.Z)(),p=f.error,y=f.finishCreatingLinkedFile,m=dr((0,o.useState)(),2),v=m[0],b=m[1],g=dr((0,o.useState)(),2),j=g[0],w=g[1],x=dr((0,o.useState)(),2),S=x[0],O=x[1],_=dr((0,o.useState)(!r),2),C=_[0],k=_[1],R=(0,o.useCallback)((function(e){var t=e.split("/").pop();t&&u(t)}),[u]);(0,o.useEffect)((function(){S&&("output.pdf"===S.path&&v.name?u("".concat(v.name,".pdf")):R(S.path))}),[v,S,u,R]),(0,o.useEffect)((function(){j&&R(j.path)}),[j,R]),(0,o.useEffect)((function(){var e=Boolean(C?S:j);s(c&&e)}),[s,c,C,j,S]);return(0,E.jsxs)("form",{className:"form-controls",id:"create-file",onSubmit:function(e){e.preventDefault(),Le.sendMB("new-file-created",{method:"project"}),y(C?{name:l,provider:"project_output_file",data:{source_project_id:v._id,source_output_file_path:S.path,build_id:S.build,clsiServerId:S.clsiServerId}}:{name:l,provider:"project_file",data:{source_project_id:v._id,source_entity_path:j.path}})},children:[(0,E.jsx)(yr,{selectedProject:v,setSelectedProject:b}),C?(0,E.jsx)(vr,{selectedProjectId:null==v?void 0:v._id,selectedProjectOutputFile:S,setSelectedProjectOutputFile:O}):(0,E.jsx)(br,{selectedProjectId:null==v?void 0:v._id,selectedProjectEntity:j,setSelectedProjectEntity:w}),i&&(0,E.jsxs)("div",{className:"toggle-file-type-button",children:["or ",(0,E.jsx)(Me.Z,{bsStyle:"link",type:"button",onClick:function(){return k((function(e){return!e}))},children:(0,E.jsx)("span",{children:e(C?"select_from_source_files":"select_from_output_files")})})]}),(0,E.jsx)(qt,{label:e("file_name_in_this_project"),classes:{formGroup:"form-controls row-spaced-small"},placeholder:"example.tex",error:p}),p&&(0,E.jsx)(Gt.Z,{error:p})]})}function yr(e){var t=e.selectedProject,r=e.setSelectedProject,n=(0,h.$G)().t,i=(0,c.d2)(mr)._id,a=(0,cr.Z)(),l=a.data,u=a.error,s=a.loading,f=(0,o.useMemo)((function(){return l?l.filter((function(e){return e._id!==i})):null}),[l,i]);return u?(0,E.jsx)(Gt.Z,{error:u}):(0,E.jsxs)(Rt.Z,{className:"form-controls",controlId:"project-select",children:[(0,E.jsx)(Pt.Z,{children:n("select_a_project")}),s&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ne.Z,{type:"spinner",spin:!0})]}),(0,E.jsxs)(At.Z,{componentClass:"select",disabled:!l,value:t?t._id:"",onChange:function(e){var t=e.target.value,n=l.find((function(e){return e._id===t}));r(n)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",n("please_select_a_project")]}),f&&f.map((function(e){return(0,E.jsx)("option",{value:e._id,children:e.name},e._id)}))]}),f&&!f.length&&(0,E.jsx)("small",{children:n("no_other_projects_found")})]})}yr.propTypes={selectedProject:l().object,setSelectedProject:l().func.isRequired};var mr={_id:l().string.isRequired};function vr(e){var t=e.selectedProjectId,r=e.selectedProjectOutputFile,n=e.setSelectedProjectOutputFile,i=(0,h.$G)().t,o=(0,fr.h)(t),a=o.data,l=o.error,u=o.loading;return l?(0,E.jsx)(Gt.Z,{error:l}):(0,E.jsxs)(Rt.Z,{className:"form-controls row-spaced-small",controlId:"project-output-file-select",children:[(0,E.jsx)(Pt.Z,{children:i("select_an_output_file")}),u&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ne.Z,{type:"spinner",spin:!0})]}),(0,E.jsxs)(At.Z,{componentClass:"select",disabled:!a,value:(null==r?void 0:r.path)||"",onChange:function(e){var t=e.target.value,r=a.find((function(e){return e.path===t}));n(r)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",i("please_select_an_output_file")]}),a&&a.map((function(e){return(0,E.jsx)("option",{value:e.path,children:e.path},e.path)}))]})]})}function br(e){var t=e.selectedProjectId,r=e.selectedProjectEntity,n=e.setSelectedProjectEntity,i=(0,h.$G)().t,o=(0,sr.t)(t),a=o.data,l=o.error,u=o.loading;return l?(0,E.jsx)(Gt.Z,{error:l}):(0,E.jsxs)(Rt.Z,{className:"form-controls row-spaced-small",controlId:"project-entity-select",children:[(0,E.jsx)(Pt.Z,{children:i("select_a_file")}),u&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ne.Z,{type:"spinner",spin:!0})]}),(0,E.jsxs)(At.Z,{componentClass:"select",disabled:!a,value:(null==r?void 0:r.path)||"",onChange:function(e){var t=e.target.value,r=a.find((function(e){return e.path===t}));n(r)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",i("please_select_a_file")]}),a&&a.map((function(e){return(0,E.jsx)("option",{value:e.path,children:e.path.slice(1)},e.path)}))]})]})}vr.propTypes={selectedProjectId:l().string,selectedProjectOutputFile:l().object,setSelectedProjectOutputFile:l().func.isRequired},br.propTypes={selectedProjectId:l().string,selectedProjectEntity:l().object,setSelectedProjectEntity:l().func.isRequired};var gr=r(28500),jr=[{import:n,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-mendeley"},{import:i,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-zotero"}],wr=(0,o.lazy)((function(){return Promise.all([r.e(4900),r.e(8931)]).then(r.bind(r,58931))}));function xr(){var e=(0,h.$G)().t,t=(0,d.Z)().newFileCreateMode,r=(0,s.O)().fileCount;return r&&"error"!==r.status?(0,E.jsx)("table",{children:(0,E.jsx)("tbody",{children:(0,E.jsxs)("tr",{children:[(0,E.jsx)("td",{className:"modal-new-file--list",children:(0,E.jsxs)("ul",{className:"list-unstyled",children:[(0,E.jsx)(bt,{mode:"doc",icon:"file",label:e("new_file")}),(0,E.jsx)(bt,{mode:"upload",icon:"upload",label:e("upload")}),(window.ExposedSettings.hasLinkedProjectFileFeature||window.ExposedSettings.hasLinkedProjectOutputFileFeature)&&(0,E.jsx)(bt,{mode:"project",icon:"folder-open",label:e("from_another_project")}),window.ExposedSettings.hasLinkUrlFeature&&(0,E.jsx)(bt,{mode:"url",icon:"globe",label:e("from_external_url")}),jr.map((function(e){var t=e.import.CreateFileMode,r=e.path;return(0,E.jsx)(t,{},r)}))]})}),(0,E.jsxs)("td",{className:"modal-new-file--body modal-new-file--body-".concat(t),children:["doc"===t&&(0,E.jsx)(Ct,{initialName:"name.tex",children:(0,E.jsx)(or,{})}),"url"===t&&(0,E.jsx)(Ct,{children:(0,E.jsx)(ur,{})}),"project"===t&&(0,E.jsx)(Ct,{children:(0,E.jsx)(hr,{})}),"upload"===t&&(0,E.jsx)(o.Suspense,{fallback:(0,E.jsx)(gr.w,{delay:500}),children:(0,E.jsx)(wr,{})}),jr.map((function(e){var t=e.import.CreateFilePane,r=e.path;return(0,E.jsx)(t,{},r)}))]})]})})}):null}function Sr(){var e=mt().valid,t=(0,d.Z)(),r=t.newFileCreateMode,n=t.inFlight,i=t.cancel,o=(0,s.O)().fileCount;return(0,E.jsx)(Or,{valid:e,cancel:i,newFileCreateMode:r,inFlight:n,fileCount:o})}function Or(e){var t=e.valid,r=e.fileCount,n=e.inFlight,i=e.newFileCreateMode,o=e.cancel,a=(0,h.$G)().t;return(0,E.jsxs)(E.Fragment,{children:["warning"===r.status&&(0,E.jsxs)("div",{className:"modal-footer-left approaching-file-limit",children:[a("project_approaching_file_limit")," (",r.value,"/",r.limit,")"]}),"error"===r.status&&(0,E.jsx)(kt.Z,{bsStyle:"warning",className:"at-file-limit",children:a("project_has_too_many_files")}),(0,E.jsx)(Me.Z,{bsStyle:null,className:"btn-secondary",type:"button",disabled:n,onClick:o,children:a("cancel")}),"upload"!==i&&(0,E.jsx)(Me.Z,{bsStyle:"primary",type:"submit",form:"create-file",disabled:n||!t,children:(0,E.jsx)("span",{children:n?"".concat(a("creating"),"…"):a("create")})})]})}function _r(){var e=(0,h.$G)().t,t=(0,d.Z)(),r=t.isCreatingFile,n=t.cancel;return r?(0,E.jsx)(vt,{children:(0,E.jsxs)(Be.Z,{bsSize:"large",onHide:n,show:!0,children:[(0,E.jsx)($e.Z.Header,{closeButton:!0,children:(0,E.jsx)($e.Z.Title,{children:e("add_files")})}),(0,E.jsx)($e.Z.Body,{className:"modal-new-file",children:(0,E.jsx)(xr,{})}),(0,E.jsx)($e.Z.Footer,{children:(0,E.jsx)(Sr,{})})]})}):null}Or.propTypes={cancel:l().func.isRequired,fileCount:l().shape({limit:l().number.isRequired,status:l().string.isRequired,value:l().number.isRequired}).isRequired,inFlight:l().bool.isRequired,newFileCreateMode:l().string,valid:l().bool.isRequired};var Er=function(e){var t=e.children,r=(0,p.nF)().setIsRootFolderSelected,n=(0,o.useCallback)((function(){r(!0)}),[r]);return(0,E.jsx)("div",{className:"file-tree-inner",onClick:n,"data-testid":"file-tree-inner",children:t})},Cr=r(55758);function kr(e){return kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kr(e)}function Rr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rr(Object(r),!0).forEach((function(t){Ar(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ar(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==kr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===kr(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Tr=o.memo((function(e){var t=e.refProviders,r=e.reindexReferences,n=e.setRefProviderEnabled,i=e.setStartedFreeTrial,a=e.onSelect,l=e.onInit,u=e.onDelete,f=e.isConnected,d=(0,c.d2)(Fr)._id,p=(0,s.O)().fileTreeData,h=d&&p;return(0,o.useEffect)((function(){h&&l()}),[h,l]),h?(0,E.jsxs)(G,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:i,reindexReferences:r,onSelect:a,children:[f?null:(0,E.jsx)("div",{className:"disconnected-overlay"}),(0,E.jsx)(Ve,{}),(0,E.jsx)(at,{}),(0,E.jsx)(Er,{children:(0,E.jsx)(Ir,{onDelete:u})}),(0,E.jsx)(He,{}),(0,E.jsx)(_r,{}),(0,E.jsx)(Xe,{}),(0,E.jsx)(Qe,{})]}):null}));function Ir(e){!function(e){var t=(0,ct.SE)({id:l().string.isRequired}),r=(0,s.O)(),n=r.dispatchRename,i=r.dispatchDelete,a=r.dispatchMove,u=r.dispatchCreateFolder,c=r.dispatchCreateDoc,f=r.dispatchCreateFile,d=r.fileTreeData,h=(0,p.nF)(),y=h.selectedEntityIds,m=h.selectedEntityParentIds,v=h.select,b=h.unselect,g=(0,st.I)().socket,j=(0,o.useCallback)((function(e,r,n){n&&(null==t?void 0:t.id)===n&&window.expectingLinkedFileRefreshedSocketFor===r&&(v(e),window.expectingLinkedFileRefreshedSocketFor=null)}),[t,v]);(0,o.useEffect)((function(){function e(e,t){n(e,t)}return g&&g.on("reciveEntityRename",e),function(){g&&g.removeListener("reciveEntityRename",e)}}),[g,n]),(0,o.useEffect)((function(){function t(t){var r=(0,O.Z7)(d,t);if(b(t),m.has(t)){var n,o=ft(y);try{for(o.s();!(n=o.n()).done;){var a=n.value;(0,O.we)(d,a).path.includes(t)&&b(a)}}catch(e){o.e(e)}finally{o.f()}}i(t),e&&e(r)}return g&&g.on("removeEntity",t),function(){g&&g.removeListener("removeEntity",t)}}),[g,b,i,d,y,m,e]),(0,o.useEffect)((function(){function e(e,t){a(e,t)}return g&&g.on("reciveEntityMove",e),function(){g&&g.removeListener("reciveEntityMove",e)}}),[g,a]),(0,o.useEffect)((function(){function e(e,t,r){u(e,t)}return g&&g.on("reciveNewFolder",e),function(){g&&g.removeListener("reciveNewFolder",e)}}),[g,u]),(0,o.useEffect)((function(){function e(e,t,r,n){c(e,t)}return g&&g.on("reciveNewDoc",e),function(){g&&g.removeListener("reciveNewDoc",e)}}),[g,c]),(0,o.useEffect)((function(){function e(e,t,r,n,i){f(e,t),n&&j(t._id,t.name,i)}return g&&g.on("reciveNewFile",e),function(){g&&g.removeListener("reciveNewFile",e)}}),[g,f,j])}(e.onDelete);var t=(0,s.O)().fileTreeData,r=q(t._id),n=r.isOver,i=r.dropRef,a=(0,Cr.f)((function(e){return{isDragging:e.isDragging(),item:e.getItem(),clientOffset:e.getClientOffset()}}));return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(K,Pr({isOver:n},a)),(0,E.jsx)(Ne,{folders:t.folders,docs:t.docs,files:t.fileRefs,classes:{root:$()("file-tree-list",{"file-tree-dragging":a.isDragging})},dropRef:i,dataTestId:"file-tree-list-root"})]})}Ir.propTypes={onDelete:l().func},Tr.propTypes={onSelect:l().func.isRequired,onInit:l().func.isRequired,onDelete:l().func,isConnected:l().bool.isRequired,setRefProviderEnabled:l().func.isRequired,setStartedFreeTrial:l().func.isRequired,reindexReferences:l().func.isRequired,refProviders:l().object.isRequired};var Fr={_id:l().string.isRequired},Dr=(0,u.Z)(Tr,ut)},4134:function(e,t,r){"use strict";r.d(t,{P:function(){return V},Z:function(){return H}});r(71372),r(27233),r(28673),r(26936),r(43450),r(77950),r(21850),r(95342),r(58188),r(49228),r(1939),r(73439),r(18178),r(9575),r(96264),r(34115),r(634),r(71245),r(34769),r(68625),r(36728),r(62775),r(20796),r(15735),r(6886),r(32501),r(88233),r(96882),r(38859),r(17525),r(18275),r(96928);var n=r(2784),i=r(13980),o=r.n(i);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(){l=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},u=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),l=new T(n||[]);return i(a,"_invoke",{value:k(e,r,l)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",y="suspendedYield",m="executing",v="completed",b={};function g(){}function j(){}function w(){}var x={};f(x,u,(function(){return this}));var S=Object.getPrototypeOf,O=S&&S(S(I([])));O&&O!==r&&n.call(O,u)&&(x=O);var _=w.prototype=g.prototype=Object.create(x);function E(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(i,o,l,u){var c=p(e[i],e,o);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==a(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,l,u)}),(function(e){r("throw",e,l,u)})):t.resolve(f).then((function(e){s.value=e,l(s)}),(function(e){return r("throw",e,l,u)}))}u(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function k(t,r,n){var i=h;return function(o,a){if(i===m)throw new Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var l=n.delegate;if(l){var u=R(l,n);if(u){if(u===b)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=m;var c=p(t,r,n);if("normal"===c.type){if(i=n.done?v:y,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=v,n.method="throw",n.arg=c.arg)}}}function R(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,R(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=p(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function I(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(a(t)+" is not iterable")}return j.prototype=w,i(_,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:j,configurable:!0}),j.displayName=f(w,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===j||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},E(C.prototype),f(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new C(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),f(_,s,"Generator"),f(_,u,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=I,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function i(n,i){return l.type="throw",l.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],l=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:I(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},t}function u(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,i,o,a){try{var l=e[o](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,i)}function f(e,t){return e.reduce(function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){s(o,n,i,a,l,"next",e)}function l(e){s(o,n,i,a,l,"throw",e)}a(void 0)}))}}(l().mark((function e(r,n){var i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r;case 2:return i=e.sent,e.next=5,t(n);case 5:return o=e.sent,e.abrupt("return",[].concat(u(i),[o]));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Promise.resolve([]))}var d=r(28684);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}var h=["endpoint"];function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===p(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function g(e,t,r,n){return(0,d.ty)("/project/".concat(e,"/").concat(j(t),"/").concat(r,"/move"),{body:{folder_id:n}})}function j(e){return"fileRef"===e?"file":e}var w=r(38113);function x(e,t,r){return e._id!==t&&(e=(0,w.Z7)(e,t).entity),!e.docs.some((function(e){return e.name===r}))&&(!e.fileRefs.some((function(e){return e.name===r}))&&!e.folders.some((function(e){return e.name===r})))}var S=r(61416),O=r(13364),_=r(22866),E=r(91354),C=r(38485),k=r(17776),R=r(52322);function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function A(){A=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),l=new T(n||[]);return i(a,"_invoke",{value:E(e,r,l)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",y="completed",m={};function v(){}function b(){}function g(){}var j={};c(j,a,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==r&&n.call(x,a)&&(j=x);var S=g.prototype=v.prototype=Object.create(j);function O(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function r(i,o,a,l){var u=f(e[i],e,o);if("throw"!==u.type){var c=u.arg,s=c.value;return s&&"object"==P(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,a,l)}),(function(e){r("throw",e,a,l)})):t.resolve(s).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,l)}))}l(u.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var i=d;return function(o,a){if(i===h)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var l=n.delegate;if(l){var u=C(l,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=h;var c=f(t,r,n);if("normal"===c.type){if(i=n.done?y:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=y,n.method="throw",n.arg=c.arg)}}}function C(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var o=f(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function I(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(P(t)+" is not iterable")}return b.prototype=g,i(S,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},O(_.prototype),c(_.prototype,l,(function(){return this})),t.AsyncIterator=_,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new _(s(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},O(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=I,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function i(n,i){return l.type="throw",l.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],l=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;R(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:I(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function T(e,t,r,n,i,o,a){try{var l=e[o](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,i)}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){L(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function L(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==P(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==P(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===P(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=(0,n.createContext)(),Z={START_RENAME:"START_RENAME",START_DELETE:"START_DELETE",DELETING:"DELETING",START_CREATE_FILE:"START_CREATE_FILE",START_CREATE_FOLDER:"START_CREATE_FOLDER",CREATING_FILE:"CREATING_FILE",CREATING_FOLDER:"CREATING_FOLDER",MOVING:"MOVING",CANCEL:"CANCEL",CLEAR:"CLEAR",ERROR:"ERROR"},q={isDeleting:!1,isRenaming:!1,isCreatingFile:!1,isCreatingFolder:!1,isMoving:!1,inFlight:!1,actionedEntities:null,newFileCreateMode:null,error:null};function U(e){return e}function G(e,t){switch(t.type){case Z.START_RENAME:return N(N({},q),{},{isRenaming:!0});case Z.START_DELETE:return N(N({},q),{},{isDeleting:!0,actionedEntities:t.actionedEntities});case Z.START_CREATE_FILE:return N(N({},q),{},{isCreatingFile:!0,newFileCreateMode:t.newFileCreateMode});case Z.START_CREATE_FOLDER:return N(N({},q),{},{isCreatingFolder:!0});case Z.CREATING_FILE:return N(N({},q),{},{isCreatingFile:!0,newFileCreateMode:e.newFileCreateMode,inFlight:!0});case Z.CREATING_FOLDER:return N(N({},q),{},{isCreatingFolder:!0,inFlight:!0});case Z.DELETING:return N(N({},q),{},{isDeleting:!0,inFlight:!0,actionedEntities:e.actionedEntities});case Z.MOVING:return N(N({},q),{},{isMoving:!0,inFlight:!0});case Z.CLEAR:return N({},q);case Z.CANCEL:return e.inFlight?e:N({},q);case Z.ERROR:return N(N({},e),{},{inFlight:!1,error:t.error});default:throw new Error("Unknown user action type: ".concat(t.type))}}function V(e){var t=e.reindexReferences,r=e.children,i=(0,O.d2)($)._id,o=(0,_._i)(B).permissionsLevel,a=I((0,n.useReducer)("readOnly"===o?U:G,q),2),l=a[0],u=a[1],c=(0,E.O)(),s=c.fileTreeData,p=c.dispatchRename,y=c.dispatchMove,v=(0,C.nF)(),P=v.selectedEntityIds,F=v.isRootFolderSelected,D=I((0,n.useState)(null),2),L=D[0],V=D[1],H=(0,n.useCallback)((function(){u({type:Z.START_RENAME})}),[]),z=(0,n.useCallback)((function(e){var t=Array.from(P)[0],r=(0,w.we)(s,t),n=r.entity.name;if(e===n)return u({type:Z.CLEAR});var o=function(e,t,r){if(!(0,S.AG)(r))return new k.I9;if(!x(e,t.parentFolderId,r))return new k.w4;var n=1===t.path.length,i="folder"===t.type;if(n&&!i&&(0,S.tQ)(r))return new k.Cr}(s,r,e);return o?u({type:Z.ERROR,error:o}):(u({type:Z.CLEAR}),p(t,e),function(e,t,r,n){return(0,d.ty)("/project/".concat(e,"/").concat(j(t),"/").concat(r,"/rename"),{body:{name:n}})}(i,r.type,r.entity._id,e).catch((function(e){p(t,n),u({type:Z.ERROR,error:e})})))}),[p,s,i,P]),K=(0,n.useCallback)((function(e,t){return!x(s,e,t)}),[s]),W=(0,n.useCallback)((function(){var e=Array.from(P).map((function(e){return(0,w.we)(s,e).entity}));u({type:Z.START_DELETE,actionedEntities:e})}),[s,P]),Y=(0,n.useCallback)((function(){u({type:Z.DELETING});var e=!1;return f(Array.from(P),(function(t){var r=(0,w.we)(s,t);return e=e||/\.bib$/.test(r.entity.name),function(e,t,r){return(0,d.K$)("/project/".concat(e,"/").concat(j(t),"/").concat(r))}(i,r.type,r.entity._id).catch((function(e){if(404!==e.info.statusCode)throw e}))})).then((function(){e&&t(),u({type:Z.CLEAR})})).catch((function(e){u({type:Z.ERROR,error:e})}))}),[s,i,P,t]),J=(0,n.useCallback)((function(e,t){u({type:Z.MOVING});var r=Array.from(t).map((function(e){return(0,w.we)(s,e)})).filter((function(r){return r.parentFolderId!==e&&!t.has(r.parentFolderId)})),n=e===s._id,o=r.map((function(t){return function(e,t,r,n){if(!x(e,t,r.entity.name)){var i=new k.d9;return i.entityName=r.entity.name,i}var o="folder"===r.type;if(n&&!o&&(0,S.tQ)(r.entity.name))return new k.Cr}(s,e,t,n)})).find((function(e){return e}));if(o)return u({type:Z.ERROR,error:o});var a={},l=!1;return r.forEach((function(t){a[t.entity._id]=t.parentFolderId,y(t.entity._id,e)})),f(r,function(){var t,r=(t=A().mark((function t(r){return A().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g(i,r.type,r.entity._id,e);case 3:t.next=10;break;case 5:t.prev=5,t.t0=t.catch(0),l=!0,y(r.entity._id,a[r.entity._id]),u({type:Z.ERROR,error:t.t0});case 10:case"end":return t.stop()}}),t,null,[[0,5]])})),function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(e){T(o,n,i,a,l,"next",e)}function l(e){T(o,n,i,a,l,"throw",e)}a(void 0)}))});return function(e){return r.apply(this,arguments)}}()).then((function(){l||u({type:Z.CLEAR})}))}),[y,s,i]),X=(0,n.useCallback)((function(){u({type:Z.START_CREATE_FOLDER})}),[]),Q=(0,n.useMemo)((function(){return function(e,t,r){if(r)return e._id;var n=Array.from(t)[0];if(!n)return e._id;var i=(0,w.Z7)(e,n);if(!i)return e._id;return"folder"===i.type?i.entity._id:i.parentFolderId}(s,P,F)}),[s,P,F]),ee=(0,n.useCallback)((function(e){var t=function(e,t,r){if(!(0,S.AG)(r.name))return new k.I9;if(!x(e,t,r.name))return new k.w4;var n=t===e._id,i="folder"===r.endpoint;if(n&&!i&&(0,S.tQ)(r.name))return new k.Cr}(s,Q,e);return t?Promise.reject(t):function(e,t,r){var n=r.endpoint,i=b(r,h);return(0,d.ty)("/project/".concat(e,"/").concat(n),{body:m({parent_folder_id:t},i)})}(i,Q,e)}),[s,Q,i]),te=(0,n.useCallback)((function(e){return u({type:Z.CREATING_FOLDER}),ee({endpoint:"folder",name:e}).then((function(){u({type:Z.CLEAR})})).catch((function(e){u({type:Z.ERROR,error:e})}))}),[ee]),re=(0,n.useCallback)((function(e){u({type:Z.START_CREATE_FILE,newFileCreateMode:e})}),[]),ne=(0,n.useCallback)((function(){re("doc")}),[re]),ie=(0,n.useCallback)((function(){re("upload")}),[re]),oe=(0,n.useCallback)((function(e){return u({type:Z.CREATING_FILE}),ee(e).then((function(){u({type:Z.CLEAR})})).catch((function(e){u({type:Z.ERROR,error:e})}))}),[ee]),ae=(0,n.useCallback)((function(e){return e.endpoint="doc",oe(e)}),[oe]),le=(0,n.useCallback)((function(e){return e.endpoint="linked_file",oe(e)}),[oe]),ue=(0,n.useCallback)((function(){u({type:Z.CANCEL})}),[]);(0,n.useEffect)((function(){function e(e){u({type:Z.START_CREATE_FILE,newFileCreateMode:e.detail.mode})}return window.addEventListener("file-tree.start-creating",e),function(){window.removeEventListener("file-tree.start-creating",e)}}),[]);var ce=(0,n.useMemo)((function(){if(1===P.size){var e=I(P,1)[0],t=(0,w.Z7)(s,e);if("fileRef"===(null==t?void 0:t.type))return"/project/".concat(i,"/file/").concat(e)}}),[s,i,P]),se=N(N({canDelete:P.size>0&&!F,canRename:1===P.size&&!F,canCreate:P.size<2},l),{},{parentFolderId:Q,isDuplicate:K,startRenaming:H,finishRenaming:z,startDeleting:W,finishDeleting:Y,finishMoving:J,startCreatingFile:re,startCreatingFolder:X,finishCreatingFolder:te,startCreatingDocOrFile:ne,startUploadingDocOrFile:ie,finishCreatingDoc:ae,finishCreatingLinkedFile:le,cancel:ue,droppedFiles:L,setDroppedFiles:V,downloadPath:ce});return(0,R.jsx)(M.Provider,{value:se,children:r})}V.propTypes={reindexReferences:o().func.isRequired,children:o().oneOfType([o().arrayOf(o().node),o().node]).isRequired};var $={_id:o().string.isRequired},B={permissionsLevel:o().oneOf(["readOnly","readAndWrite","owner"])};function H(){var e=(0,n.useContext)(M);if(!e)throw new Error("useFileTreeActionable is only available inside FileTreeActionableProvider");return e}},8668:function(e,t,r){"use strict";r.d(t,{Q:function(){return f},e:function(){return s}});r(71372),r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850);var n=r(2784),i=r(13980),o=r.n(i),a=r(52322);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=(0,n.createContext)();function s(){var e=(0,n.useContext)(c);if(!e)throw new Error("useFileTreeMainContext is only available inside FileTreeMainProvider");return e}var f=function(e){var t=e.refProviders,r=e.reindexReferences,i=e.setRefProviderEnabled,o=e.setStartedFreeTrial,u=e.children,s=l((0,n.useState)(),2),f=s[0],d=s[1];return(0,a.jsx)(c.Provider,{value:{refProviders:t,reindexReferences:r,setRefProviderEnabled:i,setStartedFreeTrial:o,contextMenuCoords:f,setContextMenuCoords:d},children:u})};f.propTypes={reindexReferences:o().func.isRequired,refProviders:o().object.isRequired,setRefProviderEnabled:o().func.isRequired,setStartedFreeTrial:o().func.isRequired,children:o().oneOfType([o().arrayOf(o().node),o().node]).isRequired}},38485:function(e,t,r){"use strict";r.d(t,{mI:function(){return A},nF:function(){return T},oJ:function(){return C}});r(34115),r(634),r(20796),r(36728),r(32501),r(88233),r(26936),r(15735),r(58188),r(93244),r(28673),r(6886),r(71372),r(1939),r(95342),r(43450),r(27233),r(77950),r(21850);var n,i=r(2784),o=r(13980),a=r.n(o),l=r(72779),u=r.n(l),c=r(76635),s=r.n(c),f=r(38113),d=r(91354),p=r(13364),h=r(22866),y=r(39493),m=r(18977),v=r(44694),b=r(8668),g=r(52322);function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var S=(0,i.createContext)(),O={SELECT:"SELECT",MULTI_SELECT:"MULTI_SELECT",UNSELECT:"UNSELECT"};function _(e,t){switch(t.type){case O.SELECT:return new Set(Array.isArray(t.id)?t.id:[t.id]);case O.MULTI_SELECT:var r=new Set(e);return r.has(t.id)?r.size>1&&r.delete(t.id):r.add(t.id),r;case O.UNSELECT:var n=new Set(e);return n.delete(t.id),n;default:throw new Error("Unknown selectable action type: ".concat(t.type))}}function E(e,t){switch(t.type){case O.SELECT:return new Set([t.id]);case O.MULTI_SELECT:case O.UNSELECT:return e;default:throw new Error("Unknown selectable action type: ".concat(t.type))}}function C(e){var t=e.onSelect,r=e.children,n=(0,p.d2)(k),o=n._id,a=n.rootDocId,l=(0,h._i)(R).permissionsLevel,u=j((0,m.Z)("doc.open_id.".concat(o),a),1)[0],c=(0,d.O)(),y=c.fileTreeData,b=c.setSelectedEntities,w=j((0,i.useState)(!1),2),x=w[0],C=w[1],P=j((0,i.useReducer)("readOnly"===l?E:_,null,(function(){return u&&(0,f.Z7)(y,u)?new Set([u]):new Set})),2),A=P[0],T=P[1],I=j((0,i.useState)(new Set),2),F=I[0],D=I[1];(0,i.useEffect)((function(){var e=new Set;A.forEach((function(t){var r=(0,f.Z7)(y,t);r&&r.path.forEach((function(t){return e.add(t)}))})),D(e)}),[y,A]);var N=(0,v.Z)(A);(0,i.useEffect)((function(){if(!s().isEqual(A,N)){var e=Array.from(A).map((function(e){return(0,f.Z7)(y,e)})).filter(Boolean);t(e),b(e)}}),[y,A,N,t,b]),(0,i.useEffect)((function(){function e(e){var t=(0,f.Z7)(y,e.detail);t&&T({type:O.SELECT,id:t.entity._id})}return window.addEventListener("editor.openDoc",e),function(){return window.removeEventListener("editor.openDoc",e)}}),[y]);var L=(0,i.useCallback)((function(e){T({type:O.SELECT,id:e})}),[]),M=(0,i.useCallback)((function(e){T({type:O.UNSELECT,id:e})}),[]),Z=(0,i.useCallback)((function(e,t){var r=t?O.MULTI_SELECT:O.SELECT;T({type:r,id:e})}),[]),q={selectedEntityIds:A,selectedEntityParentIds:F,select:L,unselect:M,selectOrMultiSelectEntity:Z,isRootFolderSelected:x,setIsRootFolderSelected:C};return(0,g.jsx)(S.Provider,{value:q,children:r})}C.propTypes={onSelect:a().func.isRequired,children:a().oneOfType([a().arrayOf(a().node),a().node]).isRequired};var k={_id:a().string.isRequired,rootDocId:a().string},R={permissionsLevel:a().oneOf(["readOnly","readAndWrite","owner"])},P=/Mac/.test(null===(n=window.navigator)||void 0===n?void 0:n.platform);function A(e,t){var r=(0,y.l5)(),n=r.view,o=r.setView,a=(0,b.e)().setContextMenuCoords,l=(0,d.O)().fileTreeData,c=(0,i.useContext)(S),s=c.selectedEntityIds,p=c.selectOrMultiSelectEntity,h=c.isRootFolderSelected,m=c.setIsRootFolderSelected,v=s.has(e),g=(0,i.useCallback)((function(){var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=w(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}(s);try{for(t.s();!(e=t.n()).done;){var r=e.value,i=(0,f.Z7)(l,r);if("doc"===i.type)return"editor";if("fileRef"===i.type)return"file";if("folder"===i.type)return n}}catch(e){t.e(e)}finally{t.f()}return null}),[l,s,n]),j=(0,i.useCallback)((function(r){r.stopPropagation();var n=!h&&(P?r.metaKey:r.ctrlKey);m(!1),p(e,n),"file"===t?o("file"):"doc"===t?o("editor"):"folder"===t&&o(g())}),[e,h,m,p,o,t,g]),x=(0,i.useCallback)((function(e){j(e),e.ctrlKey||e.metaKey||a(null)}),[j,a]),O=(0,i.useCallback)((function(e){"Enter"!==e.key&&" "!==e.key||j(e)}),[j]),_=(0,i.useCallback)((function(t){s.has(e)||j(t)}),[e,j,s]),E=!h&&v&&"pdf"!==n;return{isSelected:v,props:(0,i.useMemo)((function(){return{className:u()({selected:E}),"aria-selected":E,onClick:x,onContextMenu:_,onKeyPress:O}}),[x,_,O,E])}}function T(){var e=(0,i.useContext)(S);if(!e)throw new Error("useFileTreeSelectable is only available inside FileTreeSelectableProvider");return e}},17776:function(e,t,r){"use strict";r.d(t,{Cr:function(){return y},I9:function(){return h},d9:function(){return v},w4:function(){return m}});r(71372),r(96928),r(58188),r(88233),r(92215),r(61229),r(36728),r(15735),r(79321),r(28673),r(6886),r(9575),r(96264),r(34115),r(634),r(71245),r(20796);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,a=void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===n(a)?a:String(a)),i)}var o,a}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}function u(e){var t=f();return function(){var r,i=p(e);if(t){var o=p(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function c(e){var t="function"==typeof Map?new Map:void 0;return c=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,e)},c(e)}function s(e,t,r){return s=f()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&d(i,r.prototype),i},s.apply(null,arguments)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var h=function(e){l(InvalidFilenameError,e);var t=u(InvalidFilenameError);function InvalidFilenameError(){return a(this,InvalidFilenameError),t.call(this,"invalid filename")}return o(InvalidFilenameError)}(c(Error)),y=function(e){l(BlockedFilenameError,e);var t=u(BlockedFilenameError);function BlockedFilenameError(){return a(this,BlockedFilenameError),t.call(this,"blocked filename")}return o(BlockedFilenameError)}(c(Error)),m=function(e){l(DuplicateFilenameError,e);var t=u(DuplicateFilenameError);function DuplicateFilenameError(){return a(this,DuplicateFilenameError),t.call(this,"duplicate filename")}return o(DuplicateFilenameError)}(c(Error)),v=function(e){l(DuplicateFilenameMoveError,e);var t=u(DuplicateFilenameMoveError);function DuplicateFilenameMoveError(){return a(this,DuplicateFilenameMoveError),t.call(this,"duplicate filename on move")}return o(DuplicateFilenameMoveError)}(c(Error))},15270:function(e,t,r){"use strict";r.d(t,{t:function(){return s}});r(58188),r(73439),r(21515),r(43430),r(34115),r(634),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850),r(71372);var n=r(2784),i=r(28684),o=r(50325),a=r(30286);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=function(e,t){return o.W.compare(e.path,t.path)};function s(e){var t=l((0,n.useState)(!1),2),r=t[0],o=t[1],u=l((0,n.useState)(null),2),s=u[0],f=u[1],d=l((0,n.useState)(!1),2),p=d[0],h=d[1],y=(0,a.Z)().signal;return(0,n.useEffect)((function(){e&&(o(!0),h(!1),f(null),(0,i.xA)("/project/".concat(e,"/entities"),{signal:y}).then((function(e){f(e.entities.sort(c))})).catch((function(e){return h(e)})).finally((function(){return o(!1)})))}),[e,y]),{loading:r,data:s,error:p}}},25137:function(e,t,r){"use strict";r.d(t,{h:function(){return s}});r(58188),r(73439),r(21515),r(95342),r(77950),r(74069),r(1939),r(43430),r(34115),r(634),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(21850),r(71372);var n=r(2784),i=r(28684),o=r(50325),a=r(30286);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=function(e,t){return o.W.compare(e.path,t.path)};function s(e){var t=l((0,n.useState)(!1),2),r=t[0],o=t[1],u=l((0,n.useState)(null),2),s=u[0],f=u[1],d=l((0,n.useState)(!1),2),p=d[0],h=d[1],y=(0,a.Z)().signal;return(0,n.useEffect)((function(){e&&(o(!0),h(!1),f(null),(0,i.ty)("/project/".concat(e,"/compile"),{body:{check:"silent",draft:!1,incrementalCompilesEnabled:!1},signal:y}).then((function(e){if("success"===e.status){var t=e.outputFiles.filter((function(e){return e.path.match(/.*\.(pdf|png|jpeg|jpg|gif)/)}));e.outputFiles.forEach((function(t){t.clsiServerId=e.clsiServerId,t.compileGroup=e.compileGroup})),f(t.sort(c))}else h("linked-project-compile-error")})).catch((function(e){return h(e)})).finally((function(){return o(!1)})))}),[e,y]),{loading:r,data:s,error:p}}},87983:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});r(26936),r(58188),r(73439),r(21515),r(43430),r(34115),r(634),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(27233),r(77950),r(21850),r(71372);var n=r(2784),i=r(28684),o=r(50325),a=r(30286);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=function(e,t){return o.W.compare(e.name,t.name)};function s(){var e=l((0,n.useState)(!0),2),t=e[0],r=e[1],o=l((0,n.useState)(null),2),u=o[0],s=o[1],f=l((0,n.useState)(!1),2),d=f[0],p=f[1],h=(0,a.Z)().signal;return(0,n.useEffect)((function(){(0,i.xA)("/user/projects",{signal:h}).then((function(e){s(e.projects.sort(c))})).catch((function(e){return p(e)})).finally((function(){return r(!1)}))}),[h]),{loading:t,data:u,error:d}}},50325:function(e,t,r){"use strict";r.d(t,{W:function(){return n}});var n=new Intl.Collator("en",{numeric:!0,sensitivity:"variant",caseFirst:"upper"})},38113:function(e,t,r){"use strict";r.d(t,{Z7:function(){return c},gl:function(){return a},mz:function(){return u},we:function(){return o}});r(15735),r(58188),r(93244),r(28673),r(6886),r(1939),r(18178);var n=r(91601),i=r.n(n);function o(e,t){var r=c(e,t);if(r)return r;throw new(i())("Entity not found in tree",{entityId:t})}function a(e,t){var r=new Set;return t.forEach((function(t){r.add(o(e,t))})),r}function l(e){var t=new Set([e._id]);for(var r in e.folders){l(e.folders[r]).forEach((function(e){t.add(e)}))}return t}function u(e){var t=new Set;return e.forEach((function(e){l(e).forEach((function(e){t.add(e)}))})),t}function c(e,t,r){for(var n in r||(r=[e._id]),e.docs){var i=e.docs[n];if(i._id===t)return{entity:i,type:"doc",parent:e.docs,parentFolderId:e._id,path:r,index:n}}for(var o in e.fileRefs){var a=e.fileRefs[o];if(a._id===t)return{entity:a,type:"fileRef",parent:e.fileRefs,parentFolderId:e._id,path:r,index:o}}for(var l in e.folders){var u=e.folders[l];if(u._id===t)return{entity:u,type:"folder",parent:e.folders,parentFolderId:e._id,path:r,index:l};var s=c(u,t,r.concat(u._id));if(s)return s}return null}},65487:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});r(39529);function n(e){var t=e.split(".").pop();return t=t?t.toLowerCase():t,["png","pdf","jpg","jpeg","gif"].includes(t)?"image":["csv","xls","xlsx"].includes(t)?"table":["py","r"].includes(t)?"file-text":["bib"].includes(t)?"book":"file"}},61416:function(e,t,r){"use strict";r.d(t,{AG:function(){return l},tQ:function(){return u}});r(17368),r(24471),r(77950),r(51172),r(88233),r(85940),r(16781),r(74069),r(21850),r(27233),r(28673);var n=new RegExp("[\\/\\\\\\*\\u0000-\\u001F\\u007F\\u0080-\\u009F\\uD800-\\uDFFF]","g"),i=new RegExp("(^\\.$)|(^\\.\\.$)|(^\\s+)|(\\s+$)","g"),o=new RegExp("^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$"),a=1024;function l(e){return(t=e).length>0&&t.length<=a&&!e.match(n)&&!e.match(i);var t}function u(e){return o.test(e)}},45686:function(e,t,r){"use strict";r.d(t,{Z:function(){return fe}});var n={};r.r(n),r.d(n,{TPRFileViewNotOriginalImporter:function(){return y}});var i={};r.r(i),r.d(i,{TPRFileViewInfo:function(){return x}});var o={};r.r(o),r.d(o,{TPRFileViewRefreshButton:function(){return k}});var a={};r.r(a),r.d(a,{TPRFileViewRefreshError:function(){return TPRFileViewRefreshError}});r(26936),r(39529),r(31235),r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(27233),r(77950),r(21850),r(71372);var l=r(2784),u=r(13980),c=r.n(u),s=r(75234),f=(r(43450),r(18178),r(76635)),d=r(80564),p=function(e,t){var r;return(null===(r=e.linkedFileData)||void 0===r?void 0:r.provider)===t},h=r(52322);function y(e){var t=e.file,r=(0,s.$G)().t,n=(0,d.SE)().id;return p(t,"mendeley")||p(t,"zotero")?t.linkedFileData.importer_id===n?null:(0,h.jsx)("div",{className:"row",children:(0,h.jsx)("div",{className:"alert",children:r("only_importer_can_refresh",{provider:(0,f.capitalize)(t.linkedFileData.provider)})})}):null}var m=r(7585),v=(r(9575),r(96264),r(71245),r(34769),r(95342),r(68625),r(1939),r(62775),r(10280));function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==b(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===b(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var w=function(e){return(0,h.jsx)(v.Z,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({type:"external-link-square",modifier:"rotate-180",className:"linked-file-icon"},e))};function x(e){var t=e.file,r=(0,s.$G)().t;return"mendeley"===t.linkedFileData.provider?(0,h.jsx)("div",{children:(0,h.jsxs)("p",{children:[(0,h.jsx)(w,{fw:!0}),r("imported_from_mendeley_at_date",{formattedDate:(0,m.mr)(t.created),relativeDate:(0,m.K8)(t.created)})]})}):"zotero"===t.linkedFileData.provider?(0,h.jsx)("div",{children:(0,h.jsxs)("p",{children:[(0,h.jsx)(w,{fw:!0}),r("imported_from_zotero_at_date",{formattedDate:(0,m.mr)(t.created),relativeDate:(0,m.K8)(t.created)})]})}):null}x.propTypes={file:c().shape({created:c().string,linkedFileData:c().shape({provider:c().string})})};var S=r(22866),O=r(13364),_=function(e,t){var r;return(null===(r=e.linkedFileData)||void 0===r?void 0:r.provider)===t},E=r(72779),C=r.n(E);function k(e){var t,r=e.file,n=e.refreshing,i=e.refreshFile,o=(0,s.$G)().t,a=(0,d.SE)().id,l=p(r,"mendeley")||p(r,"zotero");l&&(t=r.linkedFileData.importer_id===a);var u=!l||t;return(0,h.jsxs)("button",{className:C()("btn",{"btn-primary":u,"btn-secondary":!u}),onClick:function(){return i(l)},disabled:n||!u,children:[(0,h.jsx)(v.Z,{type:"refresh",spin:n,fw:!0}),(0,h.jsx)("span",{children:n?"".concat(o("refreshing"),"…"):o("refresh")})]})}var R=r(28684),P=r(30286);function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var I=[{import:o,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-button"}];function F(e){var t=e.setRefreshError,r=e.file,n=(0,O.d2)()._id,i=(0,P.Z)().signal,o=A((0,l.useState)(!1),2),a=o[0],u=o[1],c=(0,l.useCallback)((function(e){u(!0),window.expectingLinkedFileRefreshedSocketFor=r.name;var o={shouldReindexReferences:e||/\.bib$/.test(r.name)};(0,R.ty)("/project/".concat(n,"/linked_file/").concat(r.id,"/refresh"),{signal:i,body:o}).then((function(){u(!1)})).catch((function(e){var r;u(!1),t((null===(r=e.data)||void 0===r?void 0:r.message)||e.message)}))}),[r,n,i,t]);return I.length>0?I.map((function(e){var t=e.import.TPRFileViewRefreshButton,n=e.path;return(0,h.jsx)(t,{file:r,refreshFile:c,refreshing:a},n)}))[0]:(0,h.jsx)(D,{refreshFile:c,refreshing:a})}function D(e){var t=e.refreshFile,r=e.refreshing,n=(0,s.$G)().t;return(0,h.jsxs)("button",{className:"btn btn-primary",onClick:function(){return t(null)},disabled:r,children:[(0,h.jsx)(v.Z,{type:"refresh",spin:r,fw:!0}),(0,h.jsx)("span",{children:r?"".concat(n("refreshing"),"…"):n("refresh")})]})}function TPRFileViewRefreshError(e){var t=e.file,r=e.refreshError,n=p(t,"mendeley")||p(t,"zotero");return(0,h.jsxs)("div",{className:"row",children:[(0,h.jsx)("br",{}),n?(0,h.jsx)(FileViewMendeleyOrZoteroRefreshError,{file:t}):(0,h.jsx)(FileViewDefaultRefreshError,{refreshError:r})]})}function FileViewMendeleyOrZoteroRefreshError(e){var t=e.file,r=(0,s.$G)().t;return(0,h.jsxs)("div",{className:"alert alert-danger col-md-10 col-md-offset-1",style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,h.jsxs)("div",{children:[r("something_not_right"),"! ",(0,h.jsx)("span",{children:t.linkedFileData&&r("try_relinking_provider",{provider:(0,f.capitalize)(t.linkedFileData.provider)})})]}),(0,h.jsx)("div",{className:"text-center",children:(0,h.jsx)("button",{className:"btn btn-danger",children:(0,h.jsx)("a",{href:"/user/settings",target:"_blank",style:{fontWeight:"bold",textDecoration:"none"},children:r("go_to_settings")})})})]})}function FileViewDefaultRefreshError(e){var t=e.refreshError,r=(0,s.$G)().t;return(0,h.jsxs)("div",{className:"alert alert-danger col-md-6 col-md-offset-3",children:[r("access_denied"),": ",t]})}var N=[{import:a,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-error"}];function FileViewRefreshError(e){var t=e.file,r=e.refreshError,n=(0,s.$G)().t;return N.length>0?N.map((function(e){var n=e.import.TPRFileViewRefreshError,i=e.path;return(0,h.jsx)(n,{file:t,refreshError:r},i)}))[0]:(0,h.jsxs)("div",{className:"row",children:[(0,h.jsx)("br",{}),(0,h.jsxs)("div",{className:"alert alert-danger col-md-6 col-md-offset-3",children:[n("access_denied"),": ",r]})]})}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Z=[{import:i,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-info"}],q=[{import:n,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-not-original-importer"}],U=60,G=35,V="...",$=U-G-V.length;function B(e){if(e){if(e.length>U){var t=e.slice(0,G),r=e.slice(e.length-$);return t+V+r}return e}}function H(e){var t,r=e.file,n=(0,O.d2)({_id:c().string.isRequired})._id,i=(0,S._i)({permissionsLevel:c().string}).permissionsLevel,o=(0,s.$G)().t,a=L((0,l.useState)(null),2),u=a[0],f=a[1];return r.linkedFileData&&(_(r,"url")?t=(0,h.jsx)("div",{children:(0,h.jsx)(z,{file:r})}):_(r,"project_file")?t=(0,h.jsx)("div",{children:(0,h.jsx)(K,{file:r})}):_(r,"project_output_file")&&(t=(0,h.jsx)("div",{children:(0,h.jsx)(W,{file:r})}))),(0,h.jsxs)("div",{children:[r.linkedFileData&&t,r.linkedFileData&&Z.map((function(e){var t=e.import.TPRFileViewInfo,n=e.path;return(0,h.jsx)(t,{file:r},n)})),r.linkedFileData&&"readOnly"!==i&&(0,h.jsx)(F,{file:r,setRefreshError:f})," ",(0,h.jsxs)("a",{download:!0,href:"/project/".concat(n,"/file/").concat(r.id),className:"btn btn-secondary-info btn-secondary",children:[(0,h.jsx)(v.Z,{type:"download",fw:!0})," ",(0,h.jsx)("span",{children:o("download")})]}),r.linkedFileData&&q.map((function(e){var t=e.import.TPRFileViewNotOriginalImporter,n=e.path;return(0,h.jsx)(t,{file:r},n)}))[0],u&&(0,h.jsx)(FileViewRefreshError,{file:r,refreshError:u})]})}function z(e){var t=e.file;return(0,h.jsxs)("p",{children:[(0,h.jsx)(w,{})," ",(0,h.jsx)(s.cC,{i18nKey:"imported_from_external_provider_at_date",components:[(0,h.jsx)("a",{href:t.linkedFileData.url})],values:{shortenedUrl:B(t.linkedFileData.url),formattedDate:(0,m.mr)(t.created),relativeDate:(0,m.K8)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function K(e){var t=e.file;return(0,h.jsxs)("p",{children:[(0,h.jsx)(w,{})," ",(0,h.jsx)(s.cC,{i18nKey:"imported_from_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,h.jsx)("span",{})]:[(0,h.jsx)("a",{href:"/project/".concat(t.linkedFileData.source_project_id),target:"_blank",rel:"noopener"})],values:{sourceEntityPath:t.linkedFileData.source_entity_path.slice(1),formattedDate:(0,m.mr)(t.created),relativeDate:(0,m.K8)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function W(e){var t=e.file;return(0,h.jsxs)("p",{children:[(0,h.jsx)(w,{})," ",(0,h.jsx)(s.cC,{i18nKey:"imported_from_the_output_of_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,h.jsx)("span",{})]:[(0,h.jsx)("a",{href:"/project/".concat(t.linkedFileData.source_project_id),target:"_blank",rel:"noopener"})],values:{sourceOutputFilePath:t.linkedFileData.source_output_file_path,formattedDate:(0,m.mr)(t.created),relativeDate:(0,m.K8)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function Y(e){var t=e.fileName,r=e.fileId,n=e.onLoad,i=e.onError,o=(0,O.d2)({_id:c().string.isRequired})._id;return(0,h.jsx)("img",{src:"/project/".concat(o,"/file/").concat(r),onLoad:n,onError:i,alt:t})}Y.propTypes={fileName:c().string.isRequired,fileId:c().string.isRequired,onLoad:c().func.isRequired,onError:c().func.isRequired};r(73439),r(96882),r(38859),r(17525),r(18275),r(96928);var J=r(49169),X=r(97502),Q=r(45177);function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(){te=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),l=new P(n||[]);return i(a,"_invoke",{value:E(e,r,l)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",y="completed",m={};function v(){}function b(){}function g(){}var j={};c(j,a,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(A([])));x&&x!==r&&n.call(x,a)&&(j=x);var S=g.prototype=v.prototype=Object.create(j);function O(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function r(i,o,a,l){var u=f(e[i],e,o);if("throw"!==u.type){var c=u.arg,s=c.value;return s&&"object"==ee(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,a,l)}),(function(e){r("throw",e,a,l)})):t.resolve(s).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,l)}))}l(u.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var i=d;return function(o,a){if(i===h)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var l=n.delegate;if(l){var u=C(l,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=h;var c=f(t,r,n);if("normal"===c.type){if(i=n.done?y:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=y,n.method="throw",n.arg=c.arg)}}}function C(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var o=f(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function A(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(ee(t)+" is not iterable")}return b.prototype=g,i(S,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},O(_.prototype),c(_.prototype,l,(function(){return this})),t.AsyncIterator=_,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new _(s(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},O(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=A,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function i(n,i){return l.type="throw",l.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],l=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;R(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:A(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function re(e,t,r,n,i,o,a){try{var l=e[o](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,i)}var ne=function(e){var t=e.fileId,n=e.onLoad,i=e.onError,o=(0,J.Z)(),a=(0,X.Yt)(),u=a.previewByPath,c=a.pathInFolder,s=(0,l.useCallback)(function(){var e,a=(e=te().mark((function e(a){var l,s,f,d,p,h,y,m,v,b;return te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=36;break}return e.next=3,r.e(7960).then(r.bind(r,17960)).then((function(e){return e.default}));case 3:if(l=e.sent,s=l.PDFJS,o.current){e.next=8;break}return i(),e.abrupt("return");case 8:if(f=c(t),d=f?u(f):null){e.next=13;break}return i(),e.abrupt("return");case 13:return e.next=15,s.getDocument(d.url).promise;case 15:p=e.sent,h=window.devicePixelRatio||1,y=1;case 18:if(!(y<=p.numPages)){e.next=34;break}return e.next=21,p.getPage(y);case 21:m=e.sent,v=m.getViewport({scale:h}),(b=document.createElement("canvas")).classList.add("pdf-page"),b.width=v.width,b.height=v.height,b.style.width="".concat(v.width/h,"px"),b.style.height="".concat(v.height/h,"px"),a.append(b),m.render({canvasContext:b.getContext("2d"),viewport:v});case 31:y++,e.next=18;break;case 34:return n(),e.abrupt("return",(function(){p.cleanup().catch(Q.debugConsole.error),p.destroy()}));case 36:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){re(o,n,i,a,l,"next",e)}function l(e){re(o,n,i,a,l,"throw",e)}a(void 0)}))});return function(e){return a.apply(this,arguments)}}(),[o,c,t,u,n,i]);return(0,h.jsx)("div",{className:"file-view-pdf",ref:s})};r(21515),r(85940);function ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ae=2097152;function le(e){var t=e.file,r=e.onLoad,n=e.onError,i=(0,O.d2)({_id:c().string.isRequired})._id,o=ie((0,l.useState)(""),2),a=o[0],u=o[1],s=ie((0,l.useState)(!1),2),f=s[0],d=s[1],p=ie((0,l.useState)(!1),2),y=p[0],m=p[1],v=(0,P.Z)(),b=(0,P.Z)();return(0,l.useEffect)((function(){if(!y){var e,o="/project/".concat(i,"/file/").concat(t.id),a=setTimeout((function(){return v.abort()}),1e4);fetch(o,{method:"HEAD",signal:v.signal}).then((function(e){if(!e.ok)throw new Error("HTTP Error Code: "+e.status);return e.headers.get("Content-Length")})).then((function(t){var n=!1,i=null;return t>ae&&(n=!0,i=ae),null!=i&&(o+="?range=0-".concat(i)),e=setTimeout((function(){return b.abort()}),6e4),fetch(o,{signal:b.signal}).then((function(e){return e.text().then((function(e){n&&(e=e.replace(/\n.*$/,"")),u(e),r(),d(n)}))}))})).catch((function(e){Q.debugConsole.error("Error fetching file contents",e),n()})).finally((function(){m(!1),clearTimeout(a),clearTimeout(e)}))}}),[i,t.id,n,r,y,v,b]),(0,h.jsx)("div",{children:a&&(0,h.jsx)("div",{className:"text-preview",children:(0,h.jsxs)("div",{className:"scroll-container",children:[(0,h.jsx)("p",{children:a}),f&&(0,h.jsx)("p",{children:"..."})]})})})}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ce(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}le.propTypes={file:c().shape({id:c().string}).isRequired,onLoad:c().func.isRequired,onError:c().func.isRequired};var se=["png","jpg","jpeg","gif"];function fe(e){var t=e.file,r=ue((0,l.useState)(!0),2),n=r[0],i=r[1],o=ue((0,l.useState)(!1),2),a=o[0],u=o[1],c=(0,s.$G)().t,f=window.ExposedSettings,d=f.textExtensions,p=f.editableFilenames,y=t.name.split(".").pop().toLowerCase(),m=d.includes(y)||p.includes(t.name.toLowerCase()),v=se.includes(y),b="pdf"===y,g=!m&&!v&&!b,j=(0,l.useCallback)((function(){i(!1)}),[]),w=(0,l.useCallback)((function(){a||(i(!1),u(!0))}),[a]),x=(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(H,{file:t}),v&&(0,h.jsx)(Y,{fileName:t.name,fileId:t.id,onLoad:j,onError:w}),m&&(0,h.jsx)(le,{file:t,onLoad:j,onError:w}),b&&(0,h.jsx)(ne,{fileId:t.id,onLoad:j,onError:w})]});return(0,h.jsxs)("div",{className:"file-view full-size",children:[!a&&x,!g&&n&&(0,h.jsx)(de,{}),(g||a)&&(0,h.jsx)("p",{className:"no-preview",children:c("no_preview_available")})]})}function de(){var e=(0,s.$G)().t;return(0,h.jsx)("div",{className:"loading-panel loading-panel-file-view",children:(0,h.jsxs)("span",{children:[(0,h.jsx)(v.Z,{type:"refresh",spin:!0}),"  ",e("loading"),"…"]})})}fe.propTypes={file:c().shape({id:c().string,name:c().string}).isRequired}},57597:function(e,t,r){"use strict";r.d(t,{f6:function(){return Z},VF:function(){return q}});r(15735),r(58188),r(28673),r(6886),r(60523),r(28399),r(77950),r(94908),r(32501),r(73439),r(18178),r(21515),r(43450),r(43105),r(71372),r(34115),r(634),r(20796),r(36728),r(88233),r(26936),r(27233),r(21850),r(9575),r(96264),r(71245),r(34769),r(95342),r(68625),r(1939),r(62775);var n=r(2784),i=r(39493),o=r(80564),a=r(13364),l=r(83903),u=r(6111),c=r(66462),s=r(99223);r(79321),r(49228);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===f(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var v=["edited","added","renamed","removed"];function b(e,t,r,n,i){var o=function(e,t,r,n){if(t&&!r){var i=[];if(n){var o,a=new Map,l=y(e);try{for(l.s();!(o=l.n()).done;){var u=o.value,s=(0,c.$z)(u);a.set(s,u)}}catch(e){l.e(e)}finally{l.f()}var f,d=function(e){var t=a.get(e);return!!t&&(0,c.jd)(t)},h=y(n.pathnames);try{for(h.s();!(f=h.n()).done;){var m=f.value;i.push({pathname:m,editable:d(m),operation:"edited"})}}catch(e){h.e(e)}finally{h.f()}var v,b=y(n.project_ops);try{for(b.s();!(v=b.n()).done;){var g=v.value,j=null;g.add?j={pathname:g.add.pathname,operation:"added"}:g.remove?j={pathname:g.remove.pathname,operation:"removed"}:g.rename&&(j={pathname:g.rename.newPathname,operation:"renamed"}),null!==j&&i.push(p({editable:d(j.pathname)},j))}}catch(e){b.e(e)}finally{b.f()}}return i}var w=e.reduce((function(e,t){return"operation"in t&&e.push({pathname:t.pathname,editable:(0,c.jd)(t),operation:t.operation}),e}),[]);return w}(e,t,r,n),a=e.find((function(e){return e.pathname===i})),l=o.some((function(e){return e.pathname===i}));if(a&&l)return a;var u,s=y(v);try{var f,d=function(){var t=u.value,r=o.find((function(e){return e.operation===t&&e.editable}));if(r){var n=e.find((function(e){return(0,c.$z)(e)===r.pathname}));if(n)return{v:n}}};for(s.s();!(u=s.n()).done;)if(f=d())return f.v}catch(e){s.e(e)}finally{s.f()}return a||e.find((function(e){return/main\.tex$/.test(e.pathname)}))||e.find((function(e){return/\.tex$/.test(e.pathname)}))||e[0]}var g=r(18977),j=r(14642),w=r(19034),x=r.n(w),S=r(76635),O=r(80589),_=r(9898),E=r(52322);function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==C(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===C(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=I(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||I(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){if(e){if("string"==typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?F(e,t):void 0}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var D={updateRange:null,comparing:!1,files:[],previouslySelectedPathname:null},N={updates:[],visibleUpdateCount:null,atEnd:!1,freeHistoryLimitHit:!1,nextBeforeTimestamp:void 0,loadingState:"loadingInitial"};function L(){var e,t,r=(0,i.l5)().view,f=(0,o.SE)(),d=(0,a.d2)(),p=f.id,h=d._id,y=null===(e=d.owner)||void 0===e?void 0:e._id,m=Boolean((null===(t=d.features)||void 0===t?void 0:t.versioning)||f.isAdmin),v=y===p,w=T((0,n.useState)(D),2),E=w[0],C=w[1],k=T((0,n.useState)(N),2),P=k[0],I=k[1],F=T((0,n.useState)(null),2),L=F[0],M=F[1],Z=T((0,g.Z)("history.userPrefs.showOnlyLabels.".concat(h),!1),2),q=Z[0],U=Z[1],G=(0,n.useRef)(null),V=(0,O.useErrorHandler)(),$=(0,n.useCallback)((function(){if(!G.current){var e=P.loadingState;if(!(P.atEnd||"loadingInitial"!==e&&"ready"!==e)){G.current=new AbortController;var t,r,n,i,o=G.current.signal,a=(t=(0,l.f9)(h,P.nextBeforeTimestamp,o),r=new URLSearchParams(window.location.search),n=r.get("history-max-updates"),null===(i=r.get("history-updates-delay"))&&null===n?t:t.then((function(e){var t=e.updates,r=e.nextBeforeTimestamp,o=n?parseInt(n,10):0,a=i?parseInt(i,10):0;o>0&&t.length>o&&(r=(t=t.slice(0,o))[t.length-1].fromV);var l={updates:t,nextBeforeTimestamp:r};return a>0?new Promise((function(e){window.setTimeout((function(){return e(l)}),a)})):l}))),u=null==L?(0,l.hu)(h,o):null;I(R(R({},P),{},{loadingState:"ready"===e?"loadingUpdates":"loadingInitial"})),Promise.all([a,u]).then((function(e){var t=T(e,2),r=t[0],n=r.updates,i=r.nextBeforeTimestamp,o=t[1],a=n.length?n[0].toV:null;o&&M((0,s.Q3)(o,a));var l=function(e){var t,r=new Date,n=r.setDate(r.getDate()-1),i=P.updates,o=P.freeHistoryLimitHit,a=P.visibleUpdateCount,l=i[i.length-1],u=(0,S.cloneDeep)(e),c=A(u.entries());try{for(c.s();!(t=c.n()).done;){var s,f=T(t.value,2),d=f[0],p=f[1],h=A(p.meta.users);try{for(h.s();!(s=h.n()).done;){var y=s.value;y&&(y.hue=j.Z.getHueForUserId(y.id))}}catch(e){h.e(e)}finally{h.f()}l&&x()(l.meta.end_ts).isSame(p.meta.end_ts,"day")||(p.meta.first_in_day=!0),l=p,!m&&null===a&&p.meta.end_ts<n&&(a=d>0?d+1:2,o=!0)}}catch(e){c.e(e)}finally{c.f()}return{updates:i.concat(u),visibleUpdateCount:a,freeHistoryLimitHit:o}}(n),u=l.updates,c=l.visibleUpdateCount,f=l.freeHistoryLimitHit,d=null==i||f||!u.length;I({updates:u,visibleUpdateCount:c,freeHistoryLimitHit:f,atEnd:d,nextBeforeTimestamp:i,loadingState:"ready"})})).catch(V).finally((function(){G.current=null}))}}}),[P,h,L,V,m]);(0,n.useEffect)((function(){return function(){G.current&&G.current.abort()}}),[]);var B=(0,n.useRef)(!1);(0,n.useEffect)((function(){if("history"===r&&!B.current)return B.current=!0,$()}),[r,$]),(0,n.useEffect)((function(){"history"!==r&&(B.current=!1,C((function(e){return R(R({},D),{},{previouslySelectedPathname:e.previouslySelectedPathname})})),I(N),M(null))}),[r]);var H=(0,n.useCallback)((function(){C(D)}),[]),z=E.updateRange,K=z||{},W=K.fromV,Y=K.toV,J=P.updates,X=void 0===Y?void 0:(0,_.Pe)(Y,J),Q=T((0,n.useState)(!1),2),ee=Q[0],te=Q[1];return(0,n.useEffect)((function(){if(void 0!==W&&void 0!==Y){var e=new AbortController;return te(!0),(0,l.fy)(h,W,Y,e.signal).then((function(e){var t=e.diff;C((function(e){var r=b(t,Y,e.comparing,X,e.previouslySelectedPathname),n=t.map((function(e){return(0,c.pA)(e)&&e.newPathname?(0,u.G7)(e):e}));return R(R({},e),{},{files:n,selectedFile:r,previouslySelectedPathname:r.pathname})}))})).catch(V).finally((function(){te(!1),e=null})),function(){e&&e.abort()}}}),[h,W,Y,X,V]),(0,n.useEffect)((function(){J.length&&!z&&C((function(e){return R(R({},e),{},{updateRange:{fromV:J[0].fromV,toV:J[0].toV,fromVTimestamp:J[0].meta.end_ts,toVTimestamp:J[0].meta.end_ts},comparing:!1,files:[]})}))}),[z,J]),{value:(0,n.useMemo)((function(){return{loadingFileDiffs:ee,updatesInfo:P,setUpdatesInfo:I,labels:L,setLabels:M,labelsOnly:q,setLabelsOnly:U,userHasFullFeature:m,currentUserIsOwner:v,projectId:h,selection:E,setSelection:C,fetchNextBatchOfUpdates:$,resetSelection:H}}),[ee,P,I,L,M,q,U,m,v,h,E,C,$,H])}}var M=(0,n.createContext)(void 0);function Z(e){var t=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),e)),r=L().value;return(0,E.jsx)(M.Provider,R({value:r},t))}function q(){var e=(0,n.useContext)(M);if(!e)throw new Error("HistoryContext is only available inside HistoryProvider");return e}},83903:function(e,t,r){"use strict";r.d(t,{AM:function(){return f},Hl:function(){return d},SP:function(){return u},Yi:function(){return c},f9:function(){return o},fy:function(){return s},hu:function(){return a},jc:function(){return l}});r(58188),r(88233),r(15735),r(28673),r(6886),r(60523),r(28399),r(18178);var n=r(28684),i=10;function o(e,t,r){var o={min_count:i.toString()};null!=t&&(o.before=t.toString());var a=new URLSearchParams(o).toString(),l="/project/".concat(e,"/updates?").concat(a);return(0,n.xA)(l,{signal:r})}function a(e,t){var r="/project/".concat(e,"/labels");return(0,n.xA)(r,{signal:t})}function l(e,t,r){return(0,n.ty)("/project/".concat(e,"/labels"),{body:t,signal:r})}function u(e,t,r){return(0,n.K$)("/project/".concat(e,"/labels/").concat(t),{signal:r})}function c(){return(0,n.ty)("/tutorial/react-history-buttons-tutorial/complete")}function s(e,t,r,i){var o={from:t.toString(),to:r.toString()},a=new URLSearchParams(o).toString(),l="/project/".concat(e,"/filetree/diff?").concat(a);return(0,n.xA)(l,{signal:i})}function f(e,t,r,i,o){var a={from:t.toString(),to:r.toString(),pathname:i},l=new URLSearchParams(a).toString(),u="/project/".concat(e,"/diff?").concat(l);return(0,n.xA)(u,{signal:o})}function d(e,t){return(0,n.ty)("/project/".concat(e,"/restore_file"),{body:{version:t.deletedAtV,pathname:t.pathname}})}},66462:function(e,t,r){"use strict";function n(e){return"renamed"===e.operation}function i(e){return"removed"===e.operation}function o(e){return function(e){return"editable"in e}(e)?e.editable:"edited"===e.operation}function a(e){return(n(e)?e.newPathname:null)||e.pathname}r.d(t,{$z:function(){return a},Ep:function(){return i},jd:function(){return o},pA:function(){return n}})},6111:function(e,t,r){"use strict";r.d(t,{AO:function(){return c},BA:function(){return u},G7:function(){return s}});r(26936),r(36728),r(49228),r(58188),r(32501),r(88233),r(27233),r(28673),r(77950),r(21850),r(34115),r(634),r(20796),r(15735),r(6886),r(71372);var n=r(76635),i=r.n(n),o=r(66462);function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){for(var r,n,o=null!==(r=null==t||null===(n=t.pathname)||void 0===n?void 0:n.split("/"))&&void 0!==r?r:"",a=e,l=function(){var e=o[u];if(u===o.length-1){var r=i().clone(t);r.name=e,r.type="file",a.push(r)}else{var n,l=i().find(a,(function(t){return t.name===e}));void 0===l&&(l={name:e,type:"folder",children:[],pathname:e,editable:!1},a.push(l)),a=null!==(n=l.children)&&void 0!==n?n:[]}},u=0;u<o.length;u++)l();return e}function c(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rootFolder",n=[],i=[],l=a(e);try{for(l.s();!(t=l.n()).done;){var u=t.value;if("file"===u.type){var s,f,d=(0,o.Ep)(u)?u.deletedAtV:void 0,p={pathname:null!==(s=u.pathname)&&void 0!==s?s:"",name:null!==(f=u.name)&&void 0!==f?f:"",deletedAtV:d,editable:(0,o.jd)(u),operation:"operation"in u?u.operation:void 0};i.push(p)}else if("folder"===u.type&&u.children){var h=c(u.children,u.name);n.push(h)}}}catch(e){l.e(e)}finally{l.f()}return{docs:i,folders:n,name:r}}function s(e){return{oldPathname:e.pathname,pathname:e.newPathname,operation:e.operation,editable:e.editable}}},9898:function(e,t,r){"use strict";r.d(t,{BD:function(){return o},Bz:function(){return c},Pe:function(){return u},eC:function(){return l},eR:function(){return a},x6:function(){return i}});r(45794),r(16781),r(95342),r(58188),r(18178),r(49228);var n=r(14642),i=function(e){var t=n.Z.getHueForUserId(null==e?void 0:e.id)||100;return"hsl(".concat(t,", 70%, 50%)")},o=function(e){var t=[e.first_name,e.last_name].filter((function(e){return null!=e})).join(" ").trim();return""===t&&(t=e.email.split("@")[0]),null==t||""===t?"?":t},a=function(e){return e.rename?"".concat(e.rename.pathname," → ").concat(e.rename.newPathname):e.add?"".concat(e.add.pathname):e.remove?"".concat(e.remove.pathname):""};function l(e){if(e.updateRange){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o=n[0],a=n[1];if(a=null!==(t=a)&&void 0!==t?t:o,e.comparing){if(o>e.updateRange.fromV&&a<e.updateRange.toV)return"withinSelected";if(o===a){if(o===e.updateRange.toV)return"upperSelected";if(a===e.updateRange.fromV)return"lowerSelected"}if(o>=e.updateRange.toV)return"aboveSelected";if(a<=e.updateRange.fromV)return"belowSelected";if(a===e.updateRange.toV)return"upperSelected";if(o===e.updateRange.fromV)return"lowerSelected"}else{if(a===e.updateRange.toV)return"selected";if(o>=e.updateRange.toV)return"aboveSelected";if(a<=e.updateRange.fromV)return"belowSelected"}}return null}var u=function(e,t){return t.find((function(t){return t.toV===e}))},c=function(e){var t=e.fromV,r=e.toV,n=e.meta.end_ts;return{fromV:t,toV:r,fromVTimestamp:n,toVTimestamp:n}}},99223:function(e,t,r){"use strict";r.d(t,{BB:function(){return c},Q3:function(){return f},j_:function(){return s},lG:function(){return d},oV:function(){return p}});r(32501),r(18178),r(43450),r(34769),r(39529),r(31235),r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(27233),r(88233),r(26936),r(77950),r(21850),r(71372);var n=r(76635);function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||u(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){return function(e){if(Array.isArray(e))return e}(e)||u(e)||a(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var c=function(e){return!0===e.isPseudoCurrentStateLabel},s=function(e){return!c(e)},f=function(e,t){var r=function(e){return(0,n.orderBy)(e,["isPseudoCurrentStateLabel","version","created_at"],["asc","desc","desc"])}(e),a=function(e){return e.length&&c(e[0])?o(e).slice(1):e}(r),l=function(e,t){return e.length&&e[0].version===t?e:[{id:"1",isPseudoCurrentStateLabel:!0,version:t,created_at:(new Date).toISOString()}].concat(i(e))}(a,t);return l},d=function(e){var t=[];if(e){var r=(0,n.groupBy)(e,"version");t=Object.keys(r).map((function(e){return{version:parseInt(e,10),labels:r[e]}})),t=(0,n.orderBy)(t,["version"],["desc"])}return t},p=function(e,t){var r,n=d(e).map((function(e){return e.version})),i=null===(r=t.updateRange)||void 0===r?void 0:r.toV;return i&&!n.includes(i)}},97287:function(e,t,r){"use strict";r.d(t,{Z:function(){return j}});var n=r(2784),i=r(13980),o=r.n(i),a=r(39493),l=(r(77950),r(21850),r(75234)),u=r(63584),c=r(72779),s=r.n(c),f=r(10280),d=r(36915),p=r(24958),h=r(52322),y=/Mac/i.test(navigator.platform)?"Cmd":"Ctrl";function m(){var e=(0,l.$G)().t,t=(0,d.Im)(),r=t.compiling,n=t.startCompile,i=t.hasChanges,o=r?"".concat(e("compiling"),"…"):e("recompile"),a=(0,h.jsxs)(h.Fragment,{children:[e("recompile_pdf")," ",(0,h.jsxs)("span",{className:"keyboard-shortcut",children:["(",y," + Enter)"]})]});return(0,h.jsx)("div",{className:"detach-compile-button-container",children:(0,h.jsx)(p.Z,{id:"detach-compile",description:a,tooltipProps:{className:"keyboard-tooltip"},overlayProps:{delayShow:500},children:(0,h.jsxs)(u.Z,{bsStyle:"primary",onClick:function(){return n()},disabled:r,className:s()("detach-compile-button",{"btn-striped-animated":i,"detach-compile-button-disabled":r}),children:[(0,h.jsx)(f.Z,{type:"refresh",spin:r}),(0,h.jsx)("span",{className:"detach-compile-button-label",children:o})]})})})}var v=(0,n.memo)(m);function b(){var e=(0,a.l5)(g),t=e.detachRole,r=e.detachIsLinked;return"detacher"===t&&r?(0,h.jsx)(v,{}):null}var g={detachRole:o().string,detachIsLinked:o().bool},j=(0,n.memo)(b)},14185:function(e,t,r){"use strict";r.d(t,{XA:function(){return l},bx:function(){return a},yk:function(){return u}});var n=r(39493),i=r(79657),o=r(52322);function a(){return(0,n.l5)().detachRole?null:(0,o.jsx)(i.Z,{})}function l(){var e=(0,n.l5)(),t=e.detachRole,r=e.detachIsLinked;return"detacher"===t&&r?(0,o.jsx)(i.Z,{}):null}function u(){var e=(0,n.l5)(),t=e.detachRole,r=e.detachIsLinked;return"detached"===t&&r?(0,o.jsx)(i.Z,{}):null}},78237:function(e,t,r){"use strict";r.d(t,{Z:function(){return l},j:function(){return a}});var n=r(2784),i=r(32687),o=r(83976),a=function(e){if(e.shiftKey||e.altKey)return!1;if(e.ctrlKey){if("s"===e.key||"Enter"===e.key||"."===e.key)return!0;if("S"===e.key&&!e.shiftKey)return!0}else if(e.metaKey){if("s"===e.key||"Enter"===e.key)return!0;if("S"===e.key&&!e.shiftKey)return!0}};function l(e,t,r){var l=(0,n.useCallback)((function(t){a(t)&&(t.preventDefault(),e())}),[e]),u=(0,n.useCallback)((function(){e()}),[e]);(0,i.Z)("pdf:recompile",u),(0,n.useEffect)((function(){return document.body.addEventListener("keydown",l),function(){document.body.removeEventListener("keydown",l)}}),[l]);var c=(0,o.Z)("set-changed-at",t,"detacher","detached"),s=(0,n.useCallback)((function(){c(Date.now())}),[c]);(0,i.Z)("doc:changed",s);var f=(0,o.Z)("set-saved-at",r,"detacher","detached"),d=(0,n.useCallback)((function(){f(Date.now())}),[f]);(0,i.Z)("doc:saved",d)}},72891:function(e,t,r){"use strict";r.d(t,{Z:function(){return E},s:function(){return _}});r(71372),r(58188),r(73439),r(21515),r(43105),r(34115),r(634),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850);var n=r(2784),i=r(13980),o=r.n(i),a=r(17631),l=r(2571),u=r(63584),c=r(75234),s=r(10280),f=r(11685),d=r(22866),p=r(28500),h=r(52322),y=(0,n.lazy)((function(){return r.e(6543).then(r.bind(r,56543)).then((function(e){return{default:e.ReadOnlyTokenLink}}))})),m=(0,n.lazy)((function(){return Promise.all([r.e(1623),r.e(880),r.e(5173)]).then(r.bind(r,65173))}));function v(e){var t=e.show,r=e.cancel,i=e.animation,o=e.inFlight,v=e.error,g=(0,c.$G)().t,j=(0,d._i)().isRestrictedTokenMember;return(0,h.jsxs)(f.Z,{show:t,onHide:r,animation:i,children:[(0,h.jsx)(a.Z.Header,{closeButton:!0,children:(0,h.jsx)(a.Z.Title,{children:g("share_project")})}),(0,h.jsx)(a.Z.Body,{className:"modal-body-share",children:(0,h.jsx)(l.Z,{fluid:!0,children:(0,h.jsx)(n.Suspense,{fallback:(0,h.jsx)(p.w,{minHeight:"15rem"}),children:j?(0,h.jsx)(y,{}):(0,h.jsx)(m,{})})})}),(0,h.jsxs)(a.Z.Footer,{className:"modal-footer-share",children:[(0,h.jsxs)("div",{className:"modal-footer-left",children:[o&&(0,h.jsx)(s.Z,{type:"refresh",spin:!0}),v&&(0,h.jsx)("span",{className:"text-danger error",children:(0,h.jsx)(b,{error:v})})]}),(0,h.jsx)("div",{className:"modal-footer-right",children:(0,h.jsx)(u.Z,{type:"button",onClick:r,bsStyle:null,className:"btn-secondary",disabled:o,children:g("close")})})]})]})}function b(e){var t=e.error,r=(0,c.$G)().t;switch(t){case"cannot_invite_non_user":return(0,h.jsx)(h.Fragment,{children:r("cannot_invite_non_user")});case"cannot_verify_user_not_robot":return(0,h.jsx)(h.Fragment,{children:r("cannot_verify_user_not_robot")});case"cannot_invite_self":return(0,h.jsx)(h.Fragment,{children:r("cannot_invite_self")});case"invalid_email":return(0,h.jsx)(h.Fragment,{children:r("invalid_email")});case"too_many_requests":return(0,h.jsx)(h.Fragment,{children:r("too_many_requests")});default:return(0,h.jsx)(h.Fragment,{children:r("generic_something_went_wrong")})}}var g=r(13364),j=r(89825),w=r(96227);function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var O=(0,n.createContext)(void 0);function _(){var e=(0,n.useContext)(O);if(!e)throw new Error("useShareProjectContext is only available inside ShareProjectProvider");return e}var E=n.memo((function(e){var t=e.handleHide,r=e.show,i=e.animation,a=void 0===i||i,l=x((0,n.useState)(!1),2),u=l[0],c=l[1],s=x((0,n.useState)(),2),f=s[0],d=s[1],p=(0,g.d2)(g.E_),y=(0,j.yW)({splitTestVariants:o().object}).splitTestVariants;(0,n.useEffect)((function(){r&&(0,w.sendMB)("share-modal-opened",{splitTestVariant:y["null-test-share-modal"],project_id:p._id})}),[y,p._id,r]),(0,n.useEffect)((function(){r&&d(void 0)}),[r]);var m=(0,n.useCallback)((function(){u||t()}),[t,u]),b=(0,n.useCallback)((function(e){d(void 0),c(!0);var t=e();return t.catch((function(e){var t,r;d((null===(t=e.data)||void 0===t?void 0:t.errorReason)||(null===(r=e.data)||void 0===r?void 0:r.error)||"generic_something_went_wrong")})),t.finally((function(){c(!1)})),t}),[]),S=(0,n.useCallback)((function(e){return Object.assign(p,e)}),[p]);return p?(0,h.jsx)(O.Provider,{value:{updateProject:S,monitorRequest:b,inFlight:u,setInFlight:c,error:f,setError:d},children:(0,h.jsx)(v,{animation:a,cancel:m,error:f,inFlight:u,show:r})}):null}))},66123:function(e,t,r){"use strict";r.d(t,{bh:function(){return h},eH:function(){return p},np:function(){return s},c_:function(){return l},GY:function(){return u},yV:function(){return a},xX:function(){return d},h1:function(){return f},hS:function(){return c}});r(18178);var n,i,o=r(28684);r(58188),r(73439);function a(e,t,r){var a;return function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(t,r){if(e||!window.grecaptcha)return t();try{n||(n=window.grecaptcha.render("recaptcha",{callback:function(e){i&&(i(e),i=void 0),window.grecaptcha.reset()}})),i=t}catch(e){r(e)}}))}(null===(a=window.ExposedSettings.recaptchaDisabled)||void 0===a?void 0:a.invite).then((function(n){return(0,o.ty)("/project/".concat(e,"/invite"),{body:{email:t,privileges:r,"g-recaptcha-response":n}})}))}function l(e,t){return(0,o.ty)("/project/".concat(e,"/invite/").concat(t._id,"/resend"))}function u(e,t){return(0,o.K$)("/project/".concat(e,"/invite/").concat(t._id))}function c(e,t,r){return(0,o.BS)("/project/".concat(e,"/users/").concat(t._id),{body:r})}function s(e,t){return(0,o.K$)("/project/".concat(e,"/users/").concat(t._id))}function f(e,t){return(0,o.ty)("/project/".concat(e,"/transfer-ownership"),{body:{user_id:t._id}})}function d(e,t){return(0,o.ty)("/project/".concat(e,"/settings/admin"),{body:{publicAccessLevel:t}})}function p(e){return(0,o.xA)("/project/".concat(e,"/members"))}function h(e){return(0,o.xA)("/project/".concat(e,"/invites"))}},73030:function(e,t,r){"use strict";r(15735),r(58188),r(73439),r(28673),r(6886);var n=r(2784),i=r(28500),o=r(23357),a=r(48755),l=r(52322),u=(0,n.lazy)((function(){return Promise.all([r.e(1623),r.e(3546),r.e(489),r.e(483),r.e(9516)]).then(r.bind(r,29554))}));function c(){return(0,l.jsx)(n.Suspense,{fallback:(0,l.jsx)(i.w,{delay:500}),children:(0,l.jsx)(u,{})})}t.Z=(0,o.Z)((0,n.memo)(c),a.l)},21706:function(e,t,r){"use strict";var n=r(75234),i=r(63584),o=r(10280),a=r(39493),l=r(52322);t.Z=function(){var e=(0,a.l5)(),t=e.pdfLayout,r=e.setView,u=e.detachRole,c=(0,n.$G)().t;return u||"sideBySide"===t?null:(0,l.jsxs)(i.Z,{bsStyle:null,bsSize:"xs",onClick:function(){r("pdf")},className:"switch-to-pdf-btn toolbar-btn-secondary btn-secondary",children:[(0,l.jsx)(o.Z,{type:"file-pdf-o",className:"toolbar-btn-secondary-icon"}),(0,l.jsx)("span",{className:"toolbar-btn-secondary-text",children:c("switch_to_pdf")})]})}},7585:function(e,t,r){"use strict";r.d(t,{K8:function(){return a},mr:function(){return o},oT:function(){return l}});var n=r(19034),i=r.n(n);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"h:mm a";return i()(e).format(t)}function a(e){return i()(e).calendar()}function l(e){return Date.parse(e)/1e3}i().updateLocale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}})},73545:function(e,t,r){"use strict";r(15735),r(58188),r(73439),r(28673),r(6886);var n=r(24991),i=r(75234),o=window.i18n.currentLangCode;n.ZP.use(i.Db).init({lng:o,compatibilityJSON:"v3",react:{useSuspense:!1,bindI18nStore:"added",transSupportBasicHtmlNodes:!1},interpolation:{prefix:"__",suffix:"__",unescapeSuffix:"HTML",skipOnVariables:!0,escapeValue:!1,defaultVariables:{appName:window.ExposedSettings.appName}}});var a=r(88135)("./".concat(o,".json")).then((function(e){n.ZP.addResourceBundle(o,"translation",e)}));t.Z=a},14642:function(e,t,r){"use strict";r(49228),r(58188),r(27233),r(28673),r(77950),r(74069),r(32501),r(88233),r(34115),r(634),r(20796),r(15735),r(6886),r(36728),r(26936),r(21850),r(71372);var n=r(79174),i=r.n(n);function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}t.Z={getColorScheme:function(e,t){return this.isDarkTheme(t)?{cursor:"hsl(".concat(e,", 70%, 50%)"),labelBackgroundColor:"hsl(".concat(e,", 70%, 50%)"),highlightBackgroundColor:"hsl(".concat(e,", 100%, 28%);"),strikeThroughBackgroundColor:"hsl(".concat(e,", 100%, 20%);"),strikeThroughForegroundColor:"hsl(".concat(e,", 100%, 60%);")}:{cursor:"hsl(".concat(e,", 70%, 50%)"),labelBackgroundColor:"hsl(".concat(e,", 70%, 50%)"),highlightBackgroundColor:"hsl(".concat(e,", 70%, 85%);"),strikeThroughBackgroundColor:"hsl(".concat(e,", 70%, 95%);"),strikeThroughForegroundColor:"hsl(".concat(e,", 70%, 40%);")}},isDarkTheme:function(e){var t=e.find(".ace_editor").css("background-color"),r=o(Array.from(t.match(/rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)/)),4),n=(r[0],r[1]),i=r[2],a=r[3];return(n=parseInt(n,10))+(i=parseInt(i,10))+(a=parseInt(a,10))<384},ANONYMOUS_HUE:100,OWN_HUE:200,OWN_HUE_BLOCKED_SIZE:20,TOTAL_HUES:360,getHueForUserId:function(e){if(null==e||"anonymous-user"===e)return this.ANONYMOUS_HUE;if(window.user.id===e)return this.OWN_HUE;var t=this.getHueForId(e);return t>this.OWN_HUE-this.OWN_HUE_BLOCKED_SIZE&&t<this.OWN_HUE+this.OWN_HUE_BLOCKED_SIZE&&(t=(t-=this.OWN_HUE)+this.TOTAL_HUES-this.OWN_HUE_BLOCKED_SIZE),t},getHueForTagId:function(e){return this.getHueForId(e)},getHueForId:function(e){var t=i()(e);return parseInt(t.toString().slice(0,8),16)%(this.TOTAL_HUES-2*this.OWN_HUE_BLOCKED_SIZE)}}},43363:function(e,t,r){"use strict";r.d(t,{A:function(){return E},N:function(){return P}});r(39529),r(31235),r(58188),r(1939),r(36728),r(95342),r(43430),r(43450),r(32501),r(88233),r(26936),r(27233),r(28673),r(77950),r(21850),r(34115),r(634),r(20796),r(15735),r(6886),r(71372);var n=r(1727),i=r(76635),o=r(34097),a=r(99618),l=r(45177);function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s="CM6-BeforeUpdate",f="CM6-AfterUpdate",d="CM6-DomUpdate",p="CM6-Update",h="CM6-Keypress-Measure",y=0,m=Date.now(),v=!1;try{var b="featureTestMark";performance.mark(b,{startTime:performance.now(),detail:{test:1}}),performance.clearMarks(b);var g="featureTestMeasure";performance.measure(g,{start:performance.now(),detail:{test:1}}),performance.clearMeasures(g),v=!0}catch(e){}var j=!1;function w(){return performance.memory.usedJSHeapSize}try{"memory"in window.performance&&(w(),j=!0)}catch(e){}var x=!1,S=0;try{if(PerformanceObserver.supportedEntryTypes.includes("longtask"))x=!0,new PerformanceObserver((function(e){S+=e.getEntries().length})).observe({entryTypes:["longtask"]})}catch(e){}function O(e){return!!e&&["input","delete"].includes(e.split(".")[0])}function _(e){return!!e&&["input.type","delete.forward","delete.backward"].includes(e)}function E(){if(!v)return{start:function(){},end:function(){}};var e=0,t=0,r=[];return{start:function(e){var t=performance.now();e.forEach((function(e){_(e.annotation(n.YW.userEvent))&&r.push(t)})),performance.mark(s)},end:function(i,o){performance.mark(f);var a=!1;i.forEach((function(r){var i=r.annotation(n.YW.userEvent);O(i)&&(a=!0,++e,_(i)&&++t,performance.measure(p,{start:s,end:f,detail:{userEventType:i,userEventsSinceDomUpdateCount:e}}))})),a&&o.requestMeasure({key:"inputEventCounter",read:function(){performance.mark(d,{detail:{keypressesSinceDomUpdateCount:t}}),e=0,t=0;for(var n=performance.now(),i=0,o=r;i<o.length;i++){var a=o[i];performance.measure(h,{start:a,end:n})}r.length=0}}),y=i[i.length-1].state.doc.length}}}function C(e){return 0===e.length?0:e.reduce((function(e,t){return e+t}),0)/e.length}function k(e){return e.reduce((function(e,t){return Math.max(e,t)}),0)}function R(e){switch(e){case"measure":performance.clearMeasures(p),performance.clearMarks(s),performance.clearMarks(f);break;case"dom":performance.clearMarks(d);break;case"keypress":performance.clearMeasures(h)}}function P(){var e,t=performance.getEntriesByName(p,"measure");R("measure");var r,n=t.filter((function(e){return O(e.detail.userEventType)})),l=n.map((function(e){return e.duration})).sort((function(e,t){return e-t})),c=(0,i.round)(k(l),2),s=(0,i.round)(C(l),2),f=(0,i.round)(function(e){if(0===e.length)return 0;var t=Math.floor(e.length/2);return e.length%2==0?(e[t-1]+e[t])/2:e[t]}(l),2),v=(0,i.round)(0===(r=l).length?0:r[Math.round(.95*(r.length-1))],2),b=k(n.map((function(e){return e.detail.userEventsSinceDomUpdateCount}))),g=(0,o.Z)(),_=Math.floor((Date.now()-m)/1e3),E=j?w():null,P=performance.getEntriesByName(d,"mark");R("dom");var A,T=0,I=0,F=0,D=0,N=u(P);try{for(N.s();!(A=N.n()).done;){var L=A.value.detail.keypressesSinceDomUpdateCount;1===L?++I:L>1&&++T,L>F&&(F=L),D+=L}}catch(e){N.e(e)}finally{N.f()}var M=(0,i.round)(T/(T+I),4),Z=(0,i.round)(D/(T+I),4),q=performance.getEntriesByName(h,"measure").map((function(e){return e.duration})),U=(0,i.round)(C(q),2);R("keypress");var G=null;x&&(G=S,S=0);var V=(null===(e=(0,a.Z)("ol-ExposedSettings"))||void 0===e?void 0:e.sentryRelease)||null;return{max:c,mean:s,median:f,ninetyFifthPercentile:v,maxUserEventsBetweenDomUpdates:b,docLength:y,numberOfEntries:l.length,grammarly:g,sessionLength:_,memory:E,lags:T,nonLags:I,longestLag:F,meanLagsPerMeasure:M,meanKeypressesPerMeasure:Z,meanKeypressPaint:U,longTasks:G,release:V}}window.addEventListener("editor:visual-switch",(function(){R("measure"),R("dom"),R("keypress")})),window._reportCM6Perf=function(){l.debugConsole.warn(P())}},96227:function(e,t,r){"use strict";r.r(t),r.d(t,{isSmallDevice:function(){return d},send:function(){return l},sendMB:function(){return c},sendMBOnce:function(){return s},sendMBSampled:function(){return f},sendOnce:function(){return u}});r(39529),r(6710);var n=r(93782),i="mbEvents";function o(e){return!!(n.Z.getItem(i)||{})[e]}function a(e){var t=n.Z.getItem(i)||{};t[e]=!0,n.Z.setItem(i,t)}function l(e,t,r,n){"function"==typeof window.ga&&window.ga("send","event",e,t,r,n)}function u(e,t,r,n){o(e)||"function"==typeof window.ga&&(window.ga("send","event",e,t,r,n),a(e))}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.page||(t.page=window.location.pathname),function(e,t){if(!navigator||!navigator.sendBeacon)return;t._csrf=window.csrfToken;var r=new Blob([JSON.stringify(t)],{type:"application/json; charset=UTF-8"});try{navigator.sendBeacon("/event/".concat(e),r)}catch(e){}}(e,t),"function"==typeof window.gtag&&["paywall-click","paywall-prompt","plans-page-click"].includes(e)&&window.gtag("event",e,t)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(e)||(c(e,t),a(e))}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;Math.random()<r&&c(e,t)}var d=window.screen.width<768},28684:function(e,t,r){"use strict";r.d(t,{BS:function(){return g},K$:function(){return j},kp:function(){return x},ty:function(){return b},xA:function(){return v}});r(34769),r(95342),r(68625),r(36728),r(1939),r(62775),r(96928),r(92215),r(61229),r(20796),r(15735),r(28673),r(6886),r(96882),r(38859),r(17525),r(18275),r(32501),r(6710),r(58188),r(73439),r(26936),r(9575),r(96264),r(34115),r(634),r(71372),r(71245),r(77950),r(21850);var n=r(91601),i=["body","headers","method","credentials","swallowAbortError"];function o(){o=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",s=l.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),l=new T(n||[]);return i(a,"_invoke",{value:k(e,r,l)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",y="suspendedYield",m="executing",v="completed",b={};function g(){}function j(){}function w(){}var x={};f(x,u,(function(){return this}));var S=Object.getPrototypeOf,O=S&&S(S(I([])));O&&O!==r&&n.call(O,u)&&(x=O);var _=w.prototype=g.prototype=Object.create(x);function E(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(i,o,l,u){var c=p(e[i],e,o);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==a(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,l,u)}),(function(e){r("throw",e,l,u)})):t.resolve(f).then((function(e){s.value=e,l(s)}),(function(e){return r("throw",e,l,u)}))}u(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function k(t,r,n){var i=h;return function(o,a){if(i===m)throw new Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var l=n.delegate;if(l){var u=R(l,n);if(u){if(u===b)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=m;var c=p(t,r,n);if("normal"===c.type){if(i=n.done?v:y,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=v,n.method="throw",n.arg=c.arg)}}}function R(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,R(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=p(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function I(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(a(t)+" is not iterable")}return j.prototype=w,i(_,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:j,configurable:!0}),j.displayName=f(w,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===j||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},E(C.prototype),f(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new C(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),f(_,s,"Generator"),f(_,u,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=I,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function i(n,i){return l.type="throw",l.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],l=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:I(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},t}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t,r,n,i,o,a){try{var l=e[o](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,i)}function u(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=d(e);if(t){var i=d(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e){var t=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===a(t)?t:String(t)}function v(e,t){return S(e,h(h({},t),{},{method:"GET"}))}function b(e,t){return S(e,h(h({},t),{},{method:"POST"}))}function g(e,t){return S(e,h(h({},t),{},{method:"PUT"}))}function j(e,t){return S(e,h(h({},t),{},{method:"DELETE"}))}function w(e){var t;if(!e)return"Unknown Error";return null!==(t={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",429:"Too Many Requests",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable"}[e])&&void 0!==t?t:"Unexpected Error: ".concat(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(FetchError,e);var t,r,n,i=f(FetchError);function FetchError(e,t,r,n,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FetchError),e||(e=w(null==n?void 0:n.status)),(a=i.call(this,e,{statusCode:n?n.status:void 0})).url=t,a.options=r,a.response=n,a.data=o,a}return t=FetchError,(r=[{key:"getErrorMessageKey",value:function(){var e;return null===(e=this.data)||void 0===e||null===(e=e.message)||void 0===e?void 0:e.key}},{key:"getUserFacingMessage",value:function(){var e,t,r,n=null===(e=this.response)||void 0===e?void 0:e.status,i=w(n),o=(null===(t=this.data)||void 0===t||null===(t=t.message)||void 0===t?void 0:t.text)||(null===(r=this.data)||void 0===r?void 0:r.message);if(o&&o!==i)return o;var a={400:"Invalid Request. Please correct the data and try again.",403:"Session error. Please check you have cookies enabled. If the problem persists, try clearing your cache and cookies.",429:"Too many attempts. Please wait for a while and try again."};return n&&a[n]?a[n]:"Something went wrong. Please try again."}}])&&c(t.prototype,r),n&&c(t,n),Object.defineProperty(t,"prototype",{writable:!1}),FetchError}(r.n(n)());function S(e,t){var r=t.body,n=t.headers,o=void 0===n?{}:n,a=t.method,l=void 0===a?"GET":a,c=t.credentials,s=void 0===c?"same-origin":c,f=t.swallowAbortError,d=void 0===f||f,p=h(h({},u(t,i)),{},{headers:h(h({},o),{},{"Content-Type":"application/json","X-Csrf-Token":window.csrfToken,Accept:"application/json"}),credentials:s,method:l});return void 0!==r&&(p.body=JSON.stringify(r)),new Promise((function(t,r){fetch(e,p).then((function(n){return function(e){return O.apply(this,arguments)}(n).then((function(i){n.ok?t(i):r(new x(n.statusText,e,p,n,i))}),(function(t){d&&"AbortError"===t.name||r(new x("There was an error parsing the response body",e,p,n).withCause(t))}))}),(function(t){d&&"AbortError"===t.name||r(new x("There was an error fetching the JSON",e,p).withCause(t))}))}))}function O(){var e;return e=o().mark((function e(t){var r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.headers.get("Content-Type")){e.next=3;break}return e.abrupt("return",{});case 3:if(!/application\/json/.test(r)){e.next=5;break}return e.abrupt("return",t.json());case 5:if(!/text\/plain/.test(r)){e.next=10;break}return e.next=8,t.text();case 8:return n=e.sent,e.abrupt("return",{message:n});case 10:if(!/text\/html/.test(r)){e.next=16;break}return e.next=13,t.text();case 13:if(i=e.sent,/^\s*</.test(i)){e.next=16;break}return e.abrupt("return",{message:i});case 16:return e.abrupt("return",{});case 17:case"end":return e.stop()}}),e)})),O=function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){l(o,n,i,a,u,"next",e)}function u(e){l(o,n,i,a,u,"throw",e)}a(void 0)}))},O.apply(this,arguments)}},45643:function(e,t,r){"use strict";r.d(t,{Vs:function(){return i},eR:function(){return o},xG:function(){return a}});r(15735),r(58188),r(28673),r(6886),r(60523),r(28399),r(88233);var n=r(96227);function i(e,t,r,i){var o={"paywall-type":e};i&&(o.variant=i),n.send("subscription-funnel","upgraded-free-trial",e),n.sendMB("paywall-click",o);var a=new URLSearchParams({itm_campaign:e});t&&a.set("itm_content",t),r&&(r.startedFreeTrial=!0),window.open("/user/subscription/choose-your-plan?".concat(a.toString()))}function o(e,t){var r=window.open();!function(){"function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-plan",e);t&&(t.startedFreeTrial=!0),r.location="/user/subscription"}()}function a(e){n.sendMB("paywall-prompt",{"paywall-type":e})}},28500:function(e,t,r){"use strict";r.d(t,{w:function(){return s}});r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850),r(71372);var n=r(75234),i=r(10280),o=r(2784),a=r(52322);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e){var t=e.delay,r=void 0===t?0:t,u=(0,n.$G)().t,c=l((0,o.useState)(!1),2),s=c[0],f=c[1];return(0,o.useEffect)((function(){var e=window.setTimeout((function(){f(!0)}),r);return function(){window.clearTimeout(e)}}),[r]),s?(0,a.jsxs)("div",{className:"loading",children:[(0,a.jsx)(i.Z,{type:"refresh",fw:!0,spin:!0})," ",u("loading"),"…"]}):null}function s(e){var t=e.delay,r=void 0===t?0:t,n=e.minHeight;return(0,a.jsx)("div",{className:"full-size-loading-spinner-container",style:{minHeight:n},children:(0,a.jsx)(c,{delay:r})})}t.Z=c},22866:function(e,t,r){"use strict";r.d(t,{KU:function(){return x},_i:function(){return S}});r(26936),r(36728),r(16781),r(71372),r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(32501),r(88233),r(27233),r(77950),r(21850),r(9575),r(96264),r(71245),r(34769),r(95342),r(68625),r(1939),r(62775);var n=r(2784),i=r(13980),o=r.n(i),a=r(37246),l=r(73091),u=r(96931),c=r(13364),s=r(2976),f=r(99618),d=r(80564),p=r(2982),h=r(52322);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===y(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var w=(0,n.createContext)();function x(e){var t=e.children,r=(0,u.I)(),i=(0,d.SE)().id,y=(0,s.JY)().role,m=(0,c.d2)({owner:o().shape({_id:o().string.isRequired}),features:o().shape({compileGroup:o().string}),_id:o().string.isRequired}),j=m.owner,x=m.features,S=m._id,O=(0,n.useMemo)((function(){return window.brandVariation?{logoImgUrl:window.brandVariation.logo_url,brandVariationName:window.brandVariation.name,brandVariationId:window.brandVariation.id,brandId:window.brandVariation.brand_id,brandVariationHomeUrl:window.brandVariation.home_url,publishGuideHtml:window.brandVariation.publish_guide_html,partner:window.brandVariation.partner,brandedMenu:window.brandVariation.branded_menu,submitBtnHtml:window.brandVariation.submit_button_html}:void 0}),[]),_=g((0,a.Z)("state.loading"),1)[0],E=g((0,a.Z)("project.name"),2),C=E[0],k=E[1],R=g((0,a.Z)("permissionsLevel"),1)[0],P=g((0,a.Z)("editor.showSymbolPalette"),1)[0],A=g((0,a.Z)("editor.toggleSymbolPalette"),1)[0],T=g((0,n.useState)((function(){return(0,f.Z)("ol-completedTutorials")})),2),I=T[0],F=T[1],D=(0,n.useCallback)((function(e){F(v(v({},I),{},b({},e,new Date)))}),[I]);(0,n.useEffect)((function(){if(null!=r&&r.socket)return r.socket.on("projectNameUpdated",k),function(){return r.socket.removeListener("projectNameUpdated",k)}}),[null==r?void 0:r.socket,k]);var N=(0,n.useCallback)((function(e){k((function(t){return t!==e&&(0,p.W)(S,{name:e}).catch((function(e){k(t);var n=e.data;return 400===e.status?r.showGenericMessageModal("Error renaming project",n):r.showGenericMessageModal("Error renaming project","Please try again in a moment")})),e}))}),[r,k,S]),L=(0,l.Z)().setTitle;(0,n.useEffect)((function(){var e=[];"detached"===y&&e.push("[PDF]"),C&&(e.push(C),e.push("-")),e.push("Online LaTeX Editor"),e.push(window.ExposedSettings.appName);var t=e.join(" ");L(t)}),[C,L,y]);var M=(0,n.useCallback)((function(e){window.dispatchEvent(new CustomEvent("editor:insert-symbol",{detail:e}))}),[]),Z=(0,n.useMemo)((function(){return{cobranding:O,hasPremiumCompile:"priority"===(null==x?void 0:x.compileGroup),loading:_,renameProject:N,permissionsLevel:R,isProjectOwner:(null==j?void 0:j._id)===i,isRestrictedTokenMember:(0,f.Z)("ol-isRestrictedTokenMember"),showSymbolPalette:P,toggleSymbolPalette:A,insertSymbol:M,completedTutorials:I,setCompletedTutorial:D}}),[O,null==x?void 0:x.compileGroup,j,i,_,N,R,P,A,M,I,D]);return(0,h.jsx)(w.Provider,{value:Z,children:t})}function S(e){var t=(0,n.useContext)(w);if(!t)throw new Error("useEditorContext is only available inside EditorProvider");return o().checkPropTypes(e,t,"data","EditorContext.Provider"),t}w.Provider.propTypes={value:o().shape({cobranding:o().shape({logoImgUrl:o().string.isRequired,brandVariationName:o().string.isRequired,brandVariationId:o().number.isRequired,brandId:o().number.isRequired,brandVariationHomeUrl:o().string.isRequired,publishGuideHtml:o().string,partner:o().string,brandedMenu:o().bool,submitBtnHtml:o().string}),hasPremiumCompile:o().bool,loading:o().bool,renameProject:o().func.isRequired,showSymbolPalette:o().bool,toggleSymbolPalette:o().func,insertSymbol:o().func,isProjectOwner:o().bool,isRestrictedTokenMember:o().bool,permissionsLevel:o().oneOf(["readOnly","readAndWrite","owner"])})},x.propTypes={children:o().any}},91354:function(e,t,r){"use strict";r.d(t,{O:function(){return g},T:function(){return j}});r(71372),r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850);var n=r(2784),i=r(13980),o=r.n(i),a=r(37246),l=r(20681),u=r(53687),c=r(92242),s=r(55108),f=r(52322);function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=(0,n.createContext)(),y=o().shape({_id:o().string.isRequired,name:o().string.isRequired,docs:o().array.isRequired,fileRefs:o().array.isRequired,folders:o().array.isRequired});h.Provider.propTypes={value:o().shape({fileTreeData:y,hasFolders:o().bool})};var m={RENAME:"RENAME",RESET:"RESET",DELETE:"DELETE",MOVE:"MOVE",CREATE:"CREATE"};function v(e,t){var r=e.fileTreeData;switch(t.type){case m.RESET:var n=t.fileTreeData;return{fileTreeData:n,fileCount:(0,u.y)(n)};case m.RENAME:var i=(0,l.Gd)(r,t.id,{newName:t.newName});return{fileTreeData:i,fileCount:(0,u.y)(i)};case m.DELETE:var o=(0,l.xv)(r,t.id);return{fileTreeData:o,fileCount:(0,u.y)(o)};case m.MOVE:var a=(0,l.RB)(r,t.entityId,t.toFolderId);return{fileTreeData:a,fileCount:(0,u.y)(a)};case m.CREATE:var c=(0,l.$O)(r,t.parentFolderId,t.entity);return{fileTreeData:c,fileCount:(0,u.y)(c)};default:throw new Error("Unknown mutable file tree action type: ".concat(t.type))}}var b=function(e){var t=null==e?void 0:e[0];return{fileTreeData:t,fileCount:(0,u.y)(t)}};function g(e){var t=(0,n.useContext)(h);if(!t)throw new Error("useFileTreeData is only available inside FileTreeDataProvider");return o().checkPropTypes(e,t,"data","FileTreeDataContext.Provider"),t}function j(e){var t=e.children,r=(d((0,a.Z)("project"),1)[0]||{}).rootFolder,i=d((0,n.useReducer)(v,r,b),2),o=i[0],l=o.fileTreeData,u=o.fileCount,p=i[1],y=d((0,n.useState)([]),2),g=y[0],j=y[1],w=(0,n.useMemo)((function(){return l?(0,s.m)(l):void 0}),[l]);(0,c.Z)((function(){p({type:m.RESET,fileTreeData:null==r?void 0:r[0]})}),[r]);var x=(0,n.useCallback)((function(e,t){t.type="folder",p({type:m.CREATE,parentFolderId:e,entity:t})}),[]),S=(0,n.useCallback)((function(e,t){t.type="doc",p({type:m.CREATE,parentFolderId:e,entity:t})}),[]),O=(0,n.useCallback)((function(e,t){t.type="fileRef",p({type:m.CREATE,parentFolderId:e,entity:t})}),[]),_=(0,n.useCallback)((function(e,t){p({type:m.RENAME,newName:t,id:e})}),[]),E=(0,n.useCallback)((function(e){p({type:m.DELETE,id:e})}),[]),C=(0,n.useCallback)((function(e,t){p({type:m.MOVE,entityId:e,toFolderId:t})}),[]),k=(0,n.useMemo)((function(){return{dispatchCreateDoc:S,dispatchCreateFile:O,dispatchCreateFolder:x,dispatchDelete:E,dispatchMove:C,dispatchRename:_,fileCount:u,fileTreeData:l,hasFolders:(null==l?void 0:l.folders.length)>0,selectedEntities:g,setSelectedEntities:j,docs:w}}),[S,O,x,E,C,_,u,l,g,j,w]);return(0,f.jsx)(h.Provider,{value:k,children:t})}j.propTypes={children:o().any}},39493:function(e,t,r){"use strict";r.d(t,{aM:function(){return y},l5:function(){return m}});r(71372),r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850);var n=r(2784),i=r(37246),o=r(41740),a=r(76066),l=r(99618),u=r(45177),c=r(44466),s=r(52322);function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=(0,l.Z)("ol-debugPdfDetach"),h=(0,n.createContext)(void 0);var y=function(e){var t=e.children,r=f((0,i.Z)("ui.view"),2),l=r[0],d=r[1],y=f((0,i.Z)("openFile"),1)[0],m=(0,c.Z)("history:toggle",!0),v=(0,n.useCallback)((function(e){d((function(t){return"history"!==e&&"history"!==t||m(),"editor"===e&&y?"file":e}))}),[d,y,m]),b=f((0,i.Z)("ui.chatOpen"),2),g=b[0],j=b[1],w=f((0,i.Z)("ui.reviewPanelOpen"),2),x=w[0],S=w[1],O=f((0,i.Z)("ui.leftMenuShown"),2),_=O[0],E=O[1],C=f((0,i.Z)("ui.pdfLayout"),2),k=C[0],R=C[1],P=f((0,i.Z)("ui.loadingStyleSheet"),2),A=P[0],T=P[1],I=(0,n.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"editor";R(e),v("sideBySide"===e?"editor":t),function(e){a.Z.setItem("pdf.layout","sideBySide"===e?"split":"flat")}(e)}),[R,v]),F=(0,o.Z)(),D=F.reattach,N=F.detach,L=F.isLinking,M=F.isLinked,Z=F.role,q=F.isRedundant,U="sideBySide"===k||"pdf"===l||"detacher"===Z;(0,n.useEffect)((function(){p&&u.debugConsole.warn("Layout Effect",{detachIsRedundant:q,detachRole:Z,detachIsLinking:L,detachIsLinked:M}),"detacher"===Z&&(q?I("sideBySide"):(L||M)&&I("flat","editor"))}),[q,Z,L,M,I]);var G=(0,n.useMemo)((function(){return{reattach:D,detach:N,detachIsLinked:M,detachRole:Z,changeLayout:I,chatIsOpen:g,leftMenuShown:_,pdfLayout:k,pdfPreviewOpen:U,reviewPanelOpen:x,loadingStyleSheet:A,setChatIsOpen:j,setLeftMenuShown:E,setPdfLayout:R,setReviewPanelOpen:S,setLoadingStyleSheet:T,setView:v,view:l}}),[D,N,M,Z,I,g,_,k,U,x,A,j,E,R,S,T,v,l]);return(0,s.jsx)(h.Provider,{value:G,children:t})};function m(){var e=(0,n.useContext)(h);if(!e)throw new Error("useLayoutContext is only available inside LayoutProvider");return e}},13364:function(e,t,r){"use strict";r.d(t,{E_:function(){return m},d2:function(){return v},jI:function(){return g}});r(71372),r(26936),r(43450),r(15735),r(58188),r(28673),r(6886),r(60523),r(28399),r(77950),r(94908),r(34115),r(634),r(20796),r(36728),r(32501),r(88233),r(27233),r(21850),r(9575),r(96264),r(71245),r(34769),r(95342),r(68625),r(1939),r(62775);var n=r(2784),i=r(13980),o=r.n(i),a=r(37246),l=r(99618),u=r(52322);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==c(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===c(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var y=(0,n.createContext)(),m={_id:o().string.isRequired,name:o().string.isRequired,rootDocId:o().string,members:o().arrayOf(o().shape({_id:o().string.isRequired})),invites:o().arrayOf(o().shape({_id:o().string.isRequired})),features:o().shape({collaborators:o().number,compileGroup:o().oneOf(["alpha","standard","priority"]),trackChangesVisible:o().bool,references:o().bool,mendeley:o().bool,zotero:o().bool,versioning:o().bool,gitBridge:o().bool}),publicAccessLevel:o().string,owner:o().shape({_id:o().string.isRequired,email:o().string.isRequired}),useNewCompileTimeoutUI:o().string,tags:o().arrayOf(o().shape({_id:o().string.isRequired,name:o().string.isRequired,color:o().string})).isRequired};function v(e){var t=(0,n.useContext)(y);if(!t)throw new Error("useProjectContext is only available inside ProjectProvider");return o().checkPropTypes(e,t,"data","ProjectContext.Provider"),t}y.Provider.propTypes={value:o().shape(m)};var b={_id:window.project_id,name:"",features:{}};function g(e){var t=e.children,r=p((0,a.Z)("project",!0),1)[0]||b,i=r._id,o=r.name,c=r.rootDoc_id,s=r.members,d=r.invites,h=r.features,m=r.publicAccesLevel,v=r.owner,g=r.showNewCompileTimeoutUI,j=r.trackChangesState,w=(0,n.useMemo)((function(){return(0,l.Z)("ol-projectTags",[]).map((function(e){var t;return f(f({},e),{},{name:null!==(t=e.name)&&void 0!==t?t:""})}))}),[]),x=new URLSearchParams(window.location.search).get("force_new_compile_timeout"),S="active"===x?"active":"changing"===x?"changing":void 0,O=(0,n.useMemo)((function(){return{_id:i,name:o,rootDocId:c,members:s,invites:d,features:h,publicAccessLevel:m,owner:v,showNewCompileTimeoutUI:S||g,tags:w,trackChangesState:j}}),[i,o,c,s,d,h,m,v,g,S,w,j]);return(0,u.jsx)(y.Provider,{value:O,children:t})}g.propTypes={children:o().any}},89825:function(e,t,r){"use strict";r.d(t,{_8:function(){return c},yW:function(){return s}});var n=r(2784),i=r(13980),o=r.n(i),a=r(99618),l=r(52322),u=(0,n.createContext)();function c(e){var t=e.children,r=(0,n.useMemo)((function(){return{splitTestVariants:(0,a.Z)("ol-splitTestVariants")||{},splitTestInfo:(0,a.Z)("ol-splitTestInfo")||{}}}),[]);return(0,l.jsx)(u.Provider,{value:r,children:t})}function s(e){var t=(0,n.useContext)(u);return o().checkPropTypes(e,t,"data","SplitTestContext.Provider"),t}u.Provider.propTypes={value:o().shape({splitTestVariants:o().object.isRequired,splitTestInfo:o().object.isRequired})},c.propTypes={children:o().any}},41061:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});r(34115),r(634),r(58188),r(20796),r(15735),r(28673),r(6886),r(36728),r(32501),r(88233),r(26936),r(27233),r(77950),r(21850),r(71372);var n=r(2784);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e=(0,n.useRef)(null),t=i((0,n.useState)(!1),2),r=t[0],o=t[1],a=(0,n.useCallback)((function(){return o(!1)}),[]);return(0,n.useEffect)((function(){if(!r){var t=null;return e.current&&(t=window.requestAnimationFrame((function(){e.current&&(e.current.focus(),o(!0),t=null)}))),function(){null!==t&&window.cancelAnimationFrame(t)}}})),{autoFocusedRef:e,resetAutoFocus:a}}},70887:function(e,t,r){"use strict";r.d(t,{K:function(){return i}});var n=r(2784),i=function(e){var t,r=(null===(t=(0,n.useRef)(null)).current&&"BroadcastChannel"in window&&(t.current=new BroadcastChannel("user")),(0,n.useEffect)((function(){return function(){var e;return null===(e=t.current)||void 0===e?void 0:e.close()}}),[]),t.current);(0,n.useEffect)((function(){var t=new AbortController;return null==r||r.addEventListener("message",(function(t){var r=t.data;return e(r)}),{signal:t.signal}),function(){return t.abort()}}),[r,e])}},56556:function(e,t,r){"use strict";r.d(t,{V:function(){return c}});r(32501),r(58188),r(88233);var n=r(79174),i=r.n(n),o=100,a=200,l=20,u=360;function c(e,t){if(null==e||"anonymous-user"===e)return o;if(t===e)return a;var r=function(e){var t=i()(e),r=parseInt(t.toString().slice(0,8),16)%(u-2*l);return r}(e);return r>a-l&&r<a+l&&(r=(r-=a)+u-l),r}},34097:function(e,t,r){"use strict";function n(){return!!document.querySelector("grammarly-desktop-integration")}r.d(t,{Z:function(){return n}})},78297:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});r(36728),r(27233),r(28673),r(43450),r(9575),r(96264),r(34115),r(634),r(58188),r(71372),r(71245),r(20796),r(15735),r(6886),r(32501),r(88233),r(26936),r(77950),r(21850);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,a=void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===n(a)?a:String(a)),i)}var o,a}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,r=[{key:"on",value:function(e,t){var r;this.events||(this.events={});var n=o(Array.from(e.split(".")),2);return e=n[0],r=n[1],this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,namespace:r})}},{key:"off",value:function(e){if(this.events||(this.events={}),null!=e){var t,r=o(Array.from(e.split(".")),2);if(e=r[0],null==(t=r[1]))return delete this.events[e];for(var n=[],i=0,a=Array.from(this.events[e]||[]);i<a.length;i++){var l=a[i];l.namespace!==t&&n.push(l)}return this.events[e]=n}return this.events={}}},{key:"trigger",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.events||(this.events={}),Array.from(this.events[e]||[]).map((function(e){return e.callback.apply(e,i(Array.from(r||[])))}))}},{key:"emit",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.trigger.apply(this,i(Array.from(t||[])))}}],r&&u(t.prototype,r),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()},45177:function(e,t,r){"use strict";r.r(t),r.d(t,{debugConsole:function(){return i},debugging:function(){return n}});r(15735),r(58188),r(28673),r(6886),r(60523),r(28399),r(77950),r(94908);var n="true"===new URLSearchParams(window.location.search).get("debug"),i=n?console:{debug:function(){},log:function(){},warn:console.warn,error:console.error}},58976:function(e,t,r){var n,i,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n=[r(81637),r(45177)],i=function(e,{debugging:t,debugConsole:r}){var n,i,c,s=void 0;window.sharejs=s={};var f=s.types={};s._bt=i=function(e,t,r,n){var i=void 0;return e.transformX=e.transformX=i=function(e,o){r(e),r(o);var a,u,c,s=[],f=!0,d=!1,p=void 0;try{for(var h,y=Array.from(o)[Symbol.iterator]();!(f=(h=y.next()).done);f=!0){for(var m=h.value,v=[],b=0;b<e.length;){var g,j=[];if(a=e[b],c=j,t(v,a,u=m,"left"),t(c,u,a,"right"),b++,1!==j.length){if(0===j.length){var w=!0,x=!1,S=void 0;try{for(var O,_=Array.from(e.slice(b))[Symbol.iterator]();!(w=(O=_.next()).done);w=!0)g=O.value,n(v,g)}catch(e){x=!0,S=e}finally{try{!w&&_.return&&_.return()}finally{if(x)throw S}}m=null;break}var E=Array.from(i(e.slice(b),j)),C=l(E,2),k=C[0],R=C[1],P=!0,A=!1,T=void 0;try{for(var I,F=Array.from(k)[Symbol.iterator]();!(P=(I=F.next()).done);P=!0)g=I.value,n(v,g)}catch(e){A=!0,T=e}finally{try{!P&&F.return&&F.return()}finally{if(A)throw T}}var D=!0,N=!1,L=void 0;try{for(var M,Z=Array.from(R)[Symbol.iterator]();!(D=(M=Z.next()).done);D=!0){var q=M.value;n(s,q)}}catch(e){N=!0,L=e}finally{try{!D&&Z.return&&Z.return()}finally{if(N)throw L}}m=null;break}m=j[0]}null!=m&&n(s,m),e=v}}catch(e){d=!0,p=e}finally{try{!f&&y.return&&y.return()}finally{if(d)throw p}}return[e,s]},e.transform=e.transform=function(e,r,n){if("left"!==n&&"right"!==n)throw new Error("type must be 'left' or 'right'");if(0===r.length)return e;if(1===e.length&&1===r.length)return t([],e[0],r[0],n);if("left"===n){var o,a=Array.from(i(e,r)),u=l(a,2);return o=u[0],u[1],o}var c=Array.from(i(r,e)),s=l(c,2);return s[0],s[1]}};var d={name:"text",create:function(){return""}},p=function(e,t,r){return e.slice(0,t)+r+e.slice(t)},h=function(e){if("number"!=typeof e.p)throw new Error("component missing position field");if(!("string"===a(e.i)^"string"===a(e.d)^"string"===a(e.c)))throw new Error("component needs an i, d or c field");if(!(e.p>=0))throw new Error("position cannot be negative")},y=function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=Array.from(e)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;h(a)}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}return!0};d.apply=function(e,t){y(t);var r=!0,n=!1,i=void 0;try{for(var o,a=Array.from(t)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=o.value;if(null!=l.i)e=p(e,l.p,l.i);else if(null!=l.d){var u=e.slice(l.p,l.p+l.d.length);if(l.d!==u)throw new Error("Delete component '"+l.d+"' does not match deleted text '"+u+"'");e=e.slice(0,l.p)+e.slice(l.p+l.d.length)}else{if(null==l.c)throw new Error("Unknown op type");var c=e.slice(l.p,l.p+l.c.length);if(l.c!==c)throw new Error("Comment component '"+l.c+"' does not match commented text '"+c+"'")}}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e};var m=function(e,t){var r=void 0,n={};for(var i in e)r=e[i],n[i]=r;for(i in t)r=t[i],n[i]=r;return n};d._append=n=function(e,t){if(""!==t.i&&""!==t.d){if(0===e.length)return e.push(t);var r=e[e.length-1];return null!=r.i&&null!=t.i&&r.p<=t.p&&t.p<=r.p+r.i.length&&r.u===t.u?e[e.length-1]=m(r,{i:p(r.i,t.p-r.p,t.i)}):null!=r.d&&null!=t.d&&t.p<=r.p&&r.p<=t.p+t.d.length&&r.u===t.u?e[e.length-1]=m(r,{d:p(t.d,r.p-t.p,r.d),p:t.p}):e.push(t)}},d.compose=function(e,t){y(e),y(t);var r=e.slice(),i=!0,o=!1,a=void 0;try{for(var l,u=Array.from(t)[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=l.value;n(r,c)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return r},d.compress=function(e){return d.compose([],e)},d.normalize=function(e){var t=[];null==e.i&&null==e.p||(e=[e]);var r=!0,i=!1,o=void 0;try{for(var a,l=Array.from(e)[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;null==u.p&&(u.p=0),n(t,u)}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}return t};var v=function(e,t,r){if(null!=t.i)return t.p<e||t.p===e&&r?e+t.i.length:e;if(null!=t.d)return e<=t.p?e:e<=t.p+t.d.length?t.p:e-t.d.length;if(null!=t.c)return e;throw new Error("unknown op type")};d.transformCursor=function(e,t,r){var n="right"===r,i=!0,o=!1,a=void 0;try{for(var l,u=Array.from(t)[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=l.value;e=v(e,c,n)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return e},d._tc=c=function(e,t,r,i){var o=void 0,a=void 0,l=void 0;if(y([t]),y([r]),null!=t.i)n(e,m(t,{p:v(t.p,r,"right"===i)}));else if(null!=t.d)if(null!=r.i){var u=t.d;t.p<r.p&&(n(e,m(t,{d:u.slice(0,r.p-t.p)})),u=u.slice(r.p-t.p)),""!==u&&n(e,m(t,{d:u,p:t.p+r.i.length}))}else if(null!=r.d)if(t.p>=r.p+r.d.length)n(e,m(t,{p:t.p-r.d.length}));else if(t.p+t.d.length<=r.p)n(e,t);else{if(l=m(t,{d:""}),t.p<r.p&&(l.d=t.d.slice(0,r.p-t.p)),t.p+t.d.length>r.p+r.d.length&&(l.d+=t.d.slice(r.p+r.d.length-t.p)),a=Math.max(t.p,r.p),o=Math.min(t.p+t.d.length,r.p+r.d.length),t.d.slice(a-t.p,o-t.p)!==r.d.slice(a-r.p,o-r.p))throw new Error("Delete ops delete different text in the same region of the document");""!==l.d&&(l.p=v(l.p,r),n(e,l))}else{if(null==r.c)throw new Error("unknown op type");n(e,t)}else if(null!=t.c)if(null!=r.i)if(t.p<r.p&&r.p<t.p+t.c.length){var c=r.p-t.p,s=t.c.slice(0,+(c-1)+1||void 0)+r.i+t.c.slice(c);n(e,m(t,{c:s}))}else n(e,m(t,{p:v(t.p,r,!0)}));else if(null!=r.d)if(t.p>=r.p+r.d.length)n(e,m(t,{p:t.p-r.d.length}));else if(t.p+t.c.length<=r.p)n(e,t);else{if(l=m(t,{c:""}),t.p<r.p&&(l.c=t.c.slice(0,r.p-t.p)),t.p+t.c.length>r.p+r.d.length&&(l.c+=t.c.slice(r.p+r.d.length-t.p)),a=Math.max(t.p,r.p),o=Math.min(t.p+t.c.length,r.p+r.d.length),t.c.slice(a-t.p,o-t.p)!==r.d.slice(a-r.p,o-r.p))throw new Error("Delete ops delete different text in the same region of the document");l.p=v(l.p,r),n(e,l)}else{if(null==r.c)throw new Error("unknown op type");n(e,t)}return e};d.invert=function(e){return Array.from(e.slice().reverse()).map((function(e){return function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}}(e)}))},s.types||(s.types={}),i(d,c,y,n),s.types.text=d,d.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(e,t,r,n){var i={p:e,i:t};return r&&(i.u=!0),i=[i],this.submitOp(i,n),i},del:function(e,t,r,n){var i={p:e,d:this.snapshot.slice(e,e+t)};return r&&(i.u=!0),i=[i],this.submitOp(i,n),i},_register:function(){return this.on("remoteop",(function(e){var t=this;return function(){var r=[],n=!0,i=!1,o=void 0;try{for(var a,l=Array.from(e)[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var u=a.value;void 0!==u.i?r.push(t.emit("insert",u.p,u.i)):void 0!==u.d?r.push(t.emit("delete",u.p,u.d)):r.push(void 0)}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}return r}()}))}};var b=function(e){return setTimeout(e,0)},g=function(){function e(){u(this,e)}return o(e,[{key:"on",value:function(e,t){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(t),this}},{key:"removeListener",value:function(e,t){var r=this;this._events||(this._events={});for(var n=this._events[e]||(this._events[e]=[]),i=0;i<n.length;)n[i]===t&&(n[i]=void 0),i++;return b((function(){return r._events[e]=Array.from(r._events[e]).filter((function(e){return e}))})),this}},{key:"emit",value:function(e){if(!(null!=this._events?this._events[e]:void 0))return this;for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=!0,o=!1,a=void 0;try{for(var l,u=Array.from(this._events[e])[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=l.value;c&&c.apply(this,r)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return this}}]),e}();g.mixin=function(e){var t=e.prototype||e;return t.on=g.prototype.on,t.removeListener=g.prototype.removeListener,t.emit=g.prototype.emit,e},s.extendDoc=function(e,t){return j.prototype[e]=t};var j=function(){function n(e,t,r){u(this,n),this.flush=this.flush.bind(this),this.setFlushDelay=this.setFlushDelay.bind(this),this.shout=this.shout.bind(this),this.connection=e,this.name=t,r||(r={}),this.version=r.v,this.snapshot=r.snaphot,r.type&&this._setType(r.type),this.state="closed",this.autoOpen=!1,this._create=r.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[]}return o(n,[{key:"_xf",value:function(e,t){return this.type.transformX?this.type.transformX(e,t):[this.type.transform(e,t,"left"),this.type.transform(t,e,"right")]}},{key:"_otApply",value:function(e,t,r){var n=this.snapshot;if(this.snapshot=this.type.apply(this.snapshot,e),this.emit("change",e,n,r),t)return this.emit("remoteop",e,n,r)}},{key:"_connectionStateChanged",value:function(e,t){switch(e){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.push(this.connection.id),this.emit("closed");break;case"ok":this.autoOpen&&this.open();break;case"stopped":"function"==typeof this._openCallback&&this._openCallback(t)}return this.emit(e,t)}},{key:"_setType",value:function(e){if("string"==typeof e&&(e=f[e]),!e||!e.compose)throw new Error("Support for types without compose() is not implemented");if(this.type=e,e.api){for(var t in e.api){var r=e.api[t];this[t]=r}return"function"==typeof this._register?this._register():void 0}return this.provides={}}},{key:"_onMessage",value:function(e){if(!0===e.open){if(this.state="open",this._create=!1,null==this.created&&(this.created=!!e.create),e.type&&this._setType(e.type),e.create?(this.created=!0,this.snapshot=this.type.create()):(!0!==this.created&&(this.created=!1),void 0!==e.snapshot&&(this.snapshot=e.snapshot)),null!=e.v&&(this.version=e.v),this.inflightOp){var t={doc:this.name,op:this.inflightOp,v:this.version};this.inflightSubmittedIds.length&&(t.dupIfSource=this.inflightSubmittedIds),this.connection.send(t)}else this.flush();return this.emit("open"),"function"==typeof this._openCallback?this._openCallback(null):void 0}if(!1===e.open)return e.error&&(r.error("Could not open document: "+e.error),this.emit("error",e.error),"function"==typeof this._openCallback&&this._openCallback(e.error)),this.state="closed",this.emit("closed"),"function"==typeof this._closeCallback&&this._closeCallback(),this._closeCallback=null;if(null!==e.op||"Op already submitted"!==i){if(void 0===e.op&&void 0!==e.v||e.op&&Array.from(this.inflightSubmittedIds).includes(e.meta.source)){var n=this.inflightOp;this.inflightOp=null,this.inflightSubmittedIds.length=0,null===this.pendingOp&&this.emit("saved");var i=e.error;if(i){if(this.type.invert){var o=this.type.invert(n);if(this.pendingOp){var a=Array.from(this._xf(this.pendingOp,o)),u=l(a,2);this.pendingOp=u[0],o=u[1]}this._otApply(o,!0,e)}else this.emit("error","Op apply failed ("+i+") and the op could not be reverted");var c=!0,s=!1,f=void 0;try{for(var d,p=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(c=(d=p.next()).done);c=!0)(0,d.value)(i)}catch(e){s=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(s)throw f}}}else{if(e.v<this.version)return;if(e.v!==this.version)throw new Error("Invalid version from server");this.version++,this.emit("acknowledge",n);var h=!0,y=!1,m=void 0;try{for(var v,b=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(h=(v=b.next()).done);h=!0)(0,v.value)(null,n)}catch(e){y=!0,m=e}finally{try{!h&&b.return&&b.return()}finally{if(y)throw m}}}return this.delayedFlush()}if(e.op){if(e.v<this.version)return;if(e.doc!==this.name)return this.emit("error","Expected docName '"+this.name+"' but got "+e.doc);if(e.v!==this.version)return this.emit("error","Expected version "+this.version+" but got "+e.v);var g=e.op;if(null!==this.inflightOp){var j=Array.from(this._xf(this.inflightOp,g)),w=l(j,2);this.inflightOp=w[0],g=w[1]}if(null!==this.pendingOp){var x=Array.from(this._xf(this.pendingOp,g)),S=l(x,2);this.pendingOp=S[0],g=S[1]}return this.version++,this._otApply(g,!0,e)}if(e.meta){var O=e.meta,_=O.path,E=O.value;return"shout"===(null!=_?_[0]:void 0)?this.emit("shout",E):r.warn("Unhandled meta op:",e)}return r.warn("Unhandled document message:",e)}}},{key:"flush",value:function(){if(this.flushTimeout=null,"ok"===this.connection.state&&null===this.inflightOp&&null!==this.pendingOp){if(this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.emit("flipped_pending_to_inflight"),window.useShareJsHash||t){var r=Date.now(),n=this.__lastSubmitTimestamp&&r-this.__lastSubmitTimestamp;if(!this.__lastSubmitTimestamp||n>5e3||n<0||t){var i=e("blob "+this.snapshot.length+"\0"+this.snapshot).toString();this.__lastSubmitTimestamp=r}}var o=this.__lastVersion;return this.__lastVersion=this.version,this.connection.send({doc:this.name,op:this.inflightOp,v:this.version,lastV:o,hash:i})}}},{key:"submitOp",value:function(e,t){null!=this.type.normalize&&(e=this.type.normalize(e));var r=this.snapshot;return this.snapshot=this.type.apply(this.snapshot,e),null!==this.pendingOp?this.pendingOp=this.type.compose(this.pendingOp,e):this.pendingOp=e,t&&this.pendingCallbacks.push(t),this.emit("change",e,r),this.delayedFlush()}},{key:"delayedFlush",value:function(){if(null==this.flushTimeout)return this.flushTimeout=setTimeout(this.flush,this._flushDelay||0)}},{key:"setFlushDelay",value:function(e){return this._flushDelay=e}},{key:"shout",value:function(e){return this.connection.send({doc:this.name,meta:{path:["shout"],value:e}})}},{key:"open",value:function(e){var t=this;if(this.autoOpen=!0,"closed"===this.state){var r={doc:this.name,open:!0};return void 0===this.snapshot&&(r.snapshot=null),this.type&&(r.type=this.type.name),null!=this.version&&(r.v=this.version),this._create&&(r.create=!0),this.connection.send(r),this.state="opening",this._openCallback=function(r){return t._openCallback=null,"function"==typeof e?e(r):void 0}}}},{key:"close",value:function(e){return this.autoOpen=!1,"closed"===this.state?"function"==typeof e?e():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=e)}}]),n}();return g.mixin(j),s.Doc=j,window.sharejs}.apply(t,n),void 0===i||(e.exports=i)}}]);